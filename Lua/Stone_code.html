<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Stone Code | 潇淼文档</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/favicon.ico">
    <script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?bcbe8dcd550616b188183a023ba3e682";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
    <meta name="description" content="MiniDoc">
    <meta name="robots" content="all">
    <meta name="author" content="msk11@qq.com">
    <meta name="copyright" content="Hcat">
    <meta name="revisit-after" content="7 days">
    <meta name="keywords" content="潇淼文档,潇淼,迷你世界,文档,迷你,mini,doc,世界,MiniWorld,脚本,教程">
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <link rel="preload" href="/assets/css/0.styles.84203ac8.css" as="style"><link rel="preload" href="/assets/js/app.ef735673.js" as="script"><link rel="preload" href="/assets/js/2.b51029ec.js" as="script"><link rel="preload" href="/assets/js/40.a6c3be0f.js" as="script"><link rel="prefetch" href="/assets/js/10.08f53c0a.js"><link rel="prefetch" href="/assets/js/11.852fe533.js"><link rel="prefetch" href="/assets/js/12.387441d1.js"><link rel="prefetch" href="/assets/js/13.026b2d2d.js"><link rel="prefetch" href="/assets/js/14.234e0442.js"><link rel="prefetch" href="/assets/js/15.05982601.js"><link rel="prefetch" href="/assets/js/16.6ddb7b54.js"><link rel="prefetch" href="/assets/js/17.c8e27348.js"><link rel="prefetch" href="/assets/js/18.bea8b7b8.js"><link rel="prefetch" href="/assets/js/19.8032166c.js"><link rel="prefetch" href="/assets/js/20.e8575946.js"><link rel="prefetch" href="/assets/js/21.78fb8e90.js"><link rel="prefetch" href="/assets/js/22.1d33cf5f.js"><link rel="prefetch" href="/assets/js/23.7b04bc71.js"><link rel="prefetch" href="/assets/js/24.e2b60efb.js"><link rel="prefetch" href="/assets/js/25.5d5a4485.js"><link rel="prefetch" href="/assets/js/26.8173389b.js"><link rel="prefetch" href="/assets/js/27.b71f4454.js"><link rel="prefetch" href="/assets/js/28.e1ca4b97.js"><link rel="prefetch" href="/assets/js/29.929be50a.js"><link rel="prefetch" href="/assets/js/3.df829fda.js"><link rel="prefetch" href="/assets/js/30.7e96e268.js"><link rel="prefetch" href="/assets/js/31.c0e69237.js"><link rel="prefetch" href="/assets/js/32.7a31538c.js"><link rel="prefetch" href="/assets/js/33.9f9fcbee.js"><link rel="prefetch" href="/assets/js/34.1a23bcc8.js"><link rel="prefetch" href="/assets/js/35.d646c169.js"><link rel="prefetch" href="/assets/js/36.23fde348.js"><link rel="prefetch" href="/assets/js/37.72568f5d.js"><link rel="prefetch" href="/assets/js/38.c16df410.js"><link rel="prefetch" href="/assets/js/39.beaf8a5b.js"><link rel="prefetch" href="/assets/js/4.af196e2c.js"><link rel="prefetch" href="/assets/js/41.55dcf4c0.js"><link rel="prefetch" href="/assets/js/42.194c1906.js"><link rel="prefetch" href="/assets/js/43.23218e8b.js"><link rel="prefetch" href="/assets/js/44.d7674f0c.js"><link rel="prefetch" href="/assets/js/45.98b149c7.js"><link rel="prefetch" href="/assets/js/46.b5d5ec9d.js"><link rel="prefetch" href="/assets/js/47.b3a38716.js"><link rel="prefetch" href="/assets/js/48.ea0a7e3f.js"><link rel="prefetch" href="/assets/js/5.18feaa6c.js"><link rel="prefetch" href="/assets/js/6.7e6925c7.js"><link rel="prefetch" href="/assets/js/7.1b7a5d04.js"><link rel="prefetch" href="/assets/js/8.f363ac78.js"><link rel="prefetch" href="/assets/js/9.61f6ba62.js">
    <link rel="stylesheet" href="/assets/css/0.styles.84203ac8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">潇淼文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/Hcat.html" class="nav-link">
  联系我们
</a></div><div class="nav-item"><a href="/about.html" class="nav-link">
  关于
</a></div><div class="nav-item"><a href="http://xor.hcat.work/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  XOR加密
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/Hcat.html" class="nav-link">
  联系我们
</a></div><div class="nav-item"><a href="/about.html" class="nav-link">
  关于
</a></div><div class="nav-item"><a href="http://xor.hcat.work/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  XOR加密
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/" aria-current="page" class="sidebar-link">首页</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>基本要素</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Lua脚本</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Lua/2048.html" class="sidebar-link">Game 2048</a></li><li><a href="/Lua/void.html" class="sidebar-link">不那么仁慈的虚空</a></li><li><a href="/Lua/zfdm.html" class="sidebar-link">争分夺秒</a></li><li><a href="/Lua/tankx.html" class="sidebar-link">坦克对战</a></li><li><a href="/Lua/Stone_code.html" aria-current="page" class="active sidebar-link">Stone Code</a></li><li><a href="/Lua/Gomoku.html" class="sidebar-link">五子棋（Gomoku）</a></li><li><a href="/Lua/fight_for_gold_bricks.html" class="sidebar-link">夺金之战（Fight for Gold Bricks）</a></li><li><a href="/Lua/example.html" class="sidebar-link">示例整合Examples collection</a></li><li><a href="/Lua/Mini_Fast_Food_Restaurant.html" class="sidebar-link">迷你快餐店（Mini Fast Food Restaurant）</a></li><li><a href="/Lua/color_fight.html" class="sidebar-link">好色之途（Color Fight）</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>拓展元素</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>商业化[圈钱]</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>游戏全局数据表</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="stone-code"><a href="#stone-code" class="header-anchor">#</a> Stone Code</h1> <div class="language-lua extra-class"><pre class="language-lua"><code><span class="token keyword">local</span> Chat <span class="token operator">=</span> class<span class="token punctuation">.</span>Chat<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">local</span> Player <span class="token operator">=</span> class<span class="token punctuation">.</span>Player<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">local</span> Backpack <span class="token operator">=</span> class<span class="token punctuation">.</span>Backpack<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">local</span> Block <span class="token operator">=</span> class<span class="token punctuation">.</span>Block<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">local</span> World <span class="token operator">=</span> class<span class="token punctuation">.</span>World<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">local</span> WorldContainer <span class="token operator">=</span> class<span class="token punctuation">.</span>WorldContainer<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">local</span> Trigger <span class="token operator">=</span> class<span class="token punctuation">.</span>Trigger<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">local</span> TItem <span class="token operator">=</span> Trigger<span class="token punctuation">.</span>Item
<span class="token comment">--TESTING--</span>
<span class="token keyword">local</span> isDebug <span class="token operator">=</span> <span class="token keyword">false</span> <span class="token comment">--Do not commit true --</span>
<span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">DEBUG</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span>
    <span class="token keyword">if</span> isDebug <span class="token keyword">then</span>
        Chat<span class="token punctuation">:</span><span class="token function">sendChat</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span>
    <span class="token keyword">end</span>
<span class="token keyword">end</span>
<span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">sendSystemMsg</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span>
    Chat<span class="token punctuation">:</span><span class="token function">sendSystemMsg</span><span class="token punctuation">(</span>text<span class="token operator">..</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span>
<span class="token keyword">end</span>
<span class="token comment">--END--</span>

<span class="token comment">--Const def</span>
<span class="token keyword">local</span> SEPARATE_DISTANCE <span class="token operator">=</span> <span class="token number">2</span>
<span class="token keyword">local</span> BLOCK_AIR <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">local</span> BLOCK_ACTIVE <span class="token operator">=</span> <span class="token number">415</span>
<span class="token keyword">local</span> BLOCK_NORMAL <span class="token operator">=</span> <span class="token number">667</span>
<span class="token keyword">local</span> BLOCK_FLOOR <span class="token operator">=</span> <span class="token number">503</span>
<span class="token keyword">local</span> BLOCK_ERROR <span class="token operator">=</span> <span class="token number">681</span>
<span class="token keyword">local</span> BLOCK_SWITCH <span class="token operator">=</span> <span class="token number">724</span>
<span class="token keyword">local</span> BLOCK_BOX <span class="token operator">=</span> <span class="token number">801</span>
<span class="token keyword">local</span> BLOCK_ANSWER <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">671</span><span class="token punctuation">,</span> <span class="token number">672</span> <span class="token punctuation">}</span>
<span class="token keyword">local</span> DATA_ANSWER <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">8</span> <span class="token punctuation">}</span>
<span class="token keyword">local</span> ERROR_TIME <span class="token operator">=</span> <span class="token number">2</span>
<span class="token keyword">local</span> TOOLS_ID_SEPARATE <span class="token operator">=</span> <span class="token number">4112</span>
<span class="token keyword">local</span> TOOLS_ID_DYE <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">4111</span><span class="token punctuation">,</span> <span class="token number">4113</span> <span class="token punctuation">}</span>
<span class="token keyword">local</span> TOOLS_ID_DIG <span class="token operator">=</span> <span class="token number">4114</span>
<span class="token keyword">local</span> TOOLS_STRING <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token punctuation">{</span> id <span class="token operator">=</span> <span class="token number">4097</span> <span class="token punctuation">,</span> string <span class="token operator">=</span> <span class="token string">&quot;Dyeing Gun-Yellow:Dye the stone yellow. &quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> id <span class="token operator">=</span> <span class="token number">4098</span> <span class="token punctuation">,</span> string <span class="token operator">=</span> <span class="token string">&quot;Dyeing Gun-Brown:Dye the stone brown. &quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> id <span class="token operator">=</span> <span class="token number">4099</span> <span class="token punctuation">,</span> string <span class="token operator">=</span> <span class="token string">&quot;Separating Gun:Separate multiple connected stones. &quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> id <span class="token operator">=</span> <span class="token number">4101</span> <span class="token punctuation">,</span> string <span class="token operator">=</span> <span class="token string">&quot;Destroying Gun:Break the extra stones. &quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">local</span> ALLOWED_ITEMS <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token number">12963</span><span class="token punctuation">,</span> <span class="token number">12550</span><span class="token punctuation">,</span> <span class="token number">12003</span><span class="token punctuation">,</span> <span class="token number">12050</span><span class="token punctuation">,</span> <span class="token number">12574</span><span class="token punctuation">,</span> <span class="token number">4100</span><span class="token punctuation">,</span>
    TOOLS_ID_SEPARATE<span class="token punctuation">,</span> TOOLS_ID_DYE<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> TOOLS_ID_DYE<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> TOOLS_ID_DIG<span class="token punctuation">,</span> <span class="token punctuation">}</span>
<span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">POSITION</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">{</span> x <span class="token operator">=</span> x<span class="token punctuation">,</span> y <span class="token operator">=</span> y<span class="token punctuation">,</span> z <span class="token operator">=</span> z <span class="token punctuation">}</span> <span class="token keyword">end</span>
<span class="token keyword">local</span> LEVEL_CONFIG <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token punctuation">{</span>
        <span class="token comment">--1</span>
        PUZZLE <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token function">POSITION</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">51</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">POSITION</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">51</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        ANSWER <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token function">POSITION</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">39</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">POSITION</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">39</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        RESET <span class="token operator">=</span> <span class="token punctuation">{</span> POS <span class="token operator">=</span> <span class="token function">POSITION</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        REWARD <span class="token operator">=</span> <span class="token punctuation">{</span> POS <span class="token operator">=</span> <span class="token function">POSITION</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">53</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ID <span class="token operator">=</span> <span class="token number">12963</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token comment">--2</span>
        PUZZLE <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token function">POSITION</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">POSITION</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">56</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        ANSWER <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token function">POSITION</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">POSITION</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">34</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        RESET <span class="token operator">=</span> <span class="token punctuation">{</span> POS <span class="token operator">=</span> <span class="token function">POSITION</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">63</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        REWARD <span class="token operator">=</span> <span class="token punctuation">{</span> POS <span class="token operator">=</span> <span class="token function">POSITION</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">58</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ID <span class="token operator">=</span> <span class="token number">12550</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token comment">--3</span>
        PUZZLE <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token function">POSITION</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">59</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">POSITION</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">57</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        ANSWER <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token function">POSITION</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">39</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">POSITION</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        RESET <span class="token operator">=</span> <span class="token punctuation">{</span> POS <span class="token operator">=</span> <span class="token function">POSITION</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">62</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        REWARD <span class="token operator">=</span> <span class="token punctuation">{</span> POS <span class="token operator">=</span> <span class="token function">POSITION</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ID <span class="token operator">=</span> <span class="token number">12003</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token comment">--4</span>
        PUZZLE <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token function">POSITION</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">51</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">POSITION</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">51</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        ANSWER <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token function">POSITION</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">POSITION</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        RESET <span class="token operator">=</span> <span class="token punctuation">{</span> POS <span class="token operator">=</span> <span class="token function">POSITION</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        REWARD <span class="token operator">=</span> <span class="token punctuation">{</span> POS <span class="token operator">=</span> <span class="token function">POSITION</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ID <span class="token operator">=</span> <span class="token number">12050</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token comment">--5</span>
        PUZZLE <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token function">POSITION</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">78</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">POSITION</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">76</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        ANSWER <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token function">POSITION</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">78</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">POSITION</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">76</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        RESET <span class="token operator">=</span> <span class="token punctuation">{</span> POS <span class="token operator">=</span> <span class="token function">POSITION</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">89</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        REWARD <span class="token operator">=</span> <span class="token punctuation">{</span> POS <span class="token operator">=</span> <span class="token function">POSITION</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">89</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ID <span class="token operator">=</span> <span class="token number">12574</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token comment">--6</span>
        PUZZLE <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token function">POSITION</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">112</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">48</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">POSITION</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">107</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">45</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        ANSWER <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token function">POSITION</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">111</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">46</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">POSITION</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">106</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">43</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        RESET <span class="token operator">=</span> <span class="token punctuation">{</span> POS <span class="token operator">=</span> <span class="token function">POSITION</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">129</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">22</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        MONSTER <span class="token operator">=</span> <span class="token punctuation">{</span>
            POS <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token function">POSITION</span><span class="token punctuation">(</span> <span class="token operator">-</span><span class="token number">135</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">20</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">POSITION</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">135</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">71</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token function">POSITION</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">84</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">71</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">POSITION</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">84</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            ID <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> NUM <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        TRANSFER <span class="token operator">=</span> <span class="token punctuation">{</span> POS <span class="token operator">=</span> <span class="token function">POSITION</span><span class="token punctuation">(</span> <span class="token operator">-</span><span class="token number">129</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">26</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        REWARD <span class="token operator">=</span> <span class="token punctuation">{</span> POS <span class="token operator">=</span> <span class="token function">POSITION</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">110</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">45</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ID <span class="token operator">=</span> <span class="token number">4100</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token comment">--7 Ostrich</span>
        PUZZLE <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token function">POSITION</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">49</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">POSITION</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">47</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        ANSWER <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token function">POSITION</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">POSITION</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">48</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        RESET <span class="token operator">=</span> <span class="token punctuation">{</span> POS <span class="token operator">=</span> <span class="token function">POSITION</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">45</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        MONSTER <span class="token operator">=</span> <span class="token punctuation">{</span>
            POS <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token function">POSITION</span><span class="token punctuation">(</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">39</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">POSITION</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">39</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token function">POSITION</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">57</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">POSITION</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">57</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            ID <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> NUM <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        TRANSFER <span class="token operator">=</span> <span class="token punctuation">{</span> POS <span class="token operator">=</span> <span class="token function">POSITION</span><span class="token punctuation">(</span> <span class="token operator">-</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">48</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        REWARD <span class="token operator">=</span> <span class="token punctuation">{</span> POS <span class="token operator">=</span> <span class="token function">POSITION</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">48</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ID <span class="token operator">=</span> <span class="token number">4100</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token comment">--8</span>
        PUZZLE <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token function">POSITION</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">51</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">45</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">POSITION</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">44</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">43</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        ANSWER <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token function">POSITION</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">53</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">45</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">POSITION</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">46</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">43</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        RESET <span class="token operator">=</span> <span class="token punctuation">{</span> POS <span class="token operator">=</span> <span class="token function">POSITION</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">71</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">43</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        MONSTER <span class="token operator">=</span> <span class="token punctuation">{</span>
            POS <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token function">POSITION</span><span class="token punctuation">(</span> <span class="token operator">-</span><span class="token number">34</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">58</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">POSITION</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">61</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">58</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token function">POSITION</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">61</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">31</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">POSITION</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">34</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">31</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            ID <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span> NUM <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        TRANSFER <span class="token operator">=</span> <span class="token punctuation">{</span> POS <span class="token operator">=</span> <span class="token function">POSITION</span><span class="token punctuation">(</span> <span class="token operator">-</span><span class="token number">71</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">45</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        REWARD <span class="token operator">=</span> <span class="token punctuation">{</span> POS <span class="token operator">=</span> <span class="token function">POSITION</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">44</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ID <span class="token operator">=</span> <span class="token number">4100</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">local</span> errorPoints <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">local</span> areas <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">local</span> ID_prompts <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token punctuation">{</span>
        <span class="token punctuation">{</span>
            <span class="token number">3989</span><span class="token punctuation">,</span> <span class="token number">3988</span><span class="token punctuation">,</span> <span class="token number">3987</span><span class="token punctuation">,</span> <span class="token number">3986</span><span class="token punctuation">,</span> <span class="token number">3985</span><span class="token punctuation">,</span> <span class="token number">3984</span><span class="token punctuation">,</span> <span class="token number">3983</span><span class="token punctuation">,</span> <span class="token number">3982</span><span class="token punctuation">,</span> <span class="token number">3981</span><span class="token punctuation">,</span> <span class="token number">3979</span><span class="token punctuation">,</span> <span class="token number">3978</span><span class="token punctuation">,</span> <span class="token number">3977</span><span class="token punctuation">,</span>
            <span class="token number">3976</span><span class="token punctuation">,</span> <span class="token number">3975</span><span class="token punctuation">,</span> <span class="token number">3974</span><span class="token punctuation">,</span> <span class="token number">3973</span><span class="token punctuation">,</span> <span class="token number">3972</span><span class="token punctuation">,</span> <span class="token number">3969</span><span class="token punctuation">,</span> <span class="token number">3968</span><span class="token punctuation">,</span> <span class="token number">3967</span><span class="token punctuation">,</span> <span class="token number">3966</span><span class="token punctuation">,</span> <span class="token number">3965</span><span class="token punctuation">,</span> <span class="token number">3964</span><span class="token punctuation">,</span> <span class="token number">3963</span><span class="token punctuation">,</span>
            zero <span class="token operator">=</span> <span class="token number">3990</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token number">3961</span><span class="token punctuation">,</span> <span class="token number">3960</span><span class="token punctuation">,</span> <span class="token number">3959</span><span class="token punctuation">,</span> <span class="token number">3958</span><span class="token punctuation">,</span> <span class="token number">3957</span><span class="token punctuation">,</span> <span class="token number">3956</span><span class="token punctuation">,</span> <span class="token number">3955</span><span class="token punctuation">,</span> <span class="token number">3954</span><span class="token punctuation">,</span> <span class="token number">3953</span><span class="token punctuation">,</span> <span class="token number">3951</span><span class="token punctuation">,</span> <span class="token number">3950</span><span class="token punctuation">,</span> <span class="token number">3949</span><span class="token punctuation">,</span>
            <span class="token number">3948</span><span class="token punctuation">,</span> <span class="token number">3947</span><span class="token punctuation">,</span> <span class="token number">3946</span><span class="token punctuation">,</span> <span class="token number">3945</span><span class="token punctuation">,</span> <span class="token number">3944</span><span class="token punctuation">,</span> <span class="token number">3941</span><span class="token punctuation">,</span> <span class="token number">3940</span><span class="token punctuation">,</span> <span class="token number">3939</span><span class="token punctuation">,</span> <span class="token number">3938</span><span class="token punctuation">,</span> <span class="token number">3937</span><span class="token punctuation">,</span> <span class="token number">3936</span><span class="token punctuation">,</span> <span class="token number">3935</span><span class="token punctuation">,</span>
            zero <span class="token operator">=</span> <span class="token number">3962</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token punctuation">{</span>
            <span class="token number">3894</span><span class="token punctuation">,</span> <span class="token number">3893</span><span class="token punctuation">,</span> <span class="token number">3892</span><span class="token punctuation">,</span> <span class="token number">3891</span><span class="token punctuation">,</span> <span class="token number">3890</span><span class="token punctuation">,</span> <span class="token number">3889</span><span class="token punctuation">,</span> <span class="token number">3888</span><span class="token punctuation">,</span> <span class="token number">3887</span><span class="token punctuation">,</span> <span class="token number">3886</span><span class="token punctuation">,</span> <span class="token number">3878</span><span class="token punctuation">,</span> <span class="token number">3880</span><span class="token punctuation">,</span> <span class="token number">3879</span><span class="token punctuation">,</span>
            <span class="token number">3881</span><span class="token punctuation">,</span> <span class="token number">3882</span><span class="token punctuation">,</span> <span class="token number">3883</span><span class="token punctuation">,</span> <span class="token number">3884</span><span class="token punctuation">,</span> <span class="token number">3885</span><span class="token punctuation">,</span> <span class="token number">3877</span><span class="token punctuation">,</span> <span class="token number">3876</span><span class="token punctuation">,</span> <span class="token number">3875</span><span class="token punctuation">,</span> <span class="token number">3874</span><span class="token punctuation">,</span> <span class="token number">3873</span><span class="token punctuation">,</span> <span class="token number">3872</span><span class="token punctuation">,</span> <span class="token number">3871</span><span class="token punctuation">,</span>
            zero <span class="token operator">=</span> <span class="token number">3870</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token number">3868</span><span class="token punctuation">,</span> <span class="token number">3867</span><span class="token punctuation">,</span> <span class="token number">3866</span><span class="token punctuation">,</span> <span class="token number">3865</span><span class="token punctuation">,</span> <span class="token number">3864</span><span class="token punctuation">,</span> <span class="token number">3863</span><span class="token punctuation">,</span> <span class="token number">3862</span><span class="token punctuation">,</span> <span class="token number">3861</span><span class="token punctuation">,</span> <span class="token number">3860</span><span class="token punctuation">,</span> <span class="token number">3852</span><span class="token punctuation">,</span> <span class="token number">3853</span><span class="token punctuation">,</span> <span class="token number">3854</span><span class="token punctuation">,</span>
            <span class="token number">3855</span><span class="token punctuation">,</span> <span class="token number">3856</span><span class="token punctuation">,</span> <span class="token number">3857</span><span class="token punctuation">,</span> <span class="token number">3858</span><span class="token punctuation">,</span> <span class="token number">3859</span><span class="token punctuation">,</span> <span class="token number">3851</span><span class="token punctuation">,</span> <span class="token number">3850</span><span class="token punctuation">,</span> <span class="token number">3849</span><span class="token punctuation">,</span> <span class="token number">3848</span><span class="token punctuation">,</span> <span class="token number">3847</span><span class="token punctuation">,</span> <span class="token number">3846</span><span class="token punctuation">,</span> <span class="token number">3845</span><span class="token punctuation">,</span>
            zero <span class="token operator">=</span> <span class="token number">3869</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token punctuation">{</span>
            <span class="token number">3999</span><span class="token punctuation">,</span> <span class="token number">3998</span><span class="token punctuation">,</span> <span class="token number">3997</span><span class="token punctuation">,</span> <span class="token number">3996</span><span class="token punctuation">,</span> <span class="token number">3995</span><span class="token punctuation">,</span> <span class="token number">3994</span><span class="token punctuation">,</span> <span class="token number">3993</span><span class="token punctuation">,</span> <span class="token number">3992</span><span class="token punctuation">,</span> <span class="token number">3991</span><span class="token punctuation">,</span> <span class="token number">3934</span><span class="token punctuation">,</span> <span class="token number">3933</span><span class="token punctuation">,</span> <span class="token number">3932</span><span class="token punctuation">,</span>
            <span class="token number">3931</span><span class="token punctuation">,</span> <span class="token number">3930</span><span class="token punctuation">,</span> <span class="token number">3929</span><span class="token punctuation">,</span> <span class="token number">3928</span><span class="token punctuation">,</span> <span class="token number">3927</span><span class="token punctuation">,</span> <span class="token number">3926</span><span class="token punctuation">,</span> <span class="token number">3925</span><span class="token punctuation">,</span> <span class="token number">3924</span><span class="token punctuation">,</span> <span class="token number">3923</span><span class="token punctuation">,</span> <span class="token number">3922</span><span class="token punctuation">,</span> <span class="token number">3921</span><span class="token punctuation">,</span> <span class="token number">3920</span><span class="token punctuation">,</span>
            zero <span class="token operator">=</span> <span class="token number">4000</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token number">3918</span><span class="token punctuation">,</span> <span class="token number">3917</span><span class="token punctuation">,</span> <span class="token number">3916</span><span class="token punctuation">,</span> <span class="token number">3915</span><span class="token punctuation">,</span> <span class="token number">3914</span><span class="token punctuation">,</span> <span class="token number">3913</span><span class="token punctuation">,</span> <span class="token number">3912</span><span class="token punctuation">,</span> <span class="token number">3911</span><span class="token punctuation">,</span> <span class="token number">3910</span><span class="token punctuation">,</span> <span class="token number">3909</span><span class="token punctuation">,</span> <span class="token number">3908</span><span class="token punctuation">,</span> <span class="token number">3907</span><span class="token punctuation">,</span>
            <span class="token number">3906</span><span class="token punctuation">,</span> <span class="token number">3905</span><span class="token punctuation">,</span> <span class="token number">3904</span><span class="token punctuation">,</span> <span class="token number">3903</span><span class="token punctuation">,</span> <span class="token number">3902</span><span class="token punctuation">,</span> <span class="token number">3901</span><span class="token punctuation">,</span> <span class="token number">3900</span><span class="token punctuation">,</span> <span class="token number">3899</span><span class="token punctuation">,</span> <span class="token number">3898</span><span class="token punctuation">,</span> <span class="token number">3897</span><span class="token punctuation">,</span> <span class="token number">3896</span><span class="token punctuation">,</span> <span class="token number">3895</span><span class="token punctuation">,</span>
            zero <span class="token operator">=</span> <span class="token number">3919</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    max <span class="token operator">=</span> <span class="token number">4000</span><span class="token punctuation">,</span> min <span class="token operator">=</span> <span class="token number">3845</span>
<span class="token punctuation">}</span>
<span class="token comment">--Const end</span>

<span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">isPrompt</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">#</span>ID_prompts <span class="token keyword">do</span>
        <span class="token keyword">local</span> side <span class="token operator">=</span> ID_prompts<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        <span class="token keyword">for</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">#</span>side <span class="token keyword">do</span>
            <span class="token keyword">local</span> color <span class="token operator">=</span> side<span class="token punctuation">[</span>j<span class="token punctuation">]</span>
            <span class="token keyword">if</span> color<span class="token punctuation">.</span>zero <span class="token operator">==</span> id <span class="token keyword">then</span>
                <span class="token keyword">return</span> i
            <span class="token keyword">end</span>
            <span class="token keyword">for</span> k <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">#</span>color <span class="token keyword">do</span>
                <span class="token keyword">if</span> color<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">==</span> id <span class="token keyword">then</span>
                    <span class="token keyword">return</span> i
                <span class="token keyword">end</span>
            <span class="token keyword">end</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>
    <span class="token keyword">return</span> <span class="token number">0</span>
<span class="token keyword">end</span>

<span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">isInclude</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> _table<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> _table <span class="token keyword">then</span>
        <span class="token keyword">return</span>
    <span class="token keyword">end</span>
    <span class="token keyword">for</span> k<span class="token punctuation">,</span>v <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>_table<span class="token punctuation">)</span> <span class="token keyword">do</span>
        <span class="token keyword">if</span> v <span class="token operator">==</span> value <span class="token keyword">then</span>
            <span class="token keyword">return</span> <span class="token keyword">true</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>
    <span class="token keyword">return</span> <span class="token keyword">false</span>
<span class="token keyword">end</span>

<span class="token keyword">function</span> <span class="token function">updateAreaFlats</span><span class="token punctuation">(</span>area<span class="token punctuation">)</span>
    <span class="token keyword">local</span> p1 <span class="token operator">=</span> area<span class="token punctuation">.</span>curPos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token keyword">local</span> p2 <span class="token operator">=</span> area<span class="token punctuation">.</span>curPos<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>

    area<span class="token punctuation">.</span>flats <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    table<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>area<span class="token punctuation">.</span>flats<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token function">POSITION</span><span class="token punctuation">(</span>p1<span class="token punctuation">.</span>x<span class="token punctuation">,</span> p2<span class="token punctuation">.</span>y<span class="token punctuation">,</span> p2<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">POSITION</span><span class="token punctuation">(</span>p1<span class="token punctuation">.</span>x<span class="token punctuation">,</span> p1<span class="token punctuation">.</span>y<span class="token punctuation">,</span> p1<span class="token punctuation">.</span>z<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    table<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>area<span class="token punctuation">.</span>flats<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token function">POSITION</span><span class="token punctuation">(</span>p2<span class="token punctuation">.</span>x<span class="token punctuation">,</span> p2<span class="token punctuation">.</span>y<span class="token punctuation">,</span> p2<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">POSITION</span><span class="token punctuation">(</span>p2<span class="token punctuation">.</span>x<span class="token punctuation">,</span> p1<span class="token punctuation">.</span>y<span class="token punctuation">,</span> p1<span class="token punctuation">.</span>z<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    table<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>area<span class="token punctuation">.</span>flats<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token function">POSITION</span><span class="token punctuation">(</span>p2<span class="token punctuation">.</span>x<span class="token punctuation">,</span> p2<span class="token punctuation">.</span>y<span class="token punctuation">,</span> p1<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">POSITION</span><span class="token punctuation">(</span>p1<span class="token punctuation">.</span>x<span class="token punctuation">,</span> p1<span class="token punctuation">.</span>y<span class="token punctuation">,</span> p1<span class="token punctuation">.</span>z<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    table<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>area<span class="token punctuation">.</span>flats<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token function">POSITION</span><span class="token punctuation">(</span>p2<span class="token punctuation">.</span>x<span class="token punctuation">,</span> p2<span class="token punctuation">.</span>y<span class="token punctuation">,</span> p2<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">POSITION</span><span class="token punctuation">(</span>p1<span class="token punctuation">.</span>x<span class="token punctuation">,</span> p1<span class="token punctuation">.</span>y<span class="token punctuation">,</span> p2<span class="token punctuation">.</span>z<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    table<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>area<span class="token punctuation">.</span>flats<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token function">POSITION</span><span class="token punctuation">(</span>p1<span class="token punctuation">.</span>x<span class="token punctuation">,</span> p1<span class="token punctuation">.</span>y<span class="token punctuation">,</span> p1<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">POSITION</span><span class="token punctuation">(</span>p2<span class="token punctuation">.</span>x<span class="token punctuation">,</span> p1<span class="token punctuation">.</span>y<span class="token punctuation">,</span> p2<span class="token punctuation">.</span>z<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    table<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>area<span class="token punctuation">.</span>flats<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token function">POSITION</span><span class="token punctuation">(</span>p2<span class="token punctuation">.</span>x<span class="token punctuation">,</span> p2<span class="token punctuation">.</span>y<span class="token punctuation">,</span> p2<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">POSITION</span><span class="token punctuation">(</span>p1<span class="token punctuation">.</span>x<span class="token punctuation">,</span> p2<span class="token punctuation">.</span>y<span class="token punctuation">,</span> p1<span class="token punctuation">.</span>z<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token keyword">function</span> <span class="token function">updateAreaSize</span><span class="token punctuation">(</span>area<span class="token punctuation">)</span>
    <span class="token keyword">local</span> p1 <span class="token operator">=</span> area<span class="token punctuation">.</span>curPos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token keyword">local</span> p2 <span class="token operator">=</span> area<span class="token punctuation">.</span>curPos<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>

    area<span class="token punctuation">.</span>size <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    area<span class="token punctuation">.</span>size<span class="token punctuation">.</span>length <span class="token operator">=</span> math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>p1<span class="token punctuation">.</span>x <span class="token operator">-</span> p2<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>
    area<span class="token punctuation">.</span>size<span class="token punctuation">.</span>width <span class="token operator">=</span> math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>p1<span class="token punctuation">.</span>z <span class="token operator">-</span> p2<span class="token punctuation">.</span>z<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>
    area<span class="token punctuation">.</span>size<span class="token punctuation">.</span>height <span class="token operator">=</span> math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>p1<span class="token punctuation">.</span>y <span class="token operator">-</span> p2<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>
<span class="token keyword">end</span>

<span class="token keyword">function</span> <span class="token function">getAnswerID</span><span class="token punctuation">(</span>area<span class="token punctuation">)</span>
    <span class="token keyword">local</span> answer <span class="token operator">=</span> area<span class="token punctuation">.</span>answer
    area<span class="token punctuation">.</span>ids <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">for</span> y <span class="token operator">=</span> answer<span class="token punctuation">.</span>curPos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">,</span> answer<span class="token punctuation">.</span>curPos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token operator">+</span>answer<span class="token punctuation">.</span>size<span class="token punctuation">.</span>height<span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">do</span>
        <span class="token keyword">for</span> x <span class="token operator">=</span> answer<span class="token punctuation">.</span>curPos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span> answer<span class="token punctuation">.</span>curPos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token operator">+</span>answer<span class="token punctuation">.</span>size<span class="token punctuation">.</span>length<span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">do</span>
            <span class="token keyword">for</span> z <span class="token operator">=</span> answer<span class="token punctuation">.</span>curPos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>z<span class="token punctuation">,</span> answer<span class="token punctuation">.</span>curPos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>z<span class="token operator">+</span>answer<span class="token punctuation">.</span>size<span class="token punctuation">.</span>width<span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">do</span>
                <span class="token keyword">local</span> ret<span class="token punctuation">,</span> id <span class="token operator">=</span> Block<span class="token punctuation">:</span><span class="token function">getBlockID</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">)</span>
                <span class="token keyword">if</span> id <span class="token operator">~=</span> <span class="token number">0</span> <span class="token keyword">and</span> <span class="token keyword">not</span> <span class="token function">isInclude</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> area<span class="token punctuation">.</span>ids<span class="token punctuation">)</span> <span class="token keyword">then</span>
                    table<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>area<span class="token punctuation">.</span>ids<span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">end</span>
            <span class="token keyword">end</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>
<span class="token keyword">end</span>

<span class="token keyword">function</span> <span class="token function">cheat</span><span class="token punctuation">(</span>area<span class="token punctuation">)</span>
    <span class="token keyword">local</span> puzzle <span class="token operator">=</span> area<span class="token punctuation">.</span>puzzle
    <span class="token keyword">for</span> y <span class="token operator">=</span> puzzle<span class="token punctuation">.</span>curPos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">,</span> puzzle<span class="token punctuation">.</span>curPos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token operator">+</span>puzzle<span class="token punctuation">.</span>size<span class="token punctuation">.</span>height<span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">do</span>
        <span class="token keyword">for</span> x <span class="token operator">=</span> puzzle<span class="token punctuation">.</span>curPos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span> puzzle<span class="token punctuation">.</span>curPos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token operator">+</span>puzzle<span class="token punctuation">.</span>size<span class="token punctuation">.</span>length<span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">do</span>
            <span class="token keyword">for</span> z <span class="token operator">=</span> puzzle<span class="token punctuation">.</span>curPos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>z<span class="token punctuation">,</span> puzzle<span class="token punctuation">.</span>curPos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>z<span class="token operator">+</span>puzzle<span class="token punctuation">.</span>size<span class="token punctuation">.</span>width<span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">do</span>
                <span class="token keyword">local</span> ret<span class="token punctuation">,</span> blockID <span class="token operator">=</span> Block<span class="token punctuation">:</span><span class="token function">getBlockID</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">)</span>
                <span class="token keyword">local</span> targetPoint <span class="token operator">=</span> <span class="token function">mapping</span><span class="token punctuation">(</span>area<span class="token punctuation">,</span> <span class="token function">POSITION</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">local</span> ret<span class="token punctuation">,</span> targetID <span class="token operator">=</span> Block<span class="token punctuation">:</span><span class="token function">getBlockID</span><span class="token punctuation">(</span>targetPoint<span class="token punctuation">.</span>x<span class="token punctuation">,</span> targetPoint<span class="token punctuation">.</span>y<span class="token punctuation">,</span> targetPoint<span class="token punctuation">.</span>z<span class="token punctuation">)</span>
                <span class="token keyword">if</span> blockID <span class="token operator">~=</span> targetID <span class="token keyword">then</span>
                    Block<span class="token punctuation">:</span><span class="token function">setBlockAll</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">,</span> targetID<span class="token punctuation">)</span>
                <span class="token keyword">end</span>
            <span class="token keyword">end</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>
    <span class="token function">checkCompletion</span><span class="token punctuation">(</span>area<span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token keyword">function</span> <span class="token function">checkCompletion</span><span class="token punctuation">(</span>area<span class="token punctuation">)</span>
    <span class="token keyword">if</span> area<span class="token punctuation">.</span>state <span class="token operator">==</span> <span class="token number">1</span> <span class="token keyword">then</span>
        <span class="token keyword">return</span>
    <span class="token keyword">end</span>
    <span class="token keyword">local</span> num <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">local</span> puzzle <span class="token operator">=</span> area<span class="token punctuation">.</span>puzzle
    <span class="token keyword">for</span> y <span class="token operator">=</span> puzzle<span class="token punctuation">.</span>curPos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">,</span> puzzle<span class="token punctuation">.</span>curPos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token operator">+</span>puzzle<span class="token punctuation">.</span>size<span class="token punctuation">.</span>height<span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">do</span>
        <span class="token keyword">for</span> x <span class="token operator">=</span> puzzle<span class="token punctuation">.</span>curPos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span> puzzle<span class="token punctuation">.</span>curPos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token operator">+</span>puzzle<span class="token punctuation">.</span>size<span class="token punctuation">.</span>length<span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">do</span>
            <span class="token keyword">for</span> z <span class="token operator">=</span> puzzle<span class="token punctuation">.</span>curPos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>z<span class="token punctuation">,</span> puzzle<span class="token punctuation">.</span>curPos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>z<span class="token operator">+</span>puzzle<span class="token punctuation">.</span>size<span class="token punctuation">.</span>width<span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">do</span>
                <span class="token keyword">local</span> ret<span class="token punctuation">,</span> id <span class="token operator">=</span> Block<span class="token punctuation">:</span><span class="token function">getBlockID</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">)</span>
                <span class="token keyword">if</span> id <span class="token operator">==</span> BLOCK_NORMAL <span class="token keyword">or</span> id <span class="token operator">==</span> BLOCK_ERROR <span class="token keyword">then</span>
                    <span class="token keyword">return</span>
                <span class="token keyword">end</span>
            <span class="token keyword">end</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>
    <span class="token keyword">local</span> axes <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token string">'z'</span><span class="token punctuation">,</span> <span class="token string">'z'</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token function">hasSeparatePart</span><span class="token punctuation">(</span>area<span class="token punctuation">.</span>separation<span class="token punctuation">,</span> axes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">then</span>
        <span class="token keyword">local</span> history <span class="token operator">=</span> area<span class="token punctuation">.</span>separation<span class="token punctuation">.</span>history<span class="token punctuation">[</span>axes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>

        <span class="token keyword">if</span> history <span class="token keyword">then</span>
            <span class="token keyword">local</span> p1 <span class="token operator">=</span> puzzle<span class="token punctuation">.</span>flats<span class="token punctuation">[</span>history<span class="token punctuation">.</span>flatIndex<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
            <span class="token keyword">local</span> p2 <span class="token operator">=</span> puzzle<span class="token punctuation">.</span>flats<span class="token punctuation">[</span>history<span class="token punctuation">.</span>flatIndex<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
            <span class="token keyword">local</span> values <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span>
            <span class="token keyword">if</span> history<span class="token punctuation">.</span>num <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token keyword">then</span>
                <span class="token keyword">for</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> history<span class="token punctuation">.</span>num<span class="token operator">-</span><span class="token number">2</span> <span class="token keyword">do</span>
                    p1<span class="token punctuation">[</span>axes<span class="token punctuation">[</span>history<span class="token punctuation">.</span>dir<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> p1<span class="token punctuation">[</span>axes<span class="token punctuation">[</span>history<span class="token punctuation">.</span>dir<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">-</span> values<span class="token punctuation">[</span>history<span class="token punctuation">.</span>dir<span class="token punctuation">]</span>
                    p2<span class="token punctuation">[</span>axes<span class="token punctuation">[</span>history<span class="token punctuation">.</span>dir<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> p2<span class="token punctuation">[</span>axes<span class="token punctuation">[</span>history<span class="token punctuation">.</span>dir<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">-</span> values<span class="token punctuation">[</span>history<span class="token punctuation">.</span>dir<span class="token punctuation">]</span>
                <span class="token keyword">end</span>
            <span class="token keyword">end</span>
            <span class="token keyword">local</span> size <span class="token operator">=</span> <span class="token function">POSITION</span><span class="token punctuation">(</span>puzzle<span class="token punctuation">.</span>size<span class="token punctuation">.</span>length<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">,</span> puzzle<span class="token punctuation">.</span>size<span class="token punctuation">.</span>height<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">,</span> puzzle<span class="token punctuation">.</span>size<span class="token punctuation">.</span>width<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span>

            <span class="token function">move</span><span class="token punctuation">(</span><span class="token punctuation">{</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">}</span><span class="token punctuation">,</span> history<span class="token punctuation">.</span>dir<span class="token punctuation">,</span> history<span class="token punctuation">.</span>num<span class="token punctuation">,</span> size<span class="token punctuation">,</span> history<span class="token punctuation">.</span>vertex<span class="token punctuation">)</span>

            area<span class="token punctuation">.</span>separation<span class="token punctuation">.</span>times<span class="token punctuation">[</span>axes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
            area<span class="token punctuation">.</span>separation<span class="token punctuation">.</span>history<span class="token punctuation">[</span>axes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">nil</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>
    <span class="token keyword">if</span> <span class="token function">hasSeparatePart</span><span class="token punctuation">(</span>area<span class="token punctuation">.</span>separation<span class="token punctuation">,</span> axes<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">then</span>
        <span class="token keyword">local</span> history <span class="token operator">=</span> area<span class="token punctuation">.</span>separation<span class="token punctuation">.</span>history<span class="token punctuation">[</span>axes<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span>

        <span class="token keyword">if</span> history <span class="token keyword">then</span>
            <span class="token keyword">local</span> p1 <span class="token operator">=</span> puzzle<span class="token punctuation">.</span>flats<span class="token punctuation">[</span>history<span class="token punctuation">.</span>flatIndex<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
            <span class="token keyword">local</span> p2 <span class="token operator">=</span> puzzle<span class="token punctuation">.</span>flats<span class="token punctuation">[</span>history<span class="token punctuation">.</span>flatIndex<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
            <span class="token keyword">local</span> values <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span>
            <span class="token keyword">if</span> history<span class="token punctuation">.</span>num <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token keyword">then</span>
                <span class="token keyword">for</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> history<span class="token punctuation">.</span>num<span class="token operator">-</span><span class="token number">2</span> <span class="token keyword">do</span>
                    p1<span class="token punctuation">[</span>axes<span class="token punctuation">[</span>history<span class="token punctuation">.</span>dir<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> p1<span class="token punctuation">[</span>axes<span class="token punctuation">[</span>history<span class="token punctuation">.</span>dir<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">-</span> values<span class="token punctuation">[</span>history<span class="token punctuation">.</span>dir<span class="token punctuation">]</span>
                    p2<span class="token punctuation">[</span>axes<span class="token punctuation">[</span>history<span class="token punctuation">.</span>dir<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> p2<span class="token punctuation">[</span>axes<span class="token punctuation">[</span>history<span class="token punctuation">.</span>dir<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">-</span> values<span class="token punctuation">[</span>history<span class="token punctuation">.</span>dir<span class="token punctuation">]</span>
                <span class="token keyword">end</span>
            <span class="token keyword">end</span>
            <span class="token keyword">local</span> size <span class="token operator">=</span> <span class="token function">POSITION</span><span class="token punctuation">(</span>puzzle<span class="token punctuation">.</span>size<span class="token punctuation">.</span>length<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">,</span> puzzle<span class="token punctuation">.</span>size<span class="token punctuation">.</span>height<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">,</span> puzzle<span class="token punctuation">.</span>size<span class="token punctuation">.</span>width<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span>

            <span class="token function">move</span><span class="token punctuation">(</span><span class="token punctuation">{</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">}</span><span class="token punctuation">,</span> history<span class="token punctuation">.</span>dir<span class="token punctuation">,</span> history<span class="token punctuation">.</span>num<span class="token punctuation">,</span> size<span class="token punctuation">,</span> history<span class="token punctuation">.</span>vertex<span class="token punctuation">)</span>

            area<span class="token punctuation">.</span>separation<span class="token punctuation">.</span>times<span class="token punctuation">[</span>axes<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
            area<span class="token punctuation">.</span>separation<span class="token punctuation">.</span>history<span class="token punctuation">[</span>axes<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">nil</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>
    <span class="token function">updateAreaFlats</span><span class="token punctuation">(</span>puzzle<span class="token punctuation">)</span>
    <span class="token function">updateAreaSize</span><span class="token punctuation">(</span>puzzle<span class="token punctuation">)</span>
    <span class="token keyword">for</span> y <span class="token operator">=</span> puzzle<span class="token punctuation">.</span>curPos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">,</span> puzzle<span class="token punctuation">.</span>curPos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token operator">+</span>puzzle<span class="token punctuation">.</span>size<span class="token punctuation">.</span>height<span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">do</span>
        <span class="token keyword">for</span> x <span class="token operator">=</span> puzzle<span class="token punctuation">.</span>curPos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span> puzzle<span class="token punctuation">.</span>curPos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token operator">+</span>puzzle<span class="token punctuation">.</span>size<span class="token punctuation">.</span>length<span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">do</span>
            <span class="token keyword">for</span> z <span class="token operator">=</span> puzzle<span class="token punctuation">.</span>curPos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>z<span class="token punctuation">,</span> puzzle<span class="token punctuation">.</span>curPos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>z<span class="token operator">+</span>puzzle<span class="token punctuation">.</span>size<span class="token punctuation">.</span>width<span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">do</span>
                <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token function">verifySingleBlockInAnswerArea</span><span class="token punctuation">(</span>area<span class="token punctuation">,</span> <span class="token function">POSITION</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">then</span>
                    <span class="token keyword">return</span>
                <span class="token keyword">end</span>
            <span class="token keyword">end</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>
    <span class="token keyword">for</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">#</span>area<span class="token punctuation">.</span>answer<span class="token punctuation">.</span>flats <span class="token keyword">do</span>
        <span class="token function">cleanDigitalPrompt</span><span class="token punctuation">(</span>area<span class="token punctuation">,</span> area<span class="token punctuation">.</span>puzzle<span class="token punctuation">.</span>flats<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> j<span class="token punctuation">)</span>
    <span class="token keyword">end</span>
    <span class="token keyword">for</span> y <span class="token operator">=</span> puzzle<span class="token punctuation">.</span>curPos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">,</span> puzzle<span class="token punctuation">.</span>curPos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token operator">+</span>puzzle<span class="token punctuation">.</span>size<span class="token punctuation">.</span>height<span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">do</span>
        <span class="token keyword">for</span> x <span class="token operator">=</span> puzzle<span class="token punctuation">.</span>curPos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span> puzzle<span class="token punctuation">.</span>curPos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token operator">+</span>puzzle<span class="token punctuation">.</span>size<span class="token punctuation">.</span>length<span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">do</span>
            <span class="token keyword">for</span> z <span class="token operator">=</span> puzzle<span class="token punctuation">.</span>curPos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>z<span class="token punctuation">,</span> puzzle<span class="token punctuation">.</span>curPos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>z<span class="token operator">+</span>puzzle<span class="token punctuation">.</span>size<span class="token punctuation">.</span>width<span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">do</span>
                <span class="token keyword">local</span> ret<span class="token punctuation">,</span> id <span class="token operator">=</span> Block<span class="token punctuation">:</span><span class="token function">getBlockID</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">)</span>
                <span class="token keyword">if</span> <span class="token function">isPrompt</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token operator">~=</span> <span class="token number">0</span> <span class="token keyword">then</span>
                    Block<span class="token punctuation">:</span><span class="token function">setBlockAll</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">,</span> BLOCK_AIR<span class="token punctuation">)</span>
                <span class="token keyword">end</span>
            <span class="token keyword">end</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>

    <span class="token function">sendSystemMsg</span><span class="token punctuation">(</span><span class="token string">&quot;Congratulations! You have completed the mission and a new gift show up in the Storage Box. &quot;</span><span class="token punctuation">)</span>
    area<span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token number">1</span>

    <span class="token keyword">if</span> LEVEL_CONFIG<span class="token punctuation">[</span>area<span class="token punctuation">.</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>MONSTER <span class="token keyword">then</span>
        <span class="token function">generateMonster</span><span class="token punctuation">(</span>area<span class="token punctuation">)</span>
    <span class="token keyword">end</span>
    <span class="token keyword">if</span> LEVEL_CONFIG<span class="token punctuation">[</span>area<span class="token punctuation">.</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>TRANSFER <span class="token keyword">then</span>
        <span class="token keyword">local</span> tr <span class="token operator">=</span> LEVEL_CONFIG<span class="token punctuation">[</span>area<span class="token punctuation">.</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>TRANSFER<span class="token punctuation">.</span>POS
        Block<span class="token punctuation">:</span><span class="token function">setBlockAll</span><span class="token punctuation">(</span>tr<span class="token punctuation">.</span>x<span class="token punctuation">,</span> tr<span class="token punctuation">.</span>y<span class="token punctuation">,</span> tr<span class="token punctuation">.</span>z<span class="token punctuation">,</span> BLOCK_ACTIVE<span class="token punctuation">)</span>
        <span class="token function">sendSystemMsg</span><span class="token punctuation">(</span><span class="token string">&quot;A new portal is activated. &quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">end</span>

    <span class="token keyword">if</span> LEVEL_CONFIG<span class="token punctuation">[</span>area<span class="token punctuation">.</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>REWARD <span class="token keyword">then</span>
        <span class="token function">generateReward</span><span class="token punctuation">(</span>area<span class="token punctuation">)</span>
    <span class="token keyword">end</span>
<span class="token keyword">end</span>

<span class="token keyword">function</span> <span class="token function">generateMonster</span><span class="token punctuation">(</span>area<span class="token punctuation">)</span>
    <span class="token keyword">local</span> monster <span class="token operator">=</span> LEVEL_CONFIG<span class="token punctuation">[</span>area<span class="token punctuation">.</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>MONSTER
    <span class="token keyword">local</span> pos <span class="token operator">=</span> monster<span class="token punctuation">.</span>POS
    area<span class="token punctuation">.</span>monsterids <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">for</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">#</span>pos <span class="token keyword">do</span>
        <span class="token keyword">local</span> p <span class="token operator">=</span> pos<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        <span class="token keyword">local</span> ret<span class="token punctuation">,</span> objids <span class="token operator">=</span> World<span class="token punctuation">:</span><span class="token function">spawnCreature</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>x<span class="token punctuation">,</span> p<span class="token punctuation">.</span>y<span class="token punctuation">,</span> p<span class="token punctuation">.</span>z<span class="token punctuation">,</span> monster<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> monster<span class="token punctuation">.</span>NUM<span class="token punctuation">)</span>
        <span class="token keyword">if</span> objids <span class="token keyword">then</span>
            table<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>area<span class="token punctuation">.</span>monsterids<span class="token punctuation">,</span> objids<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>
    <span class="token function">sendSystemMsg</span><span class="token punctuation">(</span><span class="token string">&quot;Crazy animals appear! Beat them! &quot;</span><span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token keyword">function</span> <span class="token function">generateReward</span><span class="token punctuation">(</span>area<span class="token punctuation">)</span>
    <span class="token keyword">local</span> reward <span class="token operator">=</span> LEVEL_CONFIG<span class="token punctuation">[</span>area<span class="token punctuation">.</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>REWARD
    <span class="token keyword">local</span> pos <span class="token operator">=</span> reward<span class="token punctuation">.</span>POS
    <span class="token keyword">local</span> ret<span class="token punctuation">,</span> id <span class="token operator">=</span> Block<span class="token punctuation">:</span><span class="token function">getBlockID</span><span class="token punctuation">(</span>pos<span class="token punctuation">.</span>x<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>y<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>z<span class="token punctuation">)</span>
    <span class="token keyword">if</span> id <span class="token operator">~=</span> BLOCK_BOX <span class="token keyword">then</span>
        Block<span class="token punctuation">:</span><span class="token function">setBlockAll</span><span class="token punctuation">(</span>pos<span class="token punctuation">.</span>x<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>y<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>z<span class="token punctuation">,</span> BLOCK_BOX<span class="token punctuation">)</span>
    <span class="token keyword">end</span>
    <span class="token keyword">local</span> ret<span class="token punctuation">,</span> itemCnt <span class="token operator">=</span> WorldContainer<span class="token punctuation">:</span><span class="token function">addItemToContainer</span><span class="token punctuation">(</span>pos<span class="token punctuation">.</span>x<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>y<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>z<span class="token punctuation">,</span> reward<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> ret <span class="token operator">==</span> ErrorCode<span class="token punctuation">.</span>OK <span class="token keyword">then</span>

    <span class="token keyword">end</span>
<span class="token keyword">end</span>

<span class="token keyword">function</span> <span class="token function">isInArea</span><span class="token punctuation">(</span>point<span class="token punctuation">,</span> area<span class="token punctuation">)</span>
    <span class="token keyword">local</span> curP1 <span class="token operator">=</span> area<span class="token punctuation">.</span>curPos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token keyword">local</span> curP2 <span class="token operator">=</span> area<span class="token punctuation">.</span>curPos<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> point<span class="token punctuation">.</span>x <span class="token operator">&gt;=</span> math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>curP1<span class="token punctuation">.</span>x<span class="token punctuation">,</span> curP2<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token keyword">and</span> point<span class="token punctuation">.</span>x <span class="token operator">&lt;=</span> math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>curP1<span class="token punctuation">.</span>x<span class="token punctuation">,</span> curP2<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token keyword">then</span>
        <span class="token keyword">if</span> point<span class="token punctuation">.</span>y <span class="token operator">&gt;=</span> math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>curP1<span class="token punctuation">.</span>y<span class="token punctuation">,</span> curP2<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token keyword">and</span> point<span class="token punctuation">.</span>y <span class="token operator">&lt;=</span> math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>curP1<span class="token punctuation">.</span>y<span class="token punctuation">,</span> curP2<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token keyword">then</span>
            <span class="token keyword">if</span> point<span class="token punctuation">.</span>z <span class="token operator">&gt;=</span> math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>curP1<span class="token punctuation">.</span>z<span class="token punctuation">,</span> curP2<span class="token punctuation">.</span>z<span class="token punctuation">)</span> <span class="token keyword">and</span> point<span class="token punctuation">.</span>z <span class="token operator">&lt;=</span> math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>curP1<span class="token punctuation">.</span>z<span class="token punctuation">,</span> curP2<span class="token punctuation">.</span>z<span class="token punctuation">)</span> <span class="token keyword">then</span>
                <span class="token keyword">return</span> <span class="token keyword">true</span>
            <span class="token keyword">end</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>
    <span class="token keyword">return</span> <span class="token keyword">false</span>
<span class="token keyword">end</span>

<span class="token keyword">function</span> <span class="token function">isInFlat</span><span class="token punctuation">(</span>point<span class="token punctuation">,</span> flat<span class="token punctuation">)</span>
    <span class="token keyword">local</span> curP1 <span class="token operator">=</span> flat<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token keyword">local</span> curP2 <span class="token operator">=</span> flat<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> point<span class="token punctuation">.</span>x <span class="token operator">&gt;=</span> math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>curP1<span class="token punctuation">.</span>x<span class="token punctuation">,</span> curP2<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token keyword">and</span> point<span class="token punctuation">.</span>x <span class="token operator">&lt;=</span> math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>curP1<span class="token punctuation">.</span>x<span class="token punctuation">,</span> curP2<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token keyword">then</span>
        <span class="token keyword">if</span> point<span class="token punctuation">.</span>y <span class="token operator">&gt;=</span> math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>curP1<span class="token punctuation">.</span>y<span class="token punctuation">,</span> curP2<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token keyword">and</span> point<span class="token punctuation">.</span>y <span class="token operator">&lt;=</span> math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>curP1<span class="token punctuation">.</span>y<span class="token punctuation">,</span> curP2<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token keyword">then</span>
            <span class="token keyword">if</span> point<span class="token punctuation">.</span>z <span class="token operator">&gt;=</span> math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>curP1<span class="token punctuation">.</span>z<span class="token punctuation">,</span> curP2<span class="token punctuation">.</span>z<span class="token punctuation">)</span> <span class="token keyword">and</span> point<span class="token punctuation">.</span>z <span class="token operator">&lt;=</span> math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>curP1<span class="token punctuation">.</span>z<span class="token punctuation">,</span> curP2<span class="token punctuation">.</span>z<span class="token punctuation">)</span> <span class="token keyword">then</span>
                <span class="token keyword">return</span> <span class="token keyword">true</span>
            <span class="token keyword">end</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>
    <span class="token keyword">return</span> <span class="token keyword">false</span>
<span class="token keyword">end</span>

<span class="token keyword">function</span> <span class="token function">updateSidesDigitalPrompt</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span>
    <span class="token keyword">local</span> axes <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token string">'z'</span><span class="token punctuation">,</span> <span class="token string">'z'</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token string">'y'</span> <span class="token punctuation">}</span>
    <span class="token keyword">local</span> values <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">}</span>
    <span class="token keyword">local</span> dirs <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token punctuation">}</span>

    <span class="token keyword">for</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">6</span> <span class="token keyword">do</span>
        <span class="token keyword">local</span> p <span class="token operator">=</span> <span class="token function">POSITION</span><span class="token punctuation">(</span>pos<span class="token punctuation">.</span>x<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>y<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>z<span class="token punctuation">)</span>
        p<span class="token punctuation">[</span>axes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> p<span class="token punctuation">[</span>axes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">+</span> values<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        <span class="token keyword">local</span> ret<span class="token punctuation">,</span> id <span class="token operator">=</span> Block<span class="token punctuation">:</span><span class="token function">getBlockID</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>x<span class="token punctuation">,</span> p<span class="token punctuation">.</span>y<span class="token punctuation">,</span> p<span class="token punctuation">.</span>z<span class="token punctuation">)</span>
        <span class="token keyword">local</span> side <span class="token operator">=</span> <span class="token function">isPrompt</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
        <span class="token keyword">if</span> side <span class="token operator">~=</span> <span class="token number">0</span> <span class="token keyword">then</span>
            <span class="token keyword">local</span> ret<span class="token punctuation">,</span> data <span class="token operator">=</span> Block<span class="token punctuation">:</span><span class="token function">getBlockData</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>x<span class="token punctuation">,</span> p<span class="token punctuation">.</span>y<span class="token punctuation">,</span> p<span class="token punctuation">.</span>z<span class="token punctuation">)</span>
            <span class="token keyword">if</span> data <span class="token operator">==</span> dirs<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token keyword">then</span>
                <span class="token keyword">if</span> side <span class="token operator">==</span> <span class="token number">1</span> <span class="token keyword">and</span> i <span class="token operator">&lt;=</span> <span class="token number">4</span> <span class="token keyword">or</span> side <span class="token operator">==</span> <span class="token number">3</span> <span class="token keyword">and</span> i <span class="token operator">==</span> <span class="token number">5</span> <span class="token keyword">or</span> side <span class="token operator">==</span> <span class="token number">2</span> <span class="token keyword">and</span> i <span class="token operator">==</span> <span class="token number">6</span> <span class="token keyword">then</span>
                    Block<span class="token punctuation">:</span><span class="token function">setBlockAll</span><span class="token punctuation">(</span>pos<span class="token punctuation">.</span>x<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>y<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>z<span class="token punctuation">,</span> id<span class="token punctuation">,</span> data<span class="token punctuation">)</span>
                    Block<span class="token punctuation">:</span><span class="token function">destroyBlock</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>x<span class="token punctuation">,</span> p<span class="token punctuation">.</span>y<span class="token punctuation">,</span> p<span class="token punctuation">.</span>z<span class="token punctuation">)</span>
                    <span class="token keyword">local</span> value <span class="token operator">=</span> <span class="token operator">-</span>values<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
                    <span class="token keyword">local</span> tp <span class="token operator">=</span> <span class="token function">POSITION</span><span class="token punctuation">(</span>pos<span class="token punctuation">.</span>x<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>y<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>z<span class="token punctuation">)</span>
                    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token keyword">true</span><span class="token punctuation">)</span> <span class="token keyword">do</span>
                        tp<span class="token punctuation">[</span>axes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> tp<span class="token punctuation">[</span>axes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">+</span> value
                        <span class="token keyword">local</span> ret<span class="token punctuation">,</span> nid <span class="token operator">=</span> Block<span class="token punctuation">:</span><span class="token function">getBlockID</span><span class="token punctuation">(</span>tp<span class="token punctuation">.</span>x<span class="token punctuation">,</span> tp<span class="token punctuation">.</span>y<span class="token punctuation">,</span> tp<span class="token punctuation">.</span>z<span class="token punctuation">)</span>
                        <span class="token keyword">local</span> ret<span class="token punctuation">,</span> ndata <span class="token operator">=</span> Block<span class="token punctuation">:</span><span class="token function">getBlockData</span><span class="token punctuation">(</span>tp<span class="token punctuation">.</span>x<span class="token punctuation">,</span> tp<span class="token punctuation">.</span>y<span class="token punctuation">,</span> tp<span class="token punctuation">.</span>z<span class="token punctuation">)</span>
                        <span class="token keyword">local</span> side <span class="token operator">=</span> <span class="token function">isPrompt</span><span class="token punctuation">(</span>nid<span class="token punctuation">)</span>
                        <span class="token keyword">if</span> side <span class="token operator">~=</span> <span class="token number">0</span> <span class="token keyword">then</span>
                            <span class="token keyword">if</span> data <span class="token operator">+</span> ndata <span class="token operator">==</span> <span class="token number">5</span> <span class="token keyword">then</span>
                                Block<span class="token punctuation">:</span><span class="token function">setBlockAll</span><span class="token punctuation">(</span>pos<span class="token punctuation">.</span>x<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>y<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>z<span class="token punctuation">,</span> BLOCK_AIR<span class="token punctuation">)</span>
                                Block<span class="token punctuation">:</span><span class="token function">setBlockAll</span><span class="token punctuation">(</span>tp<span class="token punctuation">.</span>x<span class="token punctuation">,</span> tp<span class="token punctuation">.</span>y<span class="token punctuation">,</span> tp<span class="token punctuation">.</span>z<span class="token punctuation">,</span> BLOCK_AIR<span class="token punctuation">)</span>
                                <span class="token keyword">break</span>
                            <span class="token keyword">else</span>

                            <span class="token keyword">end</span>
                        <span class="token keyword">else</span>
                            <span class="token keyword">break</span>
                        <span class="token keyword">end</span>

                    <span class="token keyword">end</span>

                    <span class="token keyword">break</span>
                <span class="token keyword">end</span>
            <span class="token keyword">end</span>
        <span class="token keyword">else</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>
<span class="token keyword">end</span>

<span class="token keyword">function</span> <span class="token function">updateDigitalPrompt</span><span class="token punctuation">(</span>area<span class="token punctuation">,</span> flat<span class="token punctuation">,</span> dir<span class="token punctuation">)</span>
    <span class="token keyword">local</span> size
    <span class="token keyword">local</span> isInit <span class="token operator">=</span> <span class="token keyword">false</span>
    <span class="token keyword">local</span> prompt <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">local</span> count <span class="token operator">=</span> <span class="token number">0</span>

    <span class="token keyword">if</span> area<span class="token punctuation">.</span>prompts <span class="token keyword">and</span> area<span class="token punctuation">.</span>prompts<span class="token punctuation">[</span>dir<span class="token punctuation">]</span> <span class="token keyword">then</span>
        size <span class="token operator">=</span> area<span class="token punctuation">.</span>puzzle<span class="token punctuation">.</span>size
        prompt <span class="token operator">=</span> area<span class="token punctuation">.</span>prompts<span class="token punctuation">[</span>dir<span class="token punctuation">]</span>
        count <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">else</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> area<span class="token punctuation">.</span>prompts <span class="token keyword">then</span>
            area<span class="token punctuation">.</span>prompts <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token keyword">end</span>
        size <span class="token operator">=</span> area<span class="token punctuation">.</span>answer<span class="token punctuation">.</span>size
        area<span class="token punctuation">.</span>prompts<span class="token punctuation">[</span>dir<span class="token punctuation">]</span> <span class="token operator">=</span> prompt
        isInit <span class="token operator">=</span> <span class="token keyword">true</span>
    <span class="token keyword">end</span>

    <span class="token keyword">local</span> p1<span class="token punctuation">,</span> p2
    <span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">CONFIG</span><span class="token punctuation">(</span>axes<span class="token punctuation">,</span> signs<span class="token punctuation">)</span>
        <span class="token keyword">local</span> c <span class="token operator">=</span> <span class="token punctuation">{</span> axes <span class="token operator">=</span> axes<span class="token punctuation">,</span> signs <span class="token operator">=</span> signs <span class="token punctuation">}</span>
        <span class="token keyword">return</span> c
    <span class="token keyword">end</span>
    <span class="token keyword">local</span> c <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token function">CONFIG</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token string">'z'</span><span class="token punctuation">,</span> <span class="token string">'x'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">CONFIG</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token string">'z'</span><span class="token punctuation">,</span> <span class="token string">'x'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">CONFIG</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token string">'z'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">CONFIG</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token string">'z'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">CONFIG</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token string">'z'</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">CONFIG</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token string">'z'</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">local</span> limits <span class="token operator">=</span> <span class="token function">POSITION</span><span class="token punctuation">(</span>size<span class="token punctuation">.</span>length<span class="token punctuation">,</span> size<span class="token punctuation">.</span>height<span class="token punctuation">,</span> size<span class="token punctuation">.</span>width<span class="token punctuation">)</span>
    c <span class="token operator">=</span> c<span class="token punctuation">[</span>dir<span class="token punctuation">]</span>

    p1 <span class="token operator">=</span> flat<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    p2 <span class="token operator">=</span> flat<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>

    <span class="token keyword">for</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">#</span>c<span class="token punctuation">.</span>axes<span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">do</span>
        <span class="token keyword">local</span> axis <span class="token operator">=</span> c<span class="token punctuation">.</span>axes<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        <span class="token keyword">if</span> p1<span class="token punctuation">[</span>axis<span class="token punctuation">]</span> <span class="token operator">&gt;</span> p2<span class="token punctuation">[</span>axis<span class="token punctuation">]</span> <span class="token keyword">then</span>
            c<span class="token punctuation">.</span>signs<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
        <span class="token keyword">elseif</span> p1<span class="token punctuation">[</span>axis<span class="token punctuation">]</span> <span class="token operator">&lt;</span> p2<span class="token punctuation">[</span>axis<span class="token punctuation">]</span> <span class="token keyword">then</span>
            c<span class="token punctuation">.</span>signs<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>
        <span class="token keyword">else</span>
            c<span class="token punctuation">.</span>signs<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>

    <span class="token keyword">local</span> blockid <span class="token operator">=</span> BLOCK_ANSWER<span class="token punctuation">[</span>dir <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span>

    <span class="token keyword">local</span> t1 <span class="token operator">=</span> <span class="token function">POSITION</span><span class="token punctuation">(</span>p1<span class="token punctuation">.</span>x<span class="token punctuation">,</span> p1<span class="token punctuation">.</span>y<span class="token punctuation">,</span> p1<span class="token punctuation">.</span>z<span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> limits<span class="token punctuation">[</span>c<span class="token punctuation">.</span>axes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token keyword">do</span>
        <span class="token keyword">local</span> t2 <span class="token operator">=</span> <span class="token function">POSITION</span><span class="token punctuation">(</span>t1<span class="token punctuation">.</span>x<span class="token punctuation">,</span> t1<span class="token punctuation">.</span>y<span class="token punctuation">,</span> t1<span class="token punctuation">.</span>z<span class="token punctuation">)</span>
        <span class="token keyword">for</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> limits<span class="token punctuation">[</span>c<span class="token punctuation">.</span>axes<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token keyword">do</span>
            <span class="token keyword">local</span> t3 <span class="token operator">=</span> <span class="token function">POSITION</span><span class="token punctuation">(</span>t2<span class="token punctuation">.</span>x<span class="token punctuation">,</span> t2<span class="token punctuation">.</span>y<span class="token punctuation">,</span> t2<span class="token punctuation">.</span>z<span class="token punctuation">)</span>

            <span class="token keyword">if</span> isInit <span class="token keyword">then</span>
                <span class="token keyword">local</span> part <span class="token operator">=</span> <span class="token number">0</span>
                <span class="token keyword">local</span> isContinuous <span class="token operator">=</span> <span class="token keyword">false</span>
                <span class="token keyword">local</span> num <span class="token operator">=</span> <span class="token number">0</span>
                <span class="token keyword">local</span> promptID
                <span class="token keyword">for</span> k <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> limits<span class="token punctuation">[</span>c<span class="token punctuation">.</span>axes<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token keyword">do</span>
                    <span class="token keyword">local</span> ret<span class="token punctuation">,</span> id <span class="token operator">=</span> Block<span class="token punctuation">:</span><span class="token function">getBlockID</span><span class="token punctuation">(</span>t3<span class="token punctuation">.</span>x<span class="token punctuation">,</span> t3<span class="token punctuation">.</span>y<span class="token punctuation">,</span> t3<span class="token punctuation">.</span>z<span class="token punctuation">)</span>
                    <span class="token keyword">if</span> id <span class="token operator">==</span> blockid <span class="token keyword">then</span>
                        num <span class="token operator">=</span> num <span class="token operator">+</span> <span class="token number">1</span>
                        <span class="token keyword">if</span> <span class="token keyword">not</span> isContinuous <span class="token keyword">then</span>
                            part <span class="token operator">=</span> part <span class="token operator">+</span> <span class="token number">1</span>
                            isContinuous <span class="token operator">=</span> <span class="token keyword">true</span>
                        <span class="token keyword">end</span>

                    <span class="token keyword">elseif</span> isContinuous <span class="token keyword">then</span>
                        isContinuous <span class="token operator">=</span> <span class="token keyword">false</span>
                    <span class="token keyword">end</span>
                    t3<span class="token punctuation">[</span>c<span class="token punctuation">.</span>axes<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> t3<span class="token punctuation">[</span>c<span class="token punctuation">.</span>axes<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">+</span> c<span class="token punctuation">.</span>signs<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>
                <span class="token keyword">end</span>

                <span class="token keyword">local</span> index1 <span class="token operator">=</span> <span class="token number">1</span>
                <span class="token keyword">if</span> dir <span class="token operator">&lt;=</span> <span class="token number">4</span> <span class="token keyword">then</span>

                <span class="token keyword">else</span>
                    index1 <span class="token operator">=</span> dir <span class="token operator">-</span> <span class="token number">3</span>
                <span class="token keyword">end</span>
                <span class="token keyword">if</span> num <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">then</span>
                    promptID <span class="token operator">=</span> ID_prompts<span class="token punctuation">[</span>index1<span class="token punctuation">]</span><span class="token punctuation">[</span>dir<span class="token operator">%</span><span class="token number">2</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>zero
                <span class="token keyword">else</span>
                    <span class="token keyword">local</span> partToNum <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">}</span>
                    promptID <span class="token operator">=</span> ID_prompts<span class="token punctuation">[</span>index1<span class="token punctuation">]</span><span class="token punctuation">[</span>dir<span class="token operator">%</span><span class="token number">2</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>num<span class="token operator">+</span>partToNum<span class="token punctuation">[</span>part<span class="token punctuation">]</span><span class="token punctuation">]</span>
                <span class="token keyword">end</span>

                table<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>prompt<span class="token punctuation">,</span> promptID<span class="token punctuation">)</span>
            <span class="token keyword">else</span>
                <span class="token keyword">local</span> setP <span class="token operator">=</span> <span class="token function">POSITION</span><span class="token punctuation">(</span>t2<span class="token punctuation">.</span>x<span class="token punctuation">,</span> t2<span class="token punctuation">.</span>y<span class="token punctuation">,</span> t2<span class="token punctuation">.</span>z<span class="token punctuation">)</span>
                <span class="token keyword">local</span> toFace <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token punctuation">}</span>
                <span class="token keyword">local</span> toCoord <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token string">'z'</span><span class="token punctuation">,</span> <span class="token string">'z'</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token string">'y'</span> <span class="token punctuation">}</span>
                <span class="token keyword">local</span> toSign <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token punctuation">}</span>
                setP<span class="token punctuation">[</span>toCoord<span class="token punctuation">[</span>dir<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> setP<span class="token punctuation">[</span>toCoord<span class="token punctuation">[</span>dir<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">+</span> toSign<span class="token punctuation">[</span>dir<span class="token punctuation">]</span>
                Block<span class="token punctuation">:</span><span class="token function">setBlockAll</span><span class="token punctuation">(</span>setP<span class="token punctuation">.</span>x<span class="token punctuation">,</span> setP<span class="token punctuation">.</span>y<span class="token punctuation">,</span> setP<span class="token punctuation">.</span>z<span class="token punctuation">,</span> prompt<span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">,</span> toFace<span class="token punctuation">[</span>dir<span class="token punctuation">]</span><span class="token punctuation">)</span>
                count <span class="token operator">=</span> count <span class="token operator">+</span> <span class="token number">1</span>
            <span class="token keyword">end</span>

            t2<span class="token punctuation">[</span>c<span class="token punctuation">.</span>axes<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> t2<span class="token punctuation">[</span>c<span class="token punctuation">.</span>axes<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">+</span> c<span class="token punctuation">.</span>signs<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
        <span class="token keyword">end</span>

        t1<span class="token punctuation">[</span>c<span class="token punctuation">.</span>axes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> t1<span class="token punctuation">[</span>c<span class="token punctuation">.</span>axes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">+</span> c<span class="token punctuation">.</span>signs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token keyword">end</span>

<span class="token keyword">end</span>

<span class="token keyword">function</span> <span class="token function">cleanDigitalPrompt</span><span class="token punctuation">(</span>area<span class="token punctuation">,</span> flat<span class="token punctuation">,</span> dir<span class="token punctuation">)</span>
    <span class="token keyword">local</span> size
    <span class="token keyword">local</span> isInit <span class="token operator">=</span> <span class="token keyword">false</span>
    <span class="token keyword">local</span> prompt <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">local</span> count <span class="token operator">=</span> <span class="token number">0</span>

    <span class="token keyword">if</span> area<span class="token punctuation">.</span>prompts <span class="token keyword">and</span> area<span class="token punctuation">.</span>prompts<span class="token punctuation">[</span>dir<span class="token punctuation">]</span> <span class="token keyword">then</span>
        size <span class="token operator">=</span> area<span class="token punctuation">.</span>puzzle<span class="token punctuation">.</span>size
        prompt <span class="token operator">=</span> area<span class="token punctuation">.</span>prompts<span class="token punctuation">[</span>dir<span class="token punctuation">]</span>
        count <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">else</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> area<span class="token punctuation">.</span>prompts <span class="token keyword">then</span>
            area<span class="token punctuation">.</span>prompts <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token keyword">end</span>
        size <span class="token operator">=</span> area<span class="token punctuation">.</span>answer<span class="token punctuation">.</span>size
        area<span class="token punctuation">.</span>prompts<span class="token punctuation">[</span>dir<span class="token punctuation">]</span> <span class="token operator">=</span> prompt
        isInit <span class="token operator">=</span> <span class="token keyword">true</span>
    <span class="token keyword">end</span>

    <span class="token keyword">local</span> p1<span class="token punctuation">,</span> p2
    <span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">CONFIG</span><span class="token punctuation">(</span>axes<span class="token punctuation">,</span> signs<span class="token punctuation">)</span>
        <span class="token keyword">local</span> c <span class="token operator">=</span> <span class="token punctuation">{</span> axes <span class="token operator">=</span> axes<span class="token punctuation">,</span> signs <span class="token operator">=</span> signs <span class="token punctuation">}</span>
        <span class="token keyword">return</span> c
    <span class="token keyword">end</span>
    <span class="token keyword">local</span> c <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token function">CONFIG</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token string">'z'</span><span class="token punctuation">,</span> <span class="token string">'x'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">CONFIG</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token string">'z'</span><span class="token punctuation">,</span> <span class="token string">'x'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">CONFIG</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token string">'z'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">CONFIG</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token string">'z'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">CONFIG</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token string">'z'</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">CONFIG</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token string">'z'</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">local</span> limits <span class="token operator">=</span> <span class="token function">POSITION</span><span class="token punctuation">(</span>size<span class="token punctuation">.</span>length<span class="token punctuation">,</span> size<span class="token punctuation">.</span>height<span class="token punctuation">,</span> size<span class="token punctuation">.</span>width<span class="token punctuation">)</span>
    c <span class="token operator">=</span> c<span class="token punctuation">[</span>dir<span class="token punctuation">]</span>

    p1 <span class="token operator">=</span> flat<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    p2 <span class="token operator">=</span> flat<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>

    <span class="token keyword">for</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">#</span>c<span class="token punctuation">.</span>axes<span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">do</span>
        <span class="token keyword">local</span> axis <span class="token operator">=</span> c<span class="token punctuation">.</span>axes<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        <span class="token keyword">if</span> p1<span class="token punctuation">[</span>axis<span class="token punctuation">]</span> <span class="token operator">&gt;</span> p2<span class="token punctuation">[</span>axis<span class="token punctuation">]</span> <span class="token keyword">then</span>
            c<span class="token punctuation">.</span>signs<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
        <span class="token keyword">elseif</span> p1<span class="token punctuation">[</span>axis<span class="token punctuation">]</span> <span class="token operator">&lt;</span> p2<span class="token punctuation">[</span>axis<span class="token punctuation">]</span> <span class="token keyword">then</span>
            c<span class="token punctuation">.</span>signs<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>
        <span class="token keyword">else</span>
            c<span class="token punctuation">.</span>signs<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>

    <span class="token keyword">local</span> blockid <span class="token operator">=</span> BLOCK_ANSWER<span class="token punctuation">[</span>dir <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span>

    <span class="token keyword">local</span> t1 <span class="token operator">=</span> <span class="token function">POSITION</span><span class="token punctuation">(</span>p1<span class="token punctuation">.</span>x<span class="token punctuation">,</span> p1<span class="token punctuation">.</span>y<span class="token punctuation">,</span> p1<span class="token punctuation">.</span>z<span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> limits<span class="token punctuation">[</span>c<span class="token punctuation">.</span>axes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token keyword">do</span>
        <span class="token keyword">local</span> t2 <span class="token operator">=</span> <span class="token function">POSITION</span><span class="token punctuation">(</span>t1<span class="token punctuation">.</span>x<span class="token punctuation">,</span> t1<span class="token punctuation">.</span>y<span class="token punctuation">,</span> t1<span class="token punctuation">.</span>z<span class="token punctuation">)</span>
        <span class="token keyword">for</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> limits<span class="token punctuation">[</span>c<span class="token punctuation">.</span>axes<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token keyword">do</span>
            <span class="token keyword">local</span> t3 <span class="token operator">=</span> <span class="token function">POSITION</span><span class="token punctuation">(</span>t2<span class="token punctuation">.</span>x<span class="token punctuation">,</span> t2<span class="token punctuation">.</span>y<span class="token punctuation">,</span> t2<span class="token punctuation">.</span>z<span class="token punctuation">)</span>

            <span class="token keyword">if</span> isInit <span class="token keyword">then</span>
                <span class="token keyword">local</span> part <span class="token operator">=</span> <span class="token number">0</span>
                <span class="token keyword">local</span> isContinuous <span class="token operator">=</span> <span class="token keyword">false</span>
                <span class="token keyword">local</span> num <span class="token operator">=</span> <span class="token number">0</span>
                <span class="token keyword">local</span> promptID
                <span class="token keyword">for</span> k <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> limits<span class="token punctuation">[</span>c<span class="token punctuation">.</span>axes<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token keyword">do</span>
                    <span class="token keyword">local</span> ret<span class="token punctuation">,</span> id <span class="token operator">=</span> Block<span class="token punctuation">:</span><span class="token function">getBlockID</span><span class="token punctuation">(</span>t3<span class="token punctuation">.</span>x<span class="token punctuation">,</span> t3<span class="token punctuation">.</span>y<span class="token punctuation">,</span> t3<span class="token punctuation">.</span>z<span class="token punctuation">)</span>
                    <span class="token keyword">if</span> id <span class="token operator">==</span> blockid <span class="token keyword">then</span>
                        num <span class="token operator">=</span> num <span class="token operator">+</span> <span class="token number">1</span>
                        <span class="token keyword">if</span> <span class="token keyword">not</span> isContinuous <span class="token keyword">then</span>
                            part <span class="token operator">=</span> part <span class="token operator">+</span> <span class="token number">1</span>
                            isContinuous <span class="token operator">=</span> <span class="token keyword">true</span>
                        <span class="token keyword">end</span>

                    <span class="token keyword">elseif</span> isContinuous <span class="token keyword">then</span>
                        isContinuous <span class="token operator">=</span> <span class="token keyword">false</span>
                    <span class="token keyword">end</span>
                    t3<span class="token punctuation">[</span>c<span class="token punctuation">.</span>axes<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> t3<span class="token punctuation">[</span>c<span class="token punctuation">.</span>axes<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">+</span> c<span class="token punctuation">.</span>signs<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>
                <span class="token keyword">end</span>

                <span class="token keyword">local</span> index1 <span class="token operator">=</span> <span class="token number">1</span>
                <span class="token keyword">if</span> dir <span class="token operator">&lt;=</span> <span class="token number">4</span> <span class="token keyword">then</span>

                <span class="token keyword">else</span>
                    index1 <span class="token operator">=</span> dir <span class="token operator">-</span> <span class="token number">3</span>
                <span class="token keyword">end</span>
                <span class="token keyword">if</span> num <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">then</span>
                    promptID <span class="token operator">=</span> ID_prompts<span class="token punctuation">[</span>index1<span class="token punctuation">]</span><span class="token punctuation">[</span>dir<span class="token operator">%</span><span class="token number">2</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>zero
                <span class="token keyword">else</span>
                    <span class="token keyword">local</span> partToNum <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">}</span>
                    promptID <span class="token operator">=</span> ID_prompts<span class="token punctuation">[</span>index1<span class="token punctuation">]</span><span class="token punctuation">[</span>dir<span class="token operator">%</span><span class="token number">2</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>num<span class="token operator">+</span>partToNum<span class="token punctuation">[</span>part<span class="token punctuation">]</span><span class="token punctuation">]</span>
                <span class="token keyword">end</span>

                table<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>prompt<span class="token punctuation">,</span> promptID<span class="token punctuation">)</span>
            <span class="token keyword">else</span>
                <span class="token keyword">local</span> setP <span class="token operator">=</span> <span class="token function">POSITION</span><span class="token punctuation">(</span>t2<span class="token punctuation">.</span>x<span class="token punctuation">,</span> t2<span class="token punctuation">.</span>y<span class="token punctuation">,</span> t2<span class="token punctuation">.</span>z<span class="token punctuation">)</span>
                <span class="token keyword">local</span> toFace <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token punctuation">}</span>
                <span class="token keyword">local</span> toCoord <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token string">'z'</span><span class="token punctuation">,</span> <span class="token string">'z'</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token string">'y'</span> <span class="token punctuation">}</span>
                <span class="token keyword">local</span> toSign <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token punctuation">}</span>
                setP<span class="token punctuation">[</span>toCoord<span class="token punctuation">[</span>dir<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> setP<span class="token punctuation">[</span>toCoord<span class="token punctuation">[</span>dir<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">+</span> toSign<span class="token punctuation">[</span>dir<span class="token punctuation">]</span>
                Block<span class="token punctuation">:</span><span class="token function">setBlockAll</span><span class="token punctuation">(</span>setP<span class="token punctuation">.</span>x<span class="token punctuation">,</span> setP<span class="token punctuation">.</span>y<span class="token punctuation">,</span> setP<span class="token punctuation">.</span>z<span class="token punctuation">,</span> BLOCK_AIR<span class="token punctuation">,</span> toFace<span class="token punctuation">[</span>dir<span class="token punctuation">]</span><span class="token punctuation">)</span>
                count <span class="token operator">=</span> count <span class="token operator">+</span> <span class="token number">1</span>
            <span class="token keyword">end</span>

            t2<span class="token punctuation">[</span>c<span class="token punctuation">.</span>axes<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> t2<span class="token punctuation">[</span>c<span class="token punctuation">.</span>axes<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">+</span> c<span class="token punctuation">.</span>signs<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
        <span class="token keyword">end</span>

        t1<span class="token punctuation">[</span>c<span class="token punctuation">.</span>axes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> t1<span class="token punctuation">[</span>c<span class="token punctuation">.</span>axes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">+</span> c<span class="token punctuation">.</span>signs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token keyword">end</span>

<span class="token keyword">end</span>

<span class="token keyword">function</span> <span class="token function">mapping</span><span class="token punctuation">(</span>area<span class="token punctuation">,</span> pos<span class="token punctuation">)</span>
    <span class="token keyword">local</span> puzzle <span class="token operator">=</span> area<span class="token punctuation">.</span>puzzle
    <span class="token keyword">local</span> offsetP <span class="token operator">=</span> <span class="token function">POSITION</span><span class="token punctuation">(</span>pos<span class="token punctuation">.</span>x<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>y<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>z<span class="token punctuation">)</span>
    <span class="token keyword">local</span> values <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span>

    <span class="token keyword">local</span> separation <span class="token operator">=</span> area<span class="token punctuation">.</span>separation
    <span class="token keyword">if</span> <span class="token function">hasSeparatePart</span><span class="token punctuation">(</span>separation<span class="token punctuation">,</span> <span class="token string">'x'</span><span class="token punctuation">)</span> <span class="token keyword">then</span>
        <span class="token keyword">local</span> history <span class="token operator">=</span> separation<span class="token punctuation">.</span>history<span class="token punctuation">.</span>x
        <span class="token keyword">local</span> coord <span class="token operator">=</span> <span class="token string">'z'</span>
        <span class="token keyword">if</span> offsetP<span class="token punctuation">[</span>coord<span class="token punctuation">]</span> <span class="token operator">&gt;=</span> math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>history<span class="token punctuation">.</span>vertex<span class="token punctuation">[</span>coord<span class="token punctuation">]</span><span class="token punctuation">,</span> history<span class="token punctuation">.</span>vertex<span class="token punctuation">[</span>coord<span class="token punctuation">]</span><span class="token operator">-</span>values<span class="token punctuation">[</span>history<span class="token punctuation">.</span>dir<span class="token punctuation">]</span><span class="token operator">*</span>history<span class="token punctuation">.</span>num<span class="token punctuation">)</span>
                <span class="token keyword">and</span> offsetP<span class="token punctuation">[</span>coord<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>history<span class="token punctuation">.</span>vertex<span class="token punctuation">[</span>coord<span class="token punctuation">]</span><span class="token punctuation">,</span> history<span class="token punctuation">.</span>vertex<span class="token punctuation">[</span>coord<span class="token punctuation">]</span><span class="token operator">-</span>values<span class="token punctuation">[</span>history<span class="token punctuation">.</span>dir<span class="token punctuation">]</span><span class="token operator">*</span>history<span class="token punctuation">.</span>num<span class="token punctuation">)</span> <span class="token keyword">then</span>
            offsetP<span class="token punctuation">[</span>coord<span class="token punctuation">]</span> <span class="token operator">=</span> offsetP<span class="token punctuation">[</span>coord<span class="token punctuation">]</span> <span class="token operator">-</span> values<span class="token punctuation">[</span>history<span class="token punctuation">.</span>dir<span class="token punctuation">]</span> <span class="token operator">*</span> SEPARATE_DISTANCE
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>
    <span class="token keyword">if</span> <span class="token function">hasSeparatePart</span><span class="token punctuation">(</span>separation<span class="token punctuation">,</span> <span class="token string">'z'</span><span class="token punctuation">)</span> <span class="token keyword">then</span>
        <span class="token keyword">local</span> history <span class="token operator">=</span> separation<span class="token punctuation">.</span>history<span class="token punctuation">.</span>z
        <span class="token keyword">local</span> coord <span class="token operator">=</span> <span class="token string">'x'</span>
        <span class="token keyword">if</span> offsetP<span class="token punctuation">[</span>coord<span class="token punctuation">]</span> <span class="token operator">&gt;=</span> math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>history<span class="token punctuation">.</span>vertex<span class="token punctuation">[</span>coord<span class="token punctuation">]</span><span class="token punctuation">,</span> history<span class="token punctuation">.</span>vertex<span class="token punctuation">[</span>coord<span class="token punctuation">]</span><span class="token operator">-</span>values<span class="token punctuation">[</span>history<span class="token punctuation">.</span>dir<span class="token punctuation">]</span><span class="token operator">*</span>history<span class="token punctuation">.</span>num<span class="token punctuation">)</span>
                <span class="token keyword">and</span> offsetP<span class="token punctuation">[</span>coord<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>history<span class="token punctuation">.</span>vertex<span class="token punctuation">[</span>coord<span class="token punctuation">]</span><span class="token punctuation">,</span> history<span class="token punctuation">.</span>vertex<span class="token punctuation">[</span>coord<span class="token punctuation">]</span><span class="token operator">-</span>values<span class="token punctuation">[</span>history<span class="token punctuation">.</span>dir<span class="token punctuation">]</span><span class="token operator">*</span>history<span class="token punctuation">.</span>num<span class="token punctuation">)</span> <span class="token keyword">then</span>
            offsetP<span class="token punctuation">[</span>coord<span class="token punctuation">]</span> <span class="token operator">=</span> offsetP<span class="token punctuation">[</span>coord<span class="token punctuation">]</span> <span class="token operator">-</span> values<span class="token punctuation">[</span>history<span class="token punctuation">.</span>dir<span class="token punctuation">]</span> <span class="token operator">*</span> SEPARATE_DISTANCE
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>

    <span class="token keyword">local</span> puzzlePoint <span class="token operator">=</span> puzzle<span class="token punctuation">.</span>srcPos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token keyword">local</span> answerPoint <span class="token operator">=</span> area<span class="token punctuation">.</span>answer<span class="token punctuation">.</span>srcPos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token keyword">local</span> vector <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    vector<span class="token punctuation">.</span>x <span class="token operator">=</span> offsetP<span class="token punctuation">.</span>x <span class="token operator">-</span> puzzlePoint<span class="token punctuation">.</span>x
    vector<span class="token punctuation">.</span>y <span class="token operator">=</span> offsetP<span class="token punctuation">.</span>y <span class="token operator">-</span> puzzlePoint<span class="token punctuation">.</span>y
    vector<span class="token punctuation">.</span>z <span class="token operator">=</span> offsetP<span class="token punctuation">.</span>z <span class="token operator">-</span> puzzlePoint<span class="token punctuation">.</span>z

    <span class="token keyword">return</span> <span class="token function">POSITION</span><span class="token punctuation">(</span>vector<span class="token punctuation">.</span>x <span class="token operator">+</span> answerPoint<span class="token punctuation">.</span>x<span class="token punctuation">,</span> vector<span class="token punctuation">.</span>y <span class="token operator">+</span> answerPoint<span class="token punctuation">.</span>y<span class="token punctuation">,</span> vector<span class="token punctuation">.</span>z <span class="token operator">+</span> answerPoint<span class="token punctuation">.</span>z<span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token keyword">function</span> <span class="token function">hasSeparatePart</span><span class="token punctuation">(</span>separation<span class="token punctuation">,</span> axis<span class="token punctuation">)</span>
    <span class="token keyword">if</span> separation<span class="token punctuation">.</span>times<span class="token punctuation">[</span>axis<span class="token punctuation">]</span> <span class="token keyword">and</span> separation<span class="token punctuation">.</span>times<span class="token punctuation">[</span>axis<span class="token punctuation">]</span> <span class="token operator">~=</span> <span class="token number">0</span> <span class="token keyword">then</span>
        <span class="token keyword">return</span> <span class="token keyword">true</span>
    <span class="token keyword">else</span>
        <span class="token keyword">return</span> <span class="token keyword">false</span>
    <span class="token keyword">end</span>
<span class="token keyword">end</span>

<span class="token keyword">function</span> <span class="token function">separate</span><span class="token punctuation">(</span>area<span class="token punctuation">,</span> hitP<span class="token punctuation">,</span> hitDir<span class="token punctuation">)</span>
    <span class="token comment">--hitDir = hitDir + 1</span>
    <span class="token keyword">local</span> text <span class="token operator">=</span> <span class="token string">&quot;&quot;</span>
    <span class="token keyword">local</span> puzzle <span class="token operator">=</span> area<span class="token punctuation">.</span>puzzle
    <span class="token keyword">local</span> flats <span class="token operator">=</span> puzzle<span class="token punctuation">.</span>flats
    <span class="token keyword">local</span> axes <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token string">'z'</span><span class="token punctuation">,</span> <span class="token string">'z'</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">}</span>
    <span class="token keyword">local</span> verticalAxes <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">'z'</span><span class="token punctuation">,</span> <span class="token string">'z'</span><span class="token punctuation">,</span> <span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">}</span>

    <span class="token keyword">local</span> isCenter <span class="token operator">=</span> <span class="token keyword">false</span>

    <span class="token keyword">if</span> hitP<span class="token punctuation">[</span>verticalAxes<span class="token punctuation">[</span>hitDir<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">==</span> puzzle<span class="token punctuation">.</span>midValues<span class="token punctuation">[</span>hitDir<span class="token punctuation">]</span> <span class="token keyword">then</span>
        isCenter <span class="token operator">=</span> <span class="token keyword">true</span>
        text <span class="token operator">=</span> text <span class="token operator">..</span> <span class="token string">&quot; isCenter&quot;</span>
    <span class="token keyword">end</span>
    <span class="token keyword">if</span> puzzle<span class="token punctuation">.</span>size<span class="token punctuation">.</span>width <span class="token operator">==</span> <span class="token number">1</span> <span class="token keyword">and</span> puzzle<span class="token punctuation">.</span>size<span class="token punctuation">.</span>height <span class="token operator">==</span> <span class="token number">1</span> <span class="token keyword">and</span> puzzle<span class="token punctuation">.</span>size<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">1</span> <span class="token keyword">then</span>
        <span class="token keyword">return</span>
    <span class="token keyword">elseif</span> puzzle<span class="token punctuation">.</span>size<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">1</span> <span class="token keyword">and</span> hitDir <span class="token operator">&gt;=</span> <span class="token number">3</span> <span class="token keyword">and</span> hitDir <span class="token operator">&lt;=</span> <span class="token number">4</span> <span class="token keyword">then</span>
        <span class="token keyword">return</span>
    <span class="token keyword">elseif</span> puzzle<span class="token punctuation">.</span>size<span class="token punctuation">.</span>width <span class="token operator">==</span> <span class="token number">1</span> <span class="token keyword">and</span> hitDir <span class="token operator">&gt;=</span> <span class="token number">1</span> <span class="token keyword">and</span> hitDir <span class="token operator">&lt;=</span> <span class="token number">2</span> <span class="token keyword">then</span>
        <span class="token keyword">return</span>
    <span class="token keyword">end</span>

    <span class="token keyword">if</span> <span class="token function">hasSeparatePart</span><span class="token punctuation">(</span>area<span class="token punctuation">.</span>separation<span class="token punctuation">,</span> axes<span class="token punctuation">[</span>hitDir<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">then</span>
        <span class="token keyword">local</span> history <span class="token operator">=</span> area<span class="token punctuation">.</span>separation<span class="token punctuation">.</span>history<span class="token punctuation">[</span>axes<span class="token punctuation">[</span>hitDir<span class="token punctuation">]</span><span class="token punctuation">]</span>

        <span class="token keyword">if</span> history <span class="token keyword">then</span>
            <span class="token keyword">local</span> p1 <span class="token operator">=</span> flats<span class="token punctuation">[</span>history<span class="token punctuation">.</span>flatIndex<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
            <span class="token keyword">local</span> p2 <span class="token operator">=</span> flats<span class="token punctuation">[</span>history<span class="token punctuation">.</span>flatIndex<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
            <span class="token keyword">local</span> flat <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token function">POSITION</span><span class="token punctuation">(</span>p1<span class="token punctuation">.</span>x<span class="token punctuation">,</span> p1<span class="token punctuation">.</span>y<span class="token punctuation">,</span> p1<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">POSITION</span><span class="token punctuation">(</span>p2<span class="token punctuation">.</span>x<span class="token punctuation">,</span> p2<span class="token punctuation">.</span>y<span class="token punctuation">,</span> p2<span class="token punctuation">.</span>z<span class="token punctuation">)</span> <span class="token punctuation">}</span>
            <span class="token keyword">local</span> values <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span>
            <span class="token keyword">if</span> history<span class="token punctuation">.</span>num <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token keyword">then</span>
                <span class="token keyword">for</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> history<span class="token punctuation">.</span>num<span class="token operator">-</span><span class="token number">2</span> <span class="token keyword">do</span>
                    p1<span class="token punctuation">[</span>axes<span class="token punctuation">[</span>history<span class="token punctuation">.</span>dir<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> p1<span class="token punctuation">[</span>axes<span class="token punctuation">[</span>history<span class="token punctuation">.</span>dir<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">-</span> values<span class="token punctuation">[</span>history<span class="token punctuation">.</span>dir<span class="token punctuation">]</span>
                    p2<span class="token punctuation">[</span>axes<span class="token punctuation">[</span>history<span class="token punctuation">.</span>dir<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> p2<span class="token punctuation">[</span>axes<span class="token punctuation">[</span>history<span class="token punctuation">.</span>dir<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">-</span> values<span class="token punctuation">[</span>history<span class="token punctuation">.</span>dir<span class="token punctuation">]</span>
                <span class="token keyword">end</span>
            <span class="token keyword">end</span>
            <span class="token keyword">local</span> size <span class="token operator">=</span> <span class="token function">POSITION</span><span class="token punctuation">(</span>puzzle<span class="token punctuation">.</span>size<span class="token punctuation">.</span>length<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">,</span> puzzle<span class="token punctuation">.</span>size<span class="token punctuation">.</span>height<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">,</span> puzzle<span class="token punctuation">.</span>size<span class="token punctuation">.</span>width<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span>

            <span class="token function">move</span><span class="token punctuation">(</span><span class="token punctuation">{</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">}</span><span class="token punctuation">,</span> history<span class="token punctuation">.</span>dir<span class="token punctuation">,</span> history<span class="token punctuation">.</span>num<span class="token punctuation">,</span> size<span class="token punctuation">,</span> history<span class="token punctuation">.</span>vertex<span class="token punctuation">)</span>

            area<span class="token punctuation">.</span>separation<span class="token punctuation">.</span>times<span class="token punctuation">[</span>axes<span class="token punctuation">[</span>hitDir<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
            area<span class="token punctuation">.</span>separation<span class="token punctuation">.</span>history<span class="token punctuation">[</span>axes<span class="token punctuation">[</span>hitDir<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">nil</span>
        <span class="token keyword">end</span>
    <span class="token keyword">else</span>
        <span class="token keyword">local</span> verticalAxis <span class="token operator">=</span> verticalAxes<span class="token punctuation">[</span>hitDir<span class="token punctuation">]</span>
        <span class="token keyword">local</span> value
        <span class="token keyword">local</span> num
        <span class="token keyword">if</span> isCenter <span class="token keyword">then</span>
            <span class="token keyword">local</span> randomNum <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token punctuation">}</span>
            math<span class="token punctuation">.</span><span class="token function">randomseed</span><span class="token punctuation">(</span><span class="token function">tostring</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token function">sub</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            value <span class="token operator">=</span> randomNum<span class="token punctuation">[</span>math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
            num <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">else</span>
            <span class="token keyword">if</span> hitP<span class="token punctuation">[</span>verticalAxis<span class="token punctuation">]</span> <span class="token operator">&gt;</span> puzzle<span class="token punctuation">.</span>midValues<span class="token punctuation">[</span>hitDir<span class="token punctuation">]</span> <span class="token keyword">then</span>
                value <span class="token operator">=</span> <span class="token number">2</span>
            <span class="token keyword">else</span>
                value <span class="token operator">=</span> <span class="token number">1</span>
            <span class="token keyword">end</span>
            num <span class="token operator">=</span> <span class="token number">1</span>
        <span class="token keyword">end</span>

        <span class="token keyword">if</span> value <span class="token operator">==</span> <span class="token number">2</span> <span class="token keyword">then</span>
            num <span class="token operator">=</span> num <span class="token operator">+</span> math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>puzzle<span class="token punctuation">.</span>curPos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>verticalAxis<span class="token punctuation">]</span><span class="token punctuation">,</span> puzzle<span class="token punctuation">.</span>curPos<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span>verticalAxis<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> hitP<span class="token punctuation">[</span>verticalAxis<span class="token punctuation">]</span>
        <span class="token keyword">else</span>
            num <span class="token operator">=</span> num <span class="token operator">+</span> hitP<span class="token punctuation">[</span>verticalAxis<span class="token punctuation">]</span> <span class="token operator">-</span> math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>puzzle<span class="token punctuation">.</span>curPos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>verticalAxis<span class="token punctuation">]</span><span class="token punctuation">,</span> puzzle<span class="token punctuation">.</span>curPos<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span>verticalAxis<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">end</span>
        num <span class="token operator">=</span> num <span class="token operator">+</span> <span class="token number">1</span>

        <span class="token keyword">local</span> moveDir <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">{</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>

        <span class="token keyword">local</span> flat <span class="token operator">=</span> flats<span class="token punctuation">[</span>moveDir<span class="token punctuation">[</span>hitDir<span class="token punctuation">]</span><span class="token punctuation">[</span>value<span class="token punctuation">]</span><span class="token punctuation">]</span>
        <span class="token keyword">local</span> p1 <span class="token operator">=</span> <span class="token function">POSITION</span><span class="token punctuation">(</span>flat<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span> flat<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">,</span> flat<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>z<span class="token punctuation">)</span>
        <span class="token keyword">local</span> p2 <span class="token operator">=</span> <span class="token function">POSITION</span><span class="token punctuation">(</span>flat<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span> flat<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">,</span> flat<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>z<span class="token punctuation">)</span>
        <span class="token keyword">local</span> vertex
        <span class="token keyword">for</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">#</span>puzzle<span class="token punctuation">.</span>curPos <span class="token keyword">do</span>
            <span class="token keyword">if</span> p1<span class="token punctuation">.</span>x <span class="token operator">==</span> puzzle<span class="token punctuation">.</span>curPos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token keyword">and</span> p1<span class="token punctuation">.</span>y <span class="token operator">==</span> puzzle<span class="token punctuation">.</span>curPos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token keyword">and</span> p1<span class="token punctuation">.</span>z <span class="token operator">==</span> puzzle<span class="token punctuation">.</span>curPos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>z
                    <span class="token keyword">or</span> p2<span class="token punctuation">.</span>x <span class="token operator">==</span> puzzle<span class="token punctuation">.</span>curPos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token keyword">and</span> p2<span class="token punctuation">.</span>y <span class="token operator">==</span> puzzle<span class="token punctuation">.</span>curPos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token keyword">and</span> p2<span class="token punctuation">.</span>z <span class="token operator">==</span> puzzle<span class="token punctuation">.</span>curPos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>z <span class="token keyword">then</span>
                vertex <span class="token operator">=</span> puzzle<span class="token punctuation">.</span>curPos<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
            <span class="token keyword">end</span>
        <span class="token keyword">end</span>

        <span class="token keyword">local</span> toAxes <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token string">'z'</span><span class="token punctuation">,</span> <span class="token string">'z'</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">}</span>
        <span class="token keyword">local</span> values <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span>
        <span class="token keyword">local</span> axis <span class="token operator">=</span> toAxes<span class="token punctuation">[</span>moveDir<span class="token punctuation">[</span>hitDir<span class="token punctuation">]</span><span class="token punctuation">[</span>value<span class="token punctuation">]</span><span class="token punctuation">]</span>
        <span class="token keyword">local</span> moveValue <span class="token operator">=</span> values<span class="token punctuation">[</span>moveDir<span class="token punctuation">[</span>hitDir<span class="token punctuation">]</span><span class="token punctuation">[</span>value<span class="token punctuation">]</span><span class="token punctuation">]</span>
        <span class="token keyword">local</span> size <span class="token operator">=</span> <span class="token function">POSITION</span><span class="token punctuation">(</span>puzzle<span class="token punctuation">.</span>size<span class="token punctuation">.</span>length<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">,</span> puzzle<span class="token punctuation">.</span>size<span class="token punctuation">.</span>height<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">,</span> puzzle<span class="token punctuation">.</span>size<span class="token punctuation">.</span>width<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span>

        p1<span class="token punctuation">[</span>axis<span class="token punctuation">]</span> <span class="token operator">=</span> p1<span class="token punctuation">[</span>axis<span class="token punctuation">]</span> <span class="token operator">-</span> moveValue
        p2<span class="token punctuation">[</span>axis<span class="token punctuation">]</span> <span class="token operator">=</span> p2<span class="token punctuation">[</span>axis<span class="token punctuation">]</span> <span class="token operator">-</span> moveValue

        <span class="token function">move</span><span class="token punctuation">(</span><span class="token punctuation">{</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">}</span><span class="token punctuation">,</span> moveDir<span class="token punctuation">[</span>hitDir<span class="token punctuation">]</span><span class="token punctuation">[</span>value<span class="token punctuation">]</span><span class="token punctuation">,</span> num<span class="token punctuation">,</span> size<span class="token punctuation">,</span> vertex<span class="token punctuation">)</span>

        area<span class="token punctuation">.</span>separation<span class="token punctuation">.</span>times<span class="token punctuation">[</span>axes<span class="token punctuation">[</span>hitDir<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>

        <span class="token keyword">local</span> history <span class="token operator">=</span> <span class="token punctuation">{</span> num <span class="token operator">=</span> num<span class="token punctuation">,</span> flatIndex <span class="token operator">=</span> moveDir<span class="token punctuation">[</span>hitDir<span class="token punctuation">]</span><span class="token punctuation">[</span>value<span class="token punctuation">]</span><span class="token punctuation">,</span> vertex <span class="token operator">=</span> vertex <span class="token punctuation">}</span>
        <span class="token keyword">if</span> value <span class="token operator">==</span> <span class="token number">1</span> <span class="token keyword">then</span>
            value <span class="token operator">=</span> <span class="token number">2</span>
        <span class="token keyword">else</span>
            value <span class="token operator">=</span> <span class="token number">1</span>
        <span class="token keyword">end</span>
        history<span class="token punctuation">.</span>dir <span class="token operator">=</span> moveDir<span class="token punctuation">[</span>hitDir<span class="token punctuation">]</span><span class="token punctuation">[</span>value<span class="token punctuation">]</span>
        area<span class="token punctuation">.</span>separation<span class="token punctuation">.</span>history<span class="token punctuation">[</span>axes<span class="token punctuation">[</span>hitDir<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> history
    <span class="token keyword">end</span>

    <span class="token function">updateAreaFlats</span><span class="token punctuation">(</span>puzzle<span class="token punctuation">)</span>
    <span class="token function">updateAreaSize</span><span class="token punctuation">(</span>puzzle<span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token keyword">function</span> <span class="token function">move</span><span class="token punctuation">(</span>flat<span class="token punctuation">,</span> dir<span class="token punctuation">,</span> num<span class="token punctuation">,</span> size<span class="token punctuation">,</span> vertex<span class="token punctuation">)</span>
    text <span class="token operator">=</span> string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;Move dir=%d, num=%d&quot;</span><span class="token punctuation">,</span> dir<span class="token punctuation">,</span> num<span class="token punctuation">)</span>
    <span class="token keyword">local</span> p1 <span class="token operator">=</span> <span class="token function">POSITION</span><span class="token punctuation">(</span>flat<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span> flat<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">,</span> flat<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>z<span class="token punctuation">)</span>
    <span class="token keyword">local</span> p2 <span class="token operator">=</span> <span class="token function">POSITION</span><span class="token punctuation">(</span>flat<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span> flat<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">,</span> flat<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>z<span class="token punctuation">)</span>
    <span class="token keyword">local</span> toAxes <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token string">'z'</span><span class="token punctuation">,</span> <span class="token string">'z'</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">}</span>
    <span class="token keyword">local</span> values <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span>
    <span class="token keyword">local</span> axis <span class="token operator">=</span> toAxes<span class="token punctuation">[</span>dir<span class="token punctuation">]</span>

    <span class="token keyword">local</span> axes <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token string">'z'</span><span class="token punctuation">}</span>
    <span class="token keyword">local</span> axisIndex
    <span class="token keyword">for</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">#</span>axes <span class="token keyword">do</span>
        <span class="token keyword">if</span> axis <span class="token operator">==</span> axes<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token keyword">then</span>
            axisIndex <span class="token operator">=</span> i
        <span class="token keyword">else</span>
            <span class="token keyword">if</span> p1<span class="token punctuation">[</span>axes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> p2<span class="token punctuation">[</span>axes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token keyword">then</span>
                p1<span class="token punctuation">[</span>axes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> p1<span class="token punctuation">[</span>axes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span>
                p2<span class="token punctuation">[</span>axes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> p2<span class="token punctuation">[</span>axes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token operator">-</span><span class="token number">1</span>
            <span class="token keyword">elseif</span> p1<span class="token punctuation">[</span>axes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> p2<span class="token punctuation">[</span>axes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token keyword">then</span>
                p1<span class="token punctuation">[</span>axes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> p1<span class="token punctuation">[</span>axes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token operator">-</span><span class="token number">1</span>
                p2<span class="token punctuation">[</span>axes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> p2<span class="token punctuation">[</span>axes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span>
            <span class="token keyword">else</span>
                p1<span class="token punctuation">[</span>axes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> p1<span class="token punctuation">[</span>axes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span>
                p2<span class="token punctuation">[</span>axes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> p2<span class="token punctuation">[</span>axes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token operator">-</span><span class="token number">1</span>
            <span class="token keyword">end</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>
    table<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>axes<span class="token punctuation">,</span> axisIndex<span class="token punctuation">)</span>
    values <span class="token operator">=</span> <span class="token punctuation">{</span> values<span class="token punctuation">[</span>dir<span class="token punctuation">]</span> <span class="token punctuation">}</span>
    <span class="token keyword">for</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">#</span>axes <span class="token keyword">do</span>
        <span class="token keyword">if</span> p1<span class="token punctuation">[</span>axes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> p2<span class="token punctuation">[</span>axes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token keyword">then</span>
            values<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
        <span class="token keyword">else</span>
            values<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>

    <span class="token keyword">local</span> limits <span class="token operator">=</span> size
    <span class="token keyword">local</span> t1 <span class="token operator">=</span> <span class="token function">POSITION</span><span class="token punctuation">(</span>p1<span class="token punctuation">.</span>x<span class="token punctuation">,</span> p1<span class="token punctuation">.</span>y<span class="token punctuation">,</span> p1<span class="token punctuation">.</span>z<span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> num <span class="token keyword">do</span>
        <span class="token keyword">local</span> t2 <span class="token operator">=</span> <span class="token function">POSITION</span><span class="token punctuation">(</span>t1<span class="token punctuation">.</span>x<span class="token punctuation">,</span> t1<span class="token punctuation">.</span>y<span class="token punctuation">,</span> t1<span class="token punctuation">.</span>z<span class="token punctuation">)</span>
        <span class="token keyword">for</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> limits<span class="token punctuation">[</span>axes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token keyword">do</span>
            <span class="token keyword">local</span> t3 <span class="token operator">=</span> <span class="token function">POSITION</span><span class="token punctuation">(</span>t2<span class="token punctuation">.</span>x<span class="token punctuation">,</span> t2<span class="token punctuation">.</span>y<span class="token punctuation">,</span> t2<span class="token punctuation">.</span>z<span class="token punctuation">)</span>
            <span class="token keyword">for</span> k <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> limits<span class="token punctuation">[</span>axes<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token keyword">do</span>
                <span class="token keyword">local</span> moveP <span class="token operator">=</span> <span class="token function">POSITION</span><span class="token punctuation">(</span>t3<span class="token punctuation">.</span>x<span class="token punctuation">,</span> t3<span class="token punctuation">.</span>y<span class="token punctuation">,</span> t3<span class="token punctuation">.</span>z<span class="token punctuation">)</span>
                <span class="token keyword">local</span> ret<span class="token punctuation">,</span> id <span class="token operator">=</span> Block<span class="token punctuation">:</span><span class="token function">getBlockID</span><span class="token punctuation">(</span>t3<span class="token punctuation">.</span>x<span class="token punctuation">,</span> t3<span class="token punctuation">.</span>y<span class="token punctuation">,</span> t3<span class="token punctuation">.</span>z<span class="token punctuation">)</span>
                <span class="token keyword">local</span> ret<span class="token punctuation">,</span> data <span class="token operator">=</span> Block<span class="token punctuation">:</span><span class="token function">getBlockData</span><span class="token punctuation">(</span>t3<span class="token punctuation">.</span>x<span class="token punctuation">,</span> t3<span class="token punctuation">.</span>y<span class="token punctuation">,</span> t3<span class="token punctuation">.</span>z<span class="token punctuation">)</span>
                moveP<span class="token punctuation">[</span>axis<span class="token punctuation">]</span> <span class="token operator">=</span> moveP<span class="token punctuation">[</span>axis<span class="token punctuation">]</span> <span class="token operator">-</span> values<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> SEPARATE_DISTANCE
                <span class="token keyword">if</span> id <span class="token operator">==</span> BLOCK_ERROR <span class="token keyword">then</span>
                    id <span class="token operator">=</span> BLOCK_NORMAL
                <span class="token keyword">end</span>
                Block<span class="token punctuation">:</span><span class="token function">setBlockAll</span><span class="token punctuation">(</span>moveP<span class="token punctuation">.</span>x<span class="token punctuation">,</span> moveP<span class="token punctuation">.</span>y<span class="token punctuation">,</span> moveP<span class="token punctuation">.</span>z<span class="token punctuation">,</span> id<span class="token punctuation">,</span> data<span class="token punctuation">)</span>
                Block<span class="token punctuation">:</span><span class="token function">destroyBlock</span><span class="token punctuation">(</span>t3<span class="token punctuation">.</span>x<span class="token punctuation">,</span> t3<span class="token punctuation">.</span>y<span class="token punctuation">,</span> t3<span class="token punctuation">.</span>z<span class="token punctuation">,</span> <span class="token keyword">false</span><span class="token punctuation">)</span>

                t3<span class="token punctuation">[</span>axes<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> t3<span class="token punctuation">[</span>axes<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">+</span> values<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>
            <span class="token keyword">end</span>
            t2<span class="token punctuation">[</span>axes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> t2<span class="token punctuation">[</span>axes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">+</span> values<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
        <span class="token keyword">end</span>
        t1<span class="token punctuation">[</span>axis<span class="token punctuation">]</span> <span class="token operator">=</span> t1<span class="token punctuation">[</span>axis<span class="token punctuation">]</span> <span class="token operator">+</span> values<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token keyword">end</span>

    vertex<span class="token punctuation">[</span>axis<span class="token punctuation">]</span> <span class="token operator">=</span> vertex<span class="token punctuation">[</span>axis<span class="token punctuation">]</span> <span class="token operator">-</span> values<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> SEPARATE_DISTANCE
<span class="token keyword">end</span>

<span class="token keyword">function</span> <span class="token function">dye</span><span class="token punctuation">(</span>area<span class="token punctuation">,</span> pos<span class="token punctuation">,</span> tool<span class="token punctuation">)</span>
    <span class="token keyword">local</span> index <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">if</span> tool <span class="token operator">==</span> TOOLS_ID_DYE<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">then</span>
        index <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">else</span>
        index <span class="token operator">=</span> <span class="token number">2</span>
    <span class="token keyword">end</span>

    Block<span class="token punctuation">:</span><span class="token function">setBlockAll</span><span class="token punctuation">(</span>pos<span class="token punctuation">.</span>x<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>y<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>z<span class="token punctuation">,</span> BLOCK_ANSWER<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">,</span> DATA_ANSWER<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token function">verifySingleBlockInAnswerArea</span><span class="token punctuation">(</span>area<span class="token punctuation">,</span> pos<span class="token punctuation">)</span> <span class="token keyword">then</span>
        <span class="token function">checkCompletion</span><span class="token punctuation">(</span>area<span class="token punctuation">)</span>
    <span class="token keyword">else</span>
        <span class="token function">setErrorBlock</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span>
    <span class="token keyword">end</span>
<span class="token keyword">end</span>

<span class="token keyword">function</span> <span class="token function">setErrorBlock</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span>
    Block<span class="token punctuation">:</span><span class="token function">setBlockAll</span><span class="token punctuation">(</span>pos<span class="token punctuation">.</span>x<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>y<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>z<span class="token punctuation">,</span> BLOCK_ERROR<span class="token punctuation">)</span>
    table<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>errorPoints<span class="token punctuation">,</span> <span class="token punctuation">{</span>pos <span class="token operator">=</span> pos<span class="token punctuation">,</span> time <span class="token operator">=</span> os<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token keyword">function</span> <span class="token function">verifySingleBlockInAnswerArea</span><span class="token punctuation">(</span>area<span class="token punctuation">,</span> pos<span class="token punctuation">)</span>
    <span class="token keyword">local</span> targetPoint <span class="token operator">=</span> <span class="token function">mapping</span><span class="token punctuation">(</span>area<span class="token punctuation">,</span> pos<span class="token punctuation">)</span>
    <span class="token keyword">local</span> ret<span class="token punctuation">,</span> hitID <span class="token operator">=</span> Block<span class="token punctuation">:</span><span class="token function">getBlockID</span><span class="token punctuation">(</span>pos<span class="token punctuation">.</span>x<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>y<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>z<span class="token punctuation">)</span>
    <span class="token keyword">local</span> ret<span class="token punctuation">,</span> targetID <span class="token operator">=</span> Block<span class="token punctuation">:</span><span class="token function">getBlockID</span><span class="token punctuation">(</span>targetPoint<span class="token punctuation">.</span>x<span class="token punctuation">,</span> targetPoint<span class="token punctuation">.</span>y<span class="token punctuation">,</span> targetPoint<span class="token punctuation">.</span>z<span class="token punctuation">)</span>
    <span class="token keyword">local</span> text <span class="token operator">=</span> <span class="token function">tostring</span><span class="token punctuation">(</span>hitID<span class="token punctuation">)</span>  <span class="token operator">..</span> <span class="token string">&quot; : &quot;</span> <span class="token operator">..</span> <span class="token function">tostring</span><span class="token punctuation">(</span>targetID<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token function">isPrompt</span><span class="token punctuation">(</span>hitID<span class="token punctuation">)</span> <span class="token operator">~=</span> <span class="token number">0</span> <span class="token keyword">then</span>
        hitID <span class="token operator">=</span> BLOCK_AIR
    <span class="token keyword">end</span>
    <span class="token keyword">if</span> hitID <span class="token operator">==</span> targetID <span class="token keyword">then</span>
        <span class="token keyword">return</span> <span class="token keyword">true</span>
    <span class="token keyword">else</span>
        <span class="token comment">--Block:setBlockAll(pos.x, pos.y, pos.z, BLOCK_ERROR)</span>
        <span class="token comment">--table.insert(errorPoints, {pos = pos, time = os.time()})</span>
        <span class="token keyword">return</span> <span class="token keyword">false</span>
    <span class="token keyword">end</span>
<span class="token keyword">end</span>

<span class="token keyword">function</span> <span class="token function">startReset</span><span class="token punctuation">(</span>area<span class="token punctuation">)</span>
    <span class="token keyword">local</span> puzzle <span class="token operator">=</span> area<span class="token punctuation">.</span>puzzle
    area<span class="token punctuation">.</span>reset<span class="token punctuation">.</span>num <span class="token operator">=</span> <span class="token number">1</span>
    area<span class="token punctuation">.</span>reset<span class="token punctuation">.</span>pos <span class="token operator">=</span> <span class="token function">POSITION</span><span class="token punctuation">(</span>puzzle<span class="token punctuation">.</span>srcPos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span> puzzle<span class="token punctuation">.</span>srcPos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">,</span> puzzle<span class="token punctuation">.</span>srcPos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>z<span class="token punctuation">)</span>
    <span class="token keyword">local</span> axes <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token string">'z'</span><span class="token punctuation">,</span> <span class="token string">'z'</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token function">hasSeparatePart</span><span class="token punctuation">(</span>area<span class="token punctuation">.</span>separation<span class="token punctuation">,</span> axes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">then</span>
        <span class="token keyword">local</span> history <span class="token operator">=</span> area<span class="token punctuation">.</span>separation<span class="token punctuation">.</span>history<span class="token punctuation">[</span>axes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>

        <span class="token keyword">if</span> history <span class="token keyword">then</span>
            <span class="token keyword">local</span> p1 <span class="token operator">=</span> puzzle<span class="token punctuation">.</span>flats<span class="token punctuation">[</span>history<span class="token punctuation">.</span>flatIndex<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
            <span class="token keyword">local</span> p2 <span class="token operator">=</span> puzzle<span class="token punctuation">.</span>flats<span class="token punctuation">[</span>history<span class="token punctuation">.</span>flatIndex<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
            <span class="token keyword">local</span> values <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span>
            <span class="token keyword">if</span> history<span class="token punctuation">.</span>num <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token keyword">then</span>
                <span class="token keyword">for</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> history<span class="token punctuation">.</span>num<span class="token operator">-</span><span class="token number">2</span> <span class="token keyword">do</span>
                    p1<span class="token punctuation">[</span>axes<span class="token punctuation">[</span>history<span class="token punctuation">.</span>dir<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> p1<span class="token punctuation">[</span>axes<span class="token punctuation">[</span>history<span class="token punctuation">.</span>dir<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">-</span> values<span class="token punctuation">[</span>history<span class="token punctuation">.</span>dir<span class="token punctuation">]</span>
                    p2<span class="token punctuation">[</span>axes<span class="token punctuation">[</span>history<span class="token punctuation">.</span>dir<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> p2<span class="token punctuation">[</span>axes<span class="token punctuation">[</span>history<span class="token punctuation">.</span>dir<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">-</span> values<span class="token punctuation">[</span>history<span class="token punctuation">.</span>dir<span class="token punctuation">]</span>
                <span class="token keyword">end</span>
            <span class="token keyword">end</span>
            <span class="token keyword">local</span> size <span class="token operator">=</span> <span class="token function">POSITION</span><span class="token punctuation">(</span>puzzle<span class="token punctuation">.</span>size<span class="token punctuation">.</span>length<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">,</span> puzzle<span class="token punctuation">.</span>size<span class="token punctuation">.</span>height<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">,</span> puzzle<span class="token punctuation">.</span>size<span class="token punctuation">.</span>width<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span>

            <span class="token function">move</span><span class="token punctuation">(</span><span class="token punctuation">{</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">}</span><span class="token punctuation">,</span> history<span class="token punctuation">.</span>dir<span class="token punctuation">,</span> history<span class="token punctuation">.</span>num<span class="token punctuation">,</span> size<span class="token punctuation">,</span> history<span class="token punctuation">.</span>vertex<span class="token punctuation">)</span>

            area<span class="token punctuation">.</span>separation<span class="token punctuation">.</span>times<span class="token punctuation">[</span>axes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
            area<span class="token punctuation">.</span>separation<span class="token punctuation">.</span>history<span class="token punctuation">[</span>axes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">nil</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>
    <span class="token keyword">if</span> <span class="token function">hasSeparatePart</span><span class="token punctuation">(</span>area<span class="token punctuation">.</span>separation<span class="token punctuation">,</span> axes<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">then</span>
        <span class="token keyword">local</span> history <span class="token operator">=</span> area<span class="token punctuation">.</span>separation<span class="token punctuation">.</span>history<span class="token punctuation">[</span>axes<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span>

        <span class="token keyword">if</span> history <span class="token keyword">then</span>
            <span class="token keyword">local</span> p1 <span class="token operator">=</span> puzzle<span class="token punctuation">.</span>flats<span class="token punctuation">[</span>history<span class="token punctuation">.</span>flatIndex<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
            <span class="token keyword">local</span> p2 <span class="token operator">=</span> puzzle<span class="token punctuation">.</span>flats<span class="token punctuation">[</span>history<span class="token punctuation">.</span>flatIndex<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
            <span class="token keyword">local</span> values <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span>
            <span class="token keyword">if</span> history<span class="token punctuation">.</span>num <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token keyword">then</span>
                <span class="token keyword">for</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> history<span class="token punctuation">.</span>num<span class="token operator">-</span><span class="token number">2</span> <span class="token keyword">do</span>
                    p1<span class="token punctuation">[</span>axes<span class="token punctuation">[</span>history<span class="token punctuation">.</span>dir<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> p1<span class="token punctuation">[</span>axes<span class="token punctuation">[</span>history<span class="token punctuation">.</span>dir<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">-</span> values<span class="token punctuation">[</span>history<span class="token punctuation">.</span>dir<span class="token punctuation">]</span>
                    p2<span class="token punctuation">[</span>axes<span class="token punctuation">[</span>history<span class="token punctuation">.</span>dir<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> p2<span class="token punctuation">[</span>axes<span class="token punctuation">[</span>history<span class="token punctuation">.</span>dir<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">-</span> values<span class="token punctuation">[</span>history<span class="token punctuation">.</span>dir<span class="token punctuation">]</span>
                <span class="token keyword">end</span>
            <span class="token keyword">end</span>
            <span class="token keyword">local</span> size <span class="token operator">=</span> <span class="token function">POSITION</span><span class="token punctuation">(</span>puzzle<span class="token punctuation">.</span>size<span class="token punctuation">.</span>length<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">,</span> puzzle<span class="token punctuation">.</span>size<span class="token punctuation">.</span>height<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">,</span> puzzle<span class="token punctuation">.</span>size<span class="token punctuation">.</span>width<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span>

            <span class="token function">move</span><span class="token punctuation">(</span><span class="token punctuation">{</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">}</span><span class="token punctuation">,</span> history<span class="token punctuation">.</span>dir<span class="token punctuation">,</span> history<span class="token punctuation">.</span>num<span class="token punctuation">,</span> size<span class="token punctuation">,</span> history<span class="token punctuation">.</span>vertex<span class="token punctuation">)</span>

            area<span class="token punctuation">.</span>separation<span class="token punctuation">.</span>times<span class="token punctuation">[</span>axes<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
            area<span class="token punctuation">.</span>separation<span class="token punctuation">.</span>history<span class="token punctuation">[</span>axes<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">nil</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>
    <span class="token function">updateAreaFlats</span><span class="token punctuation">(</span>puzzle<span class="token punctuation">)</span>
    <span class="token function">updateAreaSize</span><span class="token punctuation">(</span>puzzle<span class="token punctuation">)</span>
    area<span class="token punctuation">.</span>isResetting <span class="token operator">=</span> <span class="token keyword">true</span>
    area<span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">end</span>

<span class="token keyword">function</span> <span class="token function">resetting</span><span class="token punctuation">(</span>area<span class="token punctuation">)</span>
    <span class="token keyword">if</span> area<span class="token punctuation">.</span>reset<span class="token punctuation">.</span>num <span class="token operator">&lt;=</span> <span class="token operator">#</span>area<span class="token punctuation">.</span>reset<span class="token punctuation">.</span>data <span class="token keyword">then</span>
        <span class="token keyword">local</span> data <span class="token operator">=</span> area<span class="token punctuation">.</span>reset<span class="token punctuation">.</span>data<span class="token punctuation">[</span>area<span class="token punctuation">.</span>reset<span class="token punctuation">.</span>num<span class="token punctuation">]</span>
        <span class="token keyword">local</span> pos <span class="token operator">=</span> data<span class="token punctuation">.</span>pos
        <span class="token keyword">local</span> id <span class="token operator">=</span> data<span class="token punctuation">.</span>id
        Block<span class="token punctuation">:</span><span class="token function">setBlockAll</span><span class="token punctuation">(</span>pos<span class="token punctuation">.</span>x<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>y<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>z<span class="token punctuation">,</span> BLOCK_NORMAL<span class="token punctuation">)</span>
        area<span class="token punctuation">.</span>reset<span class="token punctuation">.</span>num <span class="token operator">=</span> area<span class="token punctuation">.</span>reset<span class="token punctuation">.</span>num <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token keyword">else</span>
        <span class="token keyword">for</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">#</span>area<span class="token punctuation">.</span>puzzle<span class="token punctuation">.</span>flats <span class="token keyword">do</span>
            <span class="token function">updateDigitalPrompt</span><span class="token punctuation">(</span>area<span class="token punctuation">,</span> area<span class="token punctuation">.</span>puzzle<span class="token punctuation">.</span>flats<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span>
        <span class="token keyword">end</span>
        <span class="token keyword">local</span> resetP <span class="token operator">=</span> LEVEL_CONFIG<span class="token punctuation">[</span>area<span class="token punctuation">.</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>RESET<span class="token punctuation">.</span>POS
        <span class="token keyword">local</span> ret<span class="token punctuation">,</span> data <span class="token operator">=</span> Block<span class="token punctuation">:</span><span class="token function">getBlockData</span><span class="token punctuation">(</span>resetP<span class="token punctuation">.</span>x<span class="token punctuation">,</span> resetP<span class="token punctuation">.</span>y<span class="token punctuation">,</span> resetP<span class="token punctuation">.</span>z<span class="token punctuation">)</span>
        <span class="token keyword">if</span> data <span class="token operator">&gt;=</span> <span class="token number">8</span> <span class="token keyword">then</span>
            data <span class="token operator">=</span> data <span class="token operator">-</span> <span class="token number">8</span>
        <span class="token keyword">end</span>
        Block<span class="token punctuation">:</span><span class="token function">setBlockAll</span><span class="token punctuation">(</span>resetP<span class="token punctuation">.</span>x<span class="token punctuation">,</span> resetP<span class="token punctuation">.</span>y<span class="token punctuation">,</span> resetP<span class="token punctuation">.</span>z<span class="token punctuation">,</span> BLOCK_SWITCH<span class="token punctuation">,</span> data<span class="token punctuation">)</span>
        area<span class="token punctuation">.</span>isResetting <span class="token operator">=</span> <span class="token keyword">false</span>
    <span class="token keyword">end</span>
<span class="token keyword">end</span>

<span class="token keyword">function</span> <span class="token function">initAreaAttributes</span><span class="token punctuation">(</span>areaPos<span class="token punctuation">)</span>
    <span class="token keyword">local</span> attributes <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">local</span> p1 <span class="token operator">=</span> areaPos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token keyword">local</span> p2 <span class="token operator">=</span> areaPos<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>

    attributes<span class="token punctuation">.</span>srcPos <span class="token operator">=</span> areaPos

    attributes<span class="token punctuation">.</span>curPos <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token function">POSITION</span><span class="token punctuation">(</span>p1<span class="token punctuation">.</span>x<span class="token punctuation">,</span> p1<span class="token punctuation">.</span>y<span class="token punctuation">,</span> p1<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">POSITION</span><span class="token punctuation">(</span>p2<span class="token punctuation">.</span>x<span class="token punctuation">,</span> p2<span class="token punctuation">.</span>y<span class="token punctuation">,</span> p2<span class="token punctuation">.</span>z<span class="token punctuation">)</span> <span class="token punctuation">}</span>

    <span class="token function">updateAreaSize</span><span class="token punctuation">(</span>attributes<span class="token punctuation">)</span>

    <span class="token function">updateAreaFlats</span><span class="token punctuation">(</span>attributes<span class="token punctuation">)</span>

    attributes<span class="token punctuation">.</span>midValues <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">local</span> int<span class="token punctuation">,</span> _ <span class="token operator">=</span> math<span class="token punctuation">.</span><span class="token function">modf</span><span class="token punctuation">(</span><span class="token punctuation">(</span>attributes<span class="token punctuation">.</span>flats<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>z<span class="token operator">+</span> attributes<span class="token punctuation">.</span>flats<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span>
    table<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>attributes<span class="token punctuation">.</span>midValues<span class="token punctuation">,</span> int<span class="token punctuation">)</span>
    int<span class="token punctuation">,</span> _ <span class="token operator">=</span> math<span class="token punctuation">.</span><span class="token function">modf</span><span class="token punctuation">(</span><span class="token punctuation">(</span>attributes<span class="token punctuation">.</span>flats<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>z<span class="token operator">+</span> attributes<span class="token punctuation">.</span>flats<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span>
    table<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>attributes<span class="token punctuation">.</span>midValues<span class="token punctuation">,</span> int<span class="token punctuation">)</span>
    int<span class="token punctuation">,</span> _ <span class="token operator">=</span> math<span class="token punctuation">.</span><span class="token function">modf</span><span class="token punctuation">(</span><span class="token punctuation">(</span>attributes<span class="token punctuation">.</span>flats<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token operator">+</span> attributes<span class="token punctuation">.</span>flats<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span>
    table<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>attributes<span class="token punctuation">.</span>midValues<span class="token punctuation">,</span> int<span class="token punctuation">)</span>
    int<span class="token punctuation">,</span> _ <span class="token operator">=</span> math<span class="token punctuation">.</span><span class="token function">modf</span><span class="token punctuation">(</span><span class="token punctuation">(</span>attributes<span class="token punctuation">.</span>flats<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token operator">+</span> attributes<span class="token punctuation">.</span>flats<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span>
    table<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>attributes<span class="token punctuation">.</span>midValues<span class="token punctuation">,</span> int<span class="token punctuation">)</span>

    <span class="token keyword">return</span> attributes<span class="token punctuation">;</span>
<span class="token keyword">end</span>

<span class="token keyword">function</span> <span class="token function">initializeLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">#</span>LEVEL_CONFIG <span class="token keyword">do</span>
        <span class="token keyword">local</span> config <span class="token operator">=</span> LEVEL_CONFIG<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        <span class="token keyword">local</span> area <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        area<span class="token punctuation">.</span>index <span class="token operator">=</span> i

        area<span class="token punctuation">.</span>puzzle <span class="token operator">=</span> <span class="token function">initAreaAttributes</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>PUZZLE<span class="token punctuation">)</span>
        area<span class="token punctuation">.</span>answer <span class="token operator">=</span> <span class="token function">initAreaAttributes</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>ANSWER<span class="token punctuation">)</span>

        area<span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token number">0</span>

        area<span class="token punctuation">.</span>separation <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        area<span class="token punctuation">.</span>separation<span class="token punctuation">.</span>times <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        area<span class="token punctuation">.</span>separation<span class="token punctuation">.</span>history <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

        area<span class="token punctuation">.</span>num <span class="token operator">=</span> <span class="token number">0</span>
        area<span class="token punctuation">.</span>reset <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        area<span class="token punctuation">.</span>reset<span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token keyword">for</span> x <span class="token operator">=</span> area<span class="token punctuation">.</span>puzzle<span class="token punctuation">.</span>curPos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span> area<span class="token punctuation">.</span>puzzle<span class="token punctuation">.</span>curPos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token operator">+</span>area<span class="token punctuation">.</span>puzzle<span class="token punctuation">.</span>size<span class="token punctuation">.</span>length<span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">do</span>
            <span class="token keyword">for</span> y <span class="token operator">=</span> area<span class="token punctuation">.</span>puzzle<span class="token punctuation">.</span>curPos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">,</span> area<span class="token punctuation">.</span>puzzle<span class="token punctuation">.</span>curPos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token operator">+</span>area<span class="token punctuation">.</span>puzzle<span class="token punctuation">.</span>size<span class="token punctuation">.</span>height<span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">do</span>
                <span class="token keyword">for</span> z <span class="token operator">=</span> area<span class="token punctuation">.</span>puzzle<span class="token punctuation">.</span>curPos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>z<span class="token punctuation">,</span> area<span class="token punctuation">.</span>puzzle<span class="token punctuation">.</span>curPos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>z<span class="token operator">+</span>area<span class="token punctuation">.</span>puzzle<span class="token punctuation">.</span>size<span class="token punctuation">.</span>width<span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">do</span>
                    <span class="token keyword">local</span> ret<span class="token punctuation">,</span> id <span class="token operator">=</span> Block<span class="token punctuation">:</span><span class="token function">getBlockID</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">)</span>
                    table<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>area<span class="token punctuation">.</span>reset<span class="token punctuation">.</span>data<span class="token punctuation">,</span> <span class="token punctuation">{</span>id <span class="token operator">=</span> id<span class="token punctuation">,</span> pos <span class="token operator">=</span> <span class="token function">POSITION</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
                    <span class="token keyword">if</span> id <span class="token operator">~=</span> BLOCK_AIR <span class="token keyword">then</span>
                        area<span class="token punctuation">.</span>num <span class="token operator">=</span> area<span class="token punctuation">.</span>num <span class="token operator">+</span> <span class="token number">1</span>
                    <span class="token keyword">end</span>
                <span class="token keyword">end</span>
            <span class="token keyword">end</span>
        <span class="token keyword">end</span>

        <span class="token keyword">for</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">#</span>area<span class="token punctuation">.</span>answer<span class="token punctuation">.</span>flats <span class="token keyword">do</span>
            <span class="token function">updateDigitalPrompt</span><span class="token punctuation">(</span>area<span class="token punctuation">,</span> area<span class="token punctuation">.</span>answer<span class="token punctuation">.</span>flats<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> j<span class="token punctuation">)</span>
            <span class="token function">updateDigitalPrompt</span><span class="token punctuation">(</span>area<span class="token punctuation">,</span> area<span class="token punctuation">.</span>puzzle<span class="token punctuation">.</span>flats<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> j<span class="token punctuation">)</span>
        <span class="token keyword">end</span>

        <span class="token keyword">if</span> config<span class="token punctuation">.</span>TRANSFER <span class="token keyword">then</span>
            <span class="token keyword">local</span> tr <span class="token operator">=</span> config<span class="token punctuation">.</span>TRANSFER<span class="token punctuation">.</span>POS
            <span class="token keyword">local</span> _<span class="token punctuation">,</span> id <span class="token operator">=</span> Block<span class="token punctuation">:</span><span class="token function">getBlockID</span><span class="token punctuation">(</span>tr<span class="token punctuation">.</span>x<span class="token punctuation">,</span> tr<span class="token punctuation">.</span>y<span class="token punctuation">,</span> tr<span class="token punctuation">.</span>z<span class="token punctuation">)</span>
            <span class="token keyword">if</span> id <span class="token operator">==</span> BLOCK_ACTIVE <span class="token keyword">then</span>
                Block<span class="token punctuation">:</span><span class="token function">setBlockAll</span><span class="token punctuation">(</span>tr<span class="token punctuation">.</span>x<span class="token punctuation">,</span> tr<span class="token punctuation">.</span>y<span class="token punctuation">,</span> tr<span class="token punctuation">.</span>z<span class="token punctuation">,</span> BLOCK_AIR<span class="token punctuation">)</span>
            <span class="token keyword">end</span>
        <span class="token keyword">end</span>

        table<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>areas<span class="token punctuation">,</span> area<span class="token punctuation">)</span>
    <span class="token keyword">end</span>

<span class="token keyword">end</span>

<span class="token keyword">function</span> <span class="token function">listenevents_minesweeper</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">--local ScriptSupportEvent = class.ScriptSupportEvent.new()</span>

    <span class="token keyword">local</span> listenBlocks <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">{</span> BLOCK_NORMAL <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> BLOCK_FLOOR <span class="token punctuation">}</span>
    <span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">668</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">669</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">670</span><span class="token punctuation">}</span>
    <span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">671</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">672</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">673</span><span class="token punctuation">}</span>
    <span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">674</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">675</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">676</span><span class="token punctuation">}</span>
    <span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">677</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">678</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">679</span><span class="token punctuation">}</span>
    <span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">680</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">681</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">682</span><span class="token punctuation">}</span>
    <span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">1080</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> BLOCK_ACTIVE <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">724</span><span class="token punctuation">}</span> <span class="token punctuation">}</span>
    <span class="token keyword">for</span> i <span class="token operator">=</span> ID_prompts<span class="token punctuation">.</span>min<span class="token punctuation">,</span> ID_prompts<span class="token punctuation">.</span>max <span class="token keyword">do</span>
        table<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>listenBlocks<span class="token punctuation">,</span> <span class="token punctuation">{</span>i<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">end</span>

    ScriptSupportEvent<span class="token punctuation">:</span><span class="token function">registerEvent</span><span class="token punctuation">(</span><span class="token string">&quot;Game.Start&quot;</span><span class="token punctuation">,</span> minesweeper_game_started<span class="token punctuation">)</span>

    ScriptSupportEvent<span class="token punctuation">:</span><span class="token function">registerEvent</span><span class="token punctuation">(</span><span class="token string">&quot;Game.Run&quot;</span><span class="token punctuation">,</span> minesweeper_game_run<span class="token punctuation">)</span>

    ScriptSupportEvent<span class="token punctuation">:</span><span class="token function">registerEvent</span><span class="token punctuation">(</span><span class="token string">'Actor.Projectile.Hit'</span><span class="token punctuation">,</span> minesweeper_actor_projectilehit<span class="token punctuation">)</span>

    ScriptSupportEvent<span class="token punctuation">:</span><span class="token function">registerEvent_Block</span><span class="token punctuation">(</span><span class="token string">'Block.DestroyBy'</span><span class="token punctuation">,</span> minesweeper_block_destroyedby<span class="token punctuation">,</span> listenBlocks<span class="token punctuation">)</span>

    ScriptSupportEvent<span class="token punctuation">:</span><span class="token function">registerEvent_Block</span><span class="token punctuation">(</span><span class="token string">'Block.Trigger'</span><span class="token punctuation">,</span> minesweeper_block_trigger<span class="token punctuation">,</span> listenBlocks<span class="token punctuation">)</span>

    ScriptSupportEvent<span class="token punctuation">:</span><span class="token function">registerEvent</span><span class="token punctuation">(</span><span class="token string">&quot;Player.PickUpItem&quot;</span><span class="token punctuation">,</span> minesweeper_player_pickupitem<span class="token punctuation">)</span>

    ScriptSupportEvent<span class="token punctuation">:</span><span class="token function">registerEvent</span><span class="token punctuation">(</span><span class="token string">&quot;Actor.Die&quot;</span><span class="token punctuation">,</span> minesweeper_monster_dead<span class="token punctuation">)</span>

    ScriptSupportEvent<span class="token punctuation">:</span><span class="token function">registerEvent</span><span class="token punctuation">(</span><span class="token string">&quot;Player.SelectShortcut&quot;</span><span class="token punctuation">,</span> minesweeper_player_selectshortcut<span class="token punctuation">)</span>

    <span class="token comment">--ScriptSupportEvent:listenEventList()</span>
<span class="token keyword">end</span>

minesweeper_game_started <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">sendSystemMsg</span><span class="token punctuation">(</span><span class="token string">&quot;Stone Code - You wake up in a mysterious maze and a boy stands in front of you. &quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">local</span> ret<span class="token punctuation">,</span> num<span class="token punctuation">,</span> array <span class="token operator">=</span> World<span class="token punctuation">:</span><span class="token function">getAllPlayers</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">initializeLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">end</span>

minesweeper_game_run <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token operator">#</span>errorPoints <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">then</span>
        <span class="token keyword">local</span> curTime <span class="token operator">=</span> os<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">local</span> i <span class="token operator">=</span> <span class="token number">1</span>
        <span class="token keyword">while</span> i <span class="token operator">&lt;=</span> <span class="token operator">#</span>errorPoints <span class="token keyword">do</span>
            <span class="token keyword">local</span> ep <span class="token operator">=</span> errorPoints<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
            <span class="token keyword">if</span> curTime <span class="token operator">-</span> ep<span class="token punctuation">.</span>time <span class="token operator">&gt;</span> ERROR_TIME <span class="token keyword">then</span>
                <span class="token keyword">local</span> ret<span class="token punctuation">,</span> id <span class="token operator">=</span> Block<span class="token punctuation">:</span><span class="token function">getBlockID</span><span class="token punctuation">(</span>ep<span class="token punctuation">.</span>pos<span class="token punctuation">.</span>x<span class="token punctuation">,</span> ep<span class="token punctuation">.</span>pos<span class="token punctuation">.</span>y<span class="token punctuation">,</span> ep<span class="token punctuation">.</span>pos<span class="token punctuation">.</span>z<span class="token punctuation">)</span>
                <span class="token keyword">if</span> id <span class="token operator">==</span> BLOCK_ERROR <span class="token keyword">then</span>
                    Block<span class="token punctuation">:</span><span class="token function">setBlockAll</span><span class="token punctuation">(</span>ep<span class="token punctuation">.</span>pos<span class="token punctuation">.</span>x<span class="token punctuation">,</span> ep<span class="token punctuation">.</span>pos<span class="token punctuation">.</span>y<span class="token punctuation">,</span> ep<span class="token punctuation">.</span>pos<span class="token punctuation">.</span>z<span class="token punctuation">,</span> BLOCK_NORMAL<span class="token punctuation">)</span>
                <span class="token keyword">end</span>
                table<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>errorPoints<span class="token punctuation">,</span> i<span class="token punctuation">)</span>
            <span class="token keyword">else</span>
                <span class="token keyword">break</span>
            <span class="token keyword">end</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>

    <span class="token keyword">for</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">#</span>areas <span class="token keyword">do</span>
        <span class="token keyword">if</span> areas<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>isResetting <span class="token keyword">then</span>
            <span class="token function">resetting</span><span class="token punctuation">(</span>areas<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>

<span class="token keyword">end</span>

minesweeper_actor_projectilehit <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>
    <span class="token keyword">local</span> blockid<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">,</span> eventobjid <span class="token operator">=</span> params<span class="token punctuation">.</span>blockid<span class="token punctuation">,</span> params<span class="token punctuation">.</span>x<span class="token punctuation">,</span> params<span class="token punctuation">.</span>y<span class="token punctuation">,</span> params<span class="token punctuation">.</span>z<span class="token punctuation">,</span> params<span class="token punctuation">.</span>eventobjid<span class="token punctuation">;</span>
    <span class="token keyword">local</span> text <span class="token operator">=</span> string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;Hit %d,%d,%d,%d&quot;</span><span class="token punctuation">,</span>blockid<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">)</span>
    <span class="token keyword">local</span> tool <span class="token operator">=</span> TItem<span class="token punctuation">:</span><span class="token function">getItemID</span><span class="token punctuation">(</span>eventobjid<span class="token punctuation">)</span>
    <span class="token keyword">local</span> dir
    TItem<span class="token punctuation">:</span><span class="token function">destroyProjectile</span><span class="token punctuation">(</span>eventobjid<span class="token punctuation">)</span>
    <span class="token keyword">local</span> ret<span class="token punctuation">,</span> data <span class="token operator">=</span> Block<span class="token punctuation">:</span><span class="token function">getBlockData</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">)</span>
    <span class="token keyword">local</span> bIsPrompt <span class="token operator">=</span> <span class="token keyword">false</span>

    <span class="token keyword">local</span> pos <span class="token operator">=</span> <span class="token function">POSITION</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">)</span>
    <span class="token keyword">local</span> side
    <span class="token keyword">if</span> blockid <span class="token operator">~=</span> BLOCK_NORMAL <span class="token keyword">then</span>
        side <span class="token operator">=</span> <span class="token function">isPrompt</span><span class="token punctuation">(</span>blockid<span class="token punctuation">)</span>
        <span class="token keyword">if</span> side <span class="token operator">~=</span> <span class="token number">0</span> <span class="token keyword">then</span>
            <span class="token keyword">local</span> config <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">{</span><span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'z'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'z'</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span> <span class="token punctuation">}</span>
            <span class="token keyword">if</span> side <span class="token operator">==</span> <span class="token number">1</span> <span class="token keyword">then</span>
                <span class="token keyword">local</span> ret<span class="token punctuation">,</span> data <span class="token operator">=</span> Block<span class="token punctuation">:</span><span class="token function">getBlockData</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">)</span>
                <span class="token keyword">local</span> face <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span> <span class="token punctuation">}</span>
                <span class="token keyword">for</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">#</span>face <span class="token keyword">do</span>
                    <span class="token keyword">if</span> data <span class="token operator">==</span> face<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token keyword">then</span>
                        pos<span class="token punctuation">[</span>config<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> pos<span class="token punctuation">[</span>config<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">+</span> config<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
                        dir <span class="token operator">=</span> i
                        <span class="token keyword">break</span>
                    <span class="token keyword">end</span>
                <span class="token keyword">end</span>
            <span class="token keyword">elseif</span> side <span class="token operator">==</span> <span class="token number">2</span> <span class="token keyword">then</span>
                pos<span class="token punctuation">[</span>config<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> pos<span class="token punctuation">[</span>config<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">+</span> config<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
            <span class="token keyword">elseif</span> side <span class="token operator">==</span> <span class="token number">3</span> <span class="token keyword">then</span>
                pos<span class="token punctuation">[</span>config<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> pos<span class="token punctuation">[</span>config<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">+</span> config<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
            <span class="token keyword">end</span>
            <span class="token keyword">local</span> ret<span class="token punctuation">,</span> id <span class="token operator">=</span> Block<span class="token punctuation">:</span><span class="token function">getBlockID</span><span class="token punctuation">(</span>pos<span class="token punctuation">.</span>x<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>y<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>z<span class="token punctuation">)</span>
            bIsPrompt <span class="token operator">=</span> <span class="token keyword">true</span>
            blockid <span class="token operator">=</span> id
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>

    <span class="token keyword">local</span> area
    <span class="token keyword">for</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">#</span>areas <span class="token keyword">do</span>
        <span class="token keyword">if</span> <span class="token function">isInArea</span><span class="token punctuation">(</span>pos<span class="token punctuation">,</span> areas<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>puzzle<span class="token punctuation">)</span> <span class="token keyword">then</span>
            area <span class="token operator">=</span> areas<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
            <span class="token keyword">if</span> bIsPrompt <span class="token keyword">and</span> dir <span class="token keyword">then</span>

            <span class="token keyword">else</span>
                <span class="token keyword">for</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">#</span>area<span class="token punctuation">.</span>puzzle<span class="token punctuation">.</span>flats <span class="token keyword">do</span>
                    <span class="token keyword">if</span> <span class="token function">isInFlat</span><span class="token punctuation">(</span>pos<span class="token punctuation">,</span> area<span class="token punctuation">.</span>puzzle<span class="token punctuation">.</span>flats<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">then</span>
                        <span class="token keyword">local</span> flat <span class="token operator">=</span> area<span class="token punctuation">.</span>puzzle<span class="token punctuation">.</span>flats<span class="token punctuation">[</span>j<span class="token punctuation">]</span>
                        dir <span class="token operator">=</span> j
                        <span class="token keyword">if</span> dir <span class="token operator">&gt;=</span> <span class="token number">5</span> <span class="token keyword">then</span>
                            dir <span class="token operator">=</span> dir <span class="token operator">-</span> <span class="token number">3</span>
                        <span class="token keyword">end</span>
                        <span class="token keyword">break</span>
                    <span class="token keyword">end</span>
                <span class="token keyword">end</span>
            <span class="token keyword">end</span>

            <span class="token keyword">break</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>

    <span class="token keyword">if</span> <span class="token keyword">not</span> area <span class="token keyword">then</span>
        <span class="token keyword">return</span>
    <span class="token keyword">elseif</span> area<span class="token punctuation">.</span>isResetting <span class="token keyword">or</span> area<span class="token punctuation">.</span>state <span class="token operator">~=</span> <span class="token number">0</span> <span class="token keyword">then</span>
        <span class="token keyword">return</span>
    <span class="token keyword">end</span>

    <span class="token keyword">if</span> tool <span class="token operator">==</span> TOOLS_ID_SEPARATE <span class="token keyword">and</span> dir <span class="token keyword">then</span>
        <span class="token function">separate</span><span class="token punctuation">(</span>area<span class="token punctuation">,</span> pos<span class="token punctuation">,</span> dir<span class="token punctuation">)</span>
    <span class="token keyword">elseif</span> <span class="token function">isInclude</span><span class="token punctuation">(</span>tool<span class="token punctuation">,</span> TOOLS_ID_DYE<span class="token punctuation">)</span> <span class="token keyword">then</span>
        <span class="token keyword">if</span> blockid <span class="token operator">==</span> BLOCK_NORMAL <span class="token keyword">then</span>
            <span class="token function">dye</span><span class="token punctuation">(</span>area<span class="token punctuation">,</span> pos<span class="token punctuation">,</span> tool<span class="token punctuation">)</span>
        <span class="token keyword">end</span>
    <span class="token keyword">elseif</span> tool <span class="token operator">==</span> TOOLS_ID_DIG <span class="token keyword">then</span>
        <span class="token keyword">if</span> blockid <span class="token operator">==</span> BLOCK_NORMAL <span class="token keyword">then</span>
            Block<span class="token punctuation">:</span><span class="token function">destroyBlock</span><span class="token punctuation">(</span>pos<span class="token punctuation">.</span>x<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>y<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>z<span class="token punctuation">,</span> <span class="token keyword">false</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token function">verifySingleBlockInAnswerArea</span><span class="token punctuation">(</span>area<span class="token punctuation">,</span> pos<span class="token punctuation">)</span> <span class="token keyword">then</span>
                <span class="token function">updateSidesDigitalPrompt</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span>
                <span class="token function">checkCompletion</span><span class="token punctuation">(</span>area<span class="token punctuation">)</span>
            <span class="token keyword">else</span>
                <span class="token function">setErrorBlock</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span>
            <span class="token keyword">end</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>

<span class="token keyword">end</span>

minesweeper_block_destroyedby <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span>
    <span class="token keyword">local</span> blockid<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z <span class="token operator">=</span> param<span class="token punctuation">.</span>blockid<span class="token punctuation">,</span> param<span class="token punctuation">.</span>x<span class="token punctuation">,</span> param<span class="token punctuation">.</span>y<span class="token punctuation">,</span> param<span class="token punctuation">.</span>z<span class="token punctuation">;</span>
    <span class="token keyword">local</span> area
    <span class="token keyword">for</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">#</span>areas <span class="token keyword">do</span>
        <span class="token keyword">if</span> <span class="token function">isInArea</span><span class="token punctuation">(</span><span class="token function">POSITION</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">)</span><span class="token punctuation">,</span> areas<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>puzzle<span class="token punctuation">)</span> <span class="token keyword">then</span>
            area <span class="token operator">=</span> areas<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
            <span class="token keyword">break</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>

    <span class="token keyword">if</span> <span class="token keyword">not</span> area <span class="token keyword">then</span>
        <span class="token keyword">local</span> data <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">if</span> blockid <span class="token operator">==</span> BLOCK_SWITCH <span class="token keyword">then</span>
            <span class="token keyword">local</span> axes <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token string">'z'</span><span class="token punctuation">,</span> <span class="token string">'z'</span> <span class="token punctuation">}</span>
            <span class="token keyword">local</span> values <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">}</span>
            <span class="token keyword">local</span> toFace <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token punctuation">}</span>
            <span class="token keyword">for</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">#</span>axes <span class="token keyword">do</span>
                <span class="token keyword">local</span> pos <span class="token operator">=</span> <span class="token function">POSITION</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">)</span>
                pos<span class="token punctuation">[</span>axes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> pos<span class="token punctuation">[</span>axes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">+</span> values<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
                <span class="token keyword">local</span> ret<span class="token punctuation">,</span> id <span class="token operator">=</span> Block<span class="token punctuation">:</span><span class="token function">getBlockID</span><span class="token punctuation">(</span>pos<span class="token punctuation">.</span>x<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>y<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>z<span class="token punctuation">)</span>
                <span class="token keyword">if</span> id <span class="token operator">~=</span> BLOCK_AIR <span class="token keyword">then</span>
                    data <span class="token operator">=</span> toFace<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
                    <span class="token keyword">break</span>
                <span class="token keyword">end</span>
            <span class="token keyword">end</span>
        <span class="token keyword">end</span>
        Block<span class="token punctuation">:</span><span class="token function">setBlockAll</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">,</span> blockid<span class="token punctuation">,</span> data<span class="token punctuation">)</span>
        <span class="token keyword">return</span>
    <span class="token keyword">end</span>

    <span class="token keyword">if</span> blockid <span class="token operator">~=</span> BLOCK_NORMAL <span class="token keyword">or</span> area<span class="token punctuation">.</span>isResetting <span class="token keyword">then</span>
        <span class="token keyword">if</span> area<span class="token punctuation">.</span>isResetting <span class="token keyword">then</span>
            blockid <span class="token operator">=</span> BLOCK_NORMAL
        <span class="token keyword">end</span>
        Block<span class="token punctuation">:</span><span class="token function">setBlockAll</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">,</span> blockid<span class="token punctuation">)</span>
    <span class="token keyword">else</span>
        <span class="token keyword">if</span> <span class="token function">verifySingleBlockInAnswerArea</span><span class="token punctuation">(</span>area<span class="token punctuation">,</span> <span class="token function">POSITION</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">then</span>
            <span class="token function">updateSidesDigitalPrompt</span><span class="token punctuation">(</span><span class="token function">POSITION</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>
<span class="token keyword">end</span>

minesweeper_monster_dead <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>
    <span class="token keyword">local</span> objid <span class="token operator">=</span> params<span class="token punctuation">.</span>eventobjid
    <span class="token keyword">local</span> toobjid <span class="token operator">=</span> params<span class="token punctuation">.</span>toobjid
    <span class="token keyword">for</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">#</span>areas <span class="token keyword">do</span>
        <span class="token keyword">local</span> area <span class="token operator">=</span> areas<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        <span class="token keyword">if</span> area<span class="token punctuation">.</span>monsterids <span class="token keyword">then</span>
            <span class="token keyword">local</span> index
            <span class="token keyword">for</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">#</span>area<span class="token punctuation">.</span>monsterids <span class="token keyword">do</span>
                <span class="token keyword">if</span> objid <span class="token operator">==</span> area<span class="token punctuation">.</span>monsterids<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token keyword">then</span>
                    index <span class="token operator">=</span> j
                    <span class="token keyword">break</span>
                <span class="token keyword">end</span>
            <span class="token keyword">end</span>
            <span class="token keyword">if</span> index <span class="token keyword">then</span>
                table<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>area<span class="token punctuation">.</span>monsterids<span class="token punctuation">,</span> index<span class="token punctuation">)</span>
                <span class="token keyword">if</span> <span class="token operator">#</span>area<span class="token punctuation">.</span>monsterids <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">then</span>
                    <span class="token keyword">if</span> LEVEL_CONFIG<span class="token punctuation">[</span>area<span class="token punctuation">.</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>TRANSFER <span class="token keyword">then</span>
                        <span class="token keyword">local</span> tr <span class="token operator">=</span> LEVEL_CONFIG<span class="token punctuation">[</span>area<span class="token punctuation">.</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>TRANSFER<span class="token punctuation">.</span>POS
                        <span class="token comment">--Block:setBlockAll(tr.x, tr.y, tr.z, BLOCK_ACTIVE)</span>
                        <span class="token comment">--sendSystemMsg(&quot;A new portal is activated. &quot;)</span>
                    <span class="token keyword">end</span>
                <span class="token keyword">end</span>
            <span class="token keyword">end</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>

<span class="token keyword">end</span>

minesweeper_block_trigger <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>
    <span class="token keyword">local</span> blockid<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">,</span> eventobjid <span class="token operator">=</span> params<span class="token punctuation">.</span>blockid<span class="token punctuation">,</span> params<span class="token punctuation">.</span>x<span class="token punctuation">,</span> params<span class="token punctuation">.</span>y<span class="token punctuation">,</span> params<span class="token punctuation">.</span>z<span class="token punctuation">,</span> params<span class="token punctuation">.</span>eventobjid<span class="token punctuation">;</span>
    <span class="token keyword">local</span> ret<span class="token punctuation">,</span> data <span class="token operator">=</span> Block<span class="token punctuation">:</span><span class="token function">getBlockData</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">#</span>areas <span class="token keyword">do</span>
        <span class="token keyword">local</span> area <span class="token operator">=</span> areas<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        <span class="token keyword">local</span> resetP <span class="token operator">=</span> LEVEL_CONFIG<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>RESET<span class="token punctuation">.</span>POS
        <span class="token keyword">if</span> data <span class="token operator">&gt;=</span> <span class="token number">8</span> <span class="token keyword">and</span> x <span class="token operator">==</span> resetP<span class="token punctuation">.</span>x <span class="token keyword">and</span> y <span class="token operator">==</span> resetP<span class="token punctuation">.</span>y <span class="token keyword">and</span> z <span class="token operator">==</span> resetP<span class="token punctuation">.</span>z <span class="token keyword">then</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> area<span class="token punctuation">.</span>isResetting <span class="token keyword">then</span>
                <span class="token function">startReset</span><span class="token punctuation">(</span>area<span class="token punctuation">)</span>
            <span class="token keyword">end</span>
            <span class="token keyword">break</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>
    Player<span class="token punctuation">:</span><span class="token function">notifyGameInfo2Self</span><span class="token punctuation">(</span>eventobjid<span class="token punctuation">,</span> <span class="token string">&quot;Successfully restored &quot;</span><span class="token punctuation">)</span>
<span class="token keyword">end</span>

minesweeper_player_pickupitem <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>
    <span class="token keyword">local</span> itemid<span class="token punctuation">,</span> itemnum<span class="token punctuation">,</span> toobjid<span class="token punctuation">,</span> eventobjid <span class="token operator">=</span> params<span class="token punctuation">.</span>itemid<span class="token punctuation">,</span> params<span class="token punctuation">.</span>itemnum<span class="token punctuation">,</span> params<span class="token punctuation">.</span>toobjid<span class="token punctuation">,</span> params<span class="token punctuation">.</span>eventobjid
    <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token function">isInclude</span><span class="token punctuation">(</span>itemid<span class="token punctuation">,</span> ALLOWED_ITEMS<span class="token punctuation">)</span> <span class="token keyword">then</span>
        Backpack<span class="token punctuation">:</span><span class="token function">removeGridItemByItemID</span><span class="token punctuation">(</span>eventobjid<span class="token punctuation">,</span> itemid<span class="token punctuation">)</span>
    <span class="token keyword">else</span>

    <span class="token keyword">end</span>
<span class="token keyword">end</span>

minesweeper_player_selectshortcut <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>
    <span class="token keyword">local</span> itemid<span class="token punctuation">,</span> itemnum<span class="token punctuation">,</span> eventobjid <span class="token operator">=</span> params<span class="token punctuation">.</span>itemid<span class="token punctuation">,</span> params<span class="token punctuation">.</span>itemnum<span class="token punctuation">,</span> params<span class="token punctuation">.</span>eventobjid
    <span class="token keyword">for</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">#</span>TOOLS_STRING <span class="token keyword">do</span>
        <span class="token keyword">if</span> TOOLS_STRING<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>id <span class="token operator">==</span> itemid <span class="token keyword">then</span>
            Player<span class="token punctuation">:</span><span class="token function">notifyGameInfo2Self</span><span class="token punctuation">(</span>eventobjid<span class="token punctuation">,</span> TOOLS_STRING<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>string<span class="token punctuation">)</span>
            <span class="token keyword">break</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>
<span class="token keyword">end</span>

<span class="token function">listenevents_minesweeper</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Lua/tankx.html" class="prev">
        坦克对战
      </a></span> <span class="next"><a href="/Lua/Gomoku.html">
        五子棋（Gomoku）
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.ef735673.js" defer></script><script src="/assets/js/2.b51029ec.js" defer></script><script src="/assets/js/40.a6c3be0f.js" defer></script>
  </body>
</html>
