<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>迷你快餐店（Mini Fast Food Restaurant） | 潇淼文档</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/favicon.ico">
    <script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?bcbe8dcd550616b188183a023ba3e682";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
    <meta name="description" content="MiniDoc">
    <meta name="robots" content="all">
    <meta name="author" content="msk11@qq.com">
    <meta name="copyright" content="Hcat">
    <meta name="revisit-after" content="7 days">
    <meta name="keywords" content="潇淼文档,潇淼,迷你世界,文档,迷你,mini,doc,世界,MiniWorld,脚本,教程">
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <link rel="preload" href="/assets/css/0.styles.84203ac8.css" as="style"><link rel="preload" href="/assets/js/app.ef735673.js" as="script"><link rel="preload" href="/assets/js/2.b51029ec.js" as="script"><link rel="preload" href="/assets/js/38.c16df410.js" as="script"><link rel="prefetch" href="/assets/js/10.08f53c0a.js"><link rel="prefetch" href="/assets/js/11.852fe533.js"><link rel="prefetch" href="/assets/js/12.387441d1.js"><link rel="prefetch" href="/assets/js/13.026b2d2d.js"><link rel="prefetch" href="/assets/js/14.234e0442.js"><link rel="prefetch" href="/assets/js/15.05982601.js"><link rel="prefetch" href="/assets/js/16.6ddb7b54.js"><link rel="prefetch" href="/assets/js/17.c8e27348.js"><link rel="prefetch" href="/assets/js/18.bea8b7b8.js"><link rel="prefetch" href="/assets/js/19.8032166c.js"><link rel="prefetch" href="/assets/js/20.e8575946.js"><link rel="prefetch" href="/assets/js/21.78fb8e90.js"><link rel="prefetch" href="/assets/js/22.1d33cf5f.js"><link rel="prefetch" href="/assets/js/23.7b04bc71.js"><link rel="prefetch" href="/assets/js/24.e2b60efb.js"><link rel="prefetch" href="/assets/js/25.5d5a4485.js"><link rel="prefetch" href="/assets/js/26.8173389b.js"><link rel="prefetch" href="/assets/js/27.b71f4454.js"><link rel="prefetch" href="/assets/js/28.e1ca4b97.js"><link rel="prefetch" href="/assets/js/29.929be50a.js"><link rel="prefetch" href="/assets/js/3.df829fda.js"><link rel="prefetch" href="/assets/js/30.7e96e268.js"><link rel="prefetch" href="/assets/js/31.c0e69237.js"><link rel="prefetch" href="/assets/js/32.7a31538c.js"><link rel="prefetch" href="/assets/js/33.9f9fcbee.js"><link rel="prefetch" href="/assets/js/34.1a23bcc8.js"><link rel="prefetch" href="/assets/js/35.d646c169.js"><link rel="prefetch" href="/assets/js/36.23fde348.js"><link rel="prefetch" href="/assets/js/37.72568f5d.js"><link rel="prefetch" href="/assets/js/39.beaf8a5b.js"><link rel="prefetch" href="/assets/js/4.af196e2c.js"><link rel="prefetch" href="/assets/js/40.a6c3be0f.js"><link rel="prefetch" href="/assets/js/41.55dcf4c0.js"><link rel="prefetch" href="/assets/js/42.194c1906.js"><link rel="prefetch" href="/assets/js/43.23218e8b.js"><link rel="prefetch" href="/assets/js/44.d7674f0c.js"><link rel="prefetch" href="/assets/js/45.98b149c7.js"><link rel="prefetch" href="/assets/js/46.b5d5ec9d.js"><link rel="prefetch" href="/assets/js/47.b3a38716.js"><link rel="prefetch" href="/assets/js/48.ea0a7e3f.js"><link rel="prefetch" href="/assets/js/5.18feaa6c.js"><link rel="prefetch" href="/assets/js/6.7e6925c7.js"><link rel="prefetch" href="/assets/js/7.1b7a5d04.js"><link rel="prefetch" href="/assets/js/8.f363ac78.js"><link rel="prefetch" href="/assets/js/9.61f6ba62.js">
    <link rel="stylesheet" href="/assets/css/0.styles.84203ac8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">潇淼文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/Hcat.html" class="nav-link">
  联系我们
</a></div><div class="nav-item"><a href="/about.html" class="nav-link">
  关于
</a></div><div class="nav-item"><a href="http://xor.hcat.work/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  XOR加密
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/Hcat.html" class="nav-link">
  联系我们
</a></div><div class="nav-item"><a href="/about.html" class="nav-link">
  关于
</a></div><div class="nav-item"><a href="http://xor.hcat.work/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  XOR加密
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/" aria-current="page" class="sidebar-link">首页</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>基本要素</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Lua脚本</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Lua/2048.html" class="sidebar-link">Game 2048</a></li><li><a href="/Lua/void.html" class="sidebar-link">不那么仁慈的虚空</a></li><li><a href="/Lua/zfdm.html" class="sidebar-link">争分夺秒</a></li><li><a href="/Lua/tankx.html" class="sidebar-link">坦克对战</a></li><li><a href="/Lua/Stone_code.html" class="sidebar-link">Stone Code</a></li><li><a href="/Lua/Gomoku.html" class="sidebar-link">五子棋（Gomoku）</a></li><li><a href="/Lua/fight_for_gold_bricks.html" class="sidebar-link">夺金之战（Fight for Gold Bricks）</a></li><li><a href="/Lua/example.html" class="sidebar-link">示例整合Examples collection</a></li><li><a href="/Lua/Mini_Fast_Food_Restaurant.html" aria-current="page" class="active sidebar-link">迷你快餐店（Mini Fast Food Restaurant）</a></li><li><a href="/Lua/color_fight.html" class="sidebar-link">好色之途（Color Fight）</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>拓展元素</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>商业化[圈钱]</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>游戏全局数据表</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="迷你快餐店-mini-fast-food-restaurant"><a href="#迷你快餐店-mini-fast-food-restaurant" class="header-anchor">#</a> 迷你快餐店（Mini Fast Food Restaurant）</h1> <div class="language-lua extra-class"><pre class="language-lua"><code><span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span>


	<span class="token keyword">local</span> IDs <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token comment">--Ingame items and blocks</span>
		sceneBlk1Id <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">,</span>  <span class="token comment">--Scene block</span>
		sceneBlk2Id <span class="token operator">=</span> <span class="token number">667</span><span class="token punctuation">,</span>  <span class="token comment">--Scene block</span>
		storeBoxIdx <span class="token operator">=</span> <span class="token number">2001</span><span class="token punctuation">,</span> <span class="token comment">--Box block</span>
	
		contTableId <span class="token operator">=</span> <span class="token number">1123</span><span class="token punctuation">,</span> <span class="token comment">--Dirty tray tableID</span>
		washTableId <span class="token operator">=</span> <span class="token number">219</span><span class="token punctuation">,</span>  <span class="token comment">--Wash TableID</span>
		waterTapxId <span class="token operator">=</span> <span class="token number">258</span><span class="token punctuation">,</span>  <span class="token comment">--Water tapID</span>
		funnelBlkId <span class="token operator">=</span> <span class="token number">1105</span><span class="token punctuation">,</span> <span class="token comment">--Deliver blockID</span>
		arrowheadId <span class="token operator">=</span> <span class="token number">3941</span><span class="token punctuation">,</span> <span class="token comment">--Deliver arrowsID</span>
	
		cookinBlkId <span class="token operator">=</span> <span class="token number">2018</span><span class="token punctuation">,</span> <span class="token comment">--Cooking blockID</span>
		cutBoardxId <span class="token operator">=</span> <span class="token number">218</span><span class="token punctuation">,</span>  <span class="token comment">--Cutting board blockID</span>
		checkBlkIdx <span class="token operator">=</span> <span class="token number">3950</span><span class="token punctuation">,</span> <span class="token comment">--Check blockID</span>
		musicBlkIdx <span class="token operator">=</span> <span class="token number">415</span><span class="token punctuation">,</span>  <span class="token comment">--MusicblockID</span>
	
		emptyDishId <span class="token operator">=</span> <span class="token number">3997</span><span class="token punctuation">,</span> <span class="token comment">--Empty dish blockID</span>
		dirtyDishId <span class="token operator">=</span> <span class="token number">3999</span><span class="token punctuation">,</span> <span class="token comment">--Dirty dishblockID</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">-- Hand held food item</span>
	<span class="token keyword">local</span> FoodIDs <span class="token operator">=</span> <span class="token punctuation">{</span>
		<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">12502</span><span class="token punctuation">,</span> <span class="token comment">--Toest</span>
		<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">12519</span><span class="token punctuation">,</span> <span class="token comment">--Roasted Chicken Leg</span>
		<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">12512</span><span class="token punctuation">,</span> <span class="token comment">--Roasted Potato</span>
		<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">12517</span><span class="token punctuation">,</span> <span class="token comment">--Roasted Beef</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">-- Conversion between Deliver blocks</span>
	<span class="token keyword">local</span> FinalIDs <span class="token operator">=</span> <span class="token punctuation">{</span>
		<span class="token punctuation">[</span>FoodIDs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">--Hand held toast</span>
			<span class="token punctuation">[</span><span class="token number">3997</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">4000</span><span class="token punctuation">,</span> <span class="token comment">--10-&gt;block1</span>
			<span class="token punctuation">[</span><span class="token number">4000</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3991</span><span class="token punctuation">,</span> <span class="token comment">--11-&gt;block11</span>
			<span class="token punctuation">[</span><span class="token number">3982</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3972</span><span class="token punctuation">,</span> <span class="token comment">--12-&gt;block12</span>
			<span class="token punctuation">[</span><span class="token number">3980</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3973</span><span class="token punctuation">,</span> <span class="token comment">--13-&gt;block13</span>
			<span class="token punctuation">[</span><span class="token number">3976</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3971</span><span class="token punctuation">,</span> <span class="token comment">--14-&gt;block14</span>
	
			<span class="token punctuation">[</span><span class="token number">3991</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3985</span><span class="token punctuation">,</span> <span class="token comment">--111-&gt;111</span>
			<span class="token punctuation">[</span><span class="token number">3972</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3964</span><span class="token punctuation">,</span> <span class="token comment">--112-&gt;112</span>
			<span class="token punctuation">[</span><span class="token number">3973</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3961</span><span class="token punctuation">,</span> <span class="token comment">--113-&gt;113</span>
			<span class="token punctuation">[</span><span class="token number">3971</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3960</span><span class="token punctuation">,</span> <span class="token comment">--114-&gt;114</span>
	
			<span class="token punctuation">[</span><span class="token number">3981</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3965</span><span class="token punctuation">,</span> <span class="token comment">--122-&gt;122</span>
			<span class="token punctuation">[</span><span class="token number">3970</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3967</span><span class="token punctuation">,</span> <span class="token comment">--123-&gt;123</span>
			<span class="token punctuation">[</span><span class="token number">3968</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3966</span><span class="token punctuation">,</span> <span class="token comment">--124-&gt;124</span>
			<span class="token punctuation">[</span><span class="token number">3979</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3963</span><span class="token punctuation">,</span> <span class="token comment">--133-&gt;133</span>
			<span class="token punctuation">[</span><span class="token number">3969</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3962</span><span class="token punctuation">,</span> <span class="token comment">--134-&gt;134</span>
			<span class="token punctuation">[</span><span class="token number">3975</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3959</span><span class="token punctuation">,</span> <span class="token comment">--144-&gt;144</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">[</span>FoodIDs<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">--Hand held Roasted Chicken Leg</span>
			<span class="token punctuation">[</span><span class="token number">3997</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3982</span><span class="token punctuation">,</span> <span class="token comment">--20-&gt;block2</span>
			<span class="token punctuation">[</span><span class="token number">4000</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3972</span><span class="token punctuation">,</span> <span class="token comment">--21-&gt;block12</span>
			<span class="token punctuation">[</span><span class="token number">3982</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3981</span><span class="token punctuation">,</span> <span class="token comment">--22-&gt;block22</span>
			<span class="token punctuation">[</span><span class="token number">3980</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3970</span><span class="token punctuation">,</span> <span class="token comment">--23-&gt;block23</span>
			<span class="token punctuation">[</span><span class="token number">3976</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3968</span><span class="token punctuation">,</span> <span class="token comment">--24-&gt;block24</span>
	
			<span class="token punctuation">[</span><span class="token number">3991</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3964</span><span class="token punctuation">,</span> <span class="token comment">--211-&gt;112</span>
			<span class="token punctuation">[</span><span class="token number">3972</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3965</span><span class="token punctuation">,</span> <span class="token comment">--212-&gt;122</span>
			<span class="token punctuation">[</span><span class="token number">3973</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3967</span><span class="token punctuation">,</span> <span class="token comment">--213-&gt;123</span>
			<span class="token punctuation">[</span><span class="token number">3971</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3966</span><span class="token punctuation">,</span> <span class="token comment">--214-&gt;124</span>
	
			<span class="token punctuation">[</span><span class="token number">3981</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3977</span><span class="token punctuation">,</span> <span class="token comment">--222-&gt;222</span>
			<span class="token punctuation">[</span><span class="token number">3970</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3958</span><span class="token punctuation">,</span> <span class="token comment">--223-&gt;223</span>
			<span class="token punctuation">[</span><span class="token number">3968</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3956</span><span class="token punctuation">,</span> <span class="token comment">--224-&gt;224</span>
			<span class="token punctuation">[</span><span class="token number">3979</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3955</span><span class="token punctuation">,</span> <span class="token comment">--233-&gt;233</span>
			<span class="token punctuation">[</span><span class="token number">3969</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3957</span><span class="token punctuation">,</span> <span class="token comment">--234-&gt;234</span>
			<span class="token punctuation">[</span><span class="token number">3975</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3954</span><span class="token punctuation">,</span> <span class="token comment">--244-&gt;244</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">[</span>FoodIDs<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">--Hand held Roasted Potato</span>
			<span class="token punctuation">[</span><span class="token number">3997</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3980</span><span class="token punctuation">,</span> <span class="token comment">--30-&gt;block3</span>
			<span class="token punctuation">[</span><span class="token number">4000</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3973</span><span class="token punctuation">,</span> <span class="token comment">--31-&gt;block13</span>
			<span class="token punctuation">[</span><span class="token number">3982</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3970</span><span class="token punctuation">,</span> <span class="token comment">--32-&gt;block23</span>
			<span class="token punctuation">[</span><span class="token number">3980</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3979</span><span class="token punctuation">,</span> <span class="token comment">--33-&gt;block33</span>
			<span class="token punctuation">[</span><span class="token number">3976</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3969</span><span class="token punctuation">,</span> <span class="token comment">--34-&gt;block34</span>
	
			<span class="token punctuation">[</span><span class="token number">3991</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3961</span><span class="token punctuation">,</span> <span class="token comment">--311-&gt;113</span>
			<span class="token punctuation">[</span><span class="token number">3972</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3967</span><span class="token punctuation">,</span> <span class="token comment">--312-&gt;123</span>
			<span class="token punctuation">[</span><span class="token number">3973</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3963</span><span class="token punctuation">,</span> <span class="token comment">--313-&gt;133</span>
			<span class="token punctuation">[</span><span class="token number">3971</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3962</span><span class="token punctuation">,</span> <span class="token comment">--314-&gt;134</span>
	
			<span class="token punctuation">[</span><span class="token number">3981</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3958</span><span class="token punctuation">,</span> <span class="token comment">--322-&gt;223</span>
			<span class="token punctuation">[</span><span class="token number">3970</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3955</span><span class="token punctuation">,</span> <span class="token comment">--323-&gt;233</span>
			<span class="token punctuation">[</span><span class="token number">3968</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3957</span><span class="token punctuation">,</span> <span class="token comment">--324-&gt;234</span>
			<span class="token punctuation">[</span><span class="token number">3979</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3978</span><span class="token punctuation">,</span> <span class="token comment">--333-&gt;333</span>
			<span class="token punctuation">[</span><span class="token number">3969</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3952</span><span class="token punctuation">,</span> <span class="token comment">--334-&gt;334</span>
			<span class="token punctuation">[</span><span class="token number">3975</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3953</span><span class="token punctuation">,</span> <span class="token comment">--344-&gt;344</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">[</span>FoodIDs<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">--Hand held Roasted Beef</span>
			<span class="token punctuation">[</span><span class="token number">3997</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3976</span><span class="token punctuation">,</span> <span class="token comment">--40-&gt;block4</span>
			<span class="token punctuation">[</span><span class="token number">4000</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3971</span><span class="token punctuation">,</span> <span class="token comment">--41-&gt;block14</span>
			<span class="token punctuation">[</span><span class="token number">3982</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3968</span><span class="token punctuation">,</span> <span class="token comment">--42-&gt;block24</span>
			<span class="token punctuation">[</span><span class="token number">3980</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3969</span><span class="token punctuation">,</span> <span class="token comment">--43-&gt;block34</span>
			<span class="token punctuation">[</span><span class="token number">3976</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3975</span><span class="token punctuation">,</span> <span class="token comment">--44-&gt;block44</span>
	
			<span class="token punctuation">[</span><span class="token number">3991</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3960</span><span class="token punctuation">,</span> <span class="token comment">--411-&gt;114</span>
			<span class="token punctuation">[</span><span class="token number">3972</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3966</span><span class="token punctuation">,</span> <span class="token comment">--412-&gt;124</span>
			<span class="token punctuation">[</span><span class="token number">3973</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3962</span><span class="token punctuation">,</span> <span class="token comment">--413-&gt;134</span>
			<span class="token punctuation">[</span><span class="token number">3971</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3959</span><span class="token punctuation">,</span> <span class="token comment">--414-&gt;144</span>
	
			<span class="token punctuation">[</span><span class="token number">3981</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3956</span><span class="token punctuation">,</span> <span class="token comment">--422-&gt;224</span>
			<span class="token punctuation">[</span><span class="token number">3970</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3957</span><span class="token punctuation">,</span> <span class="token comment">--423-&gt;234</span>
			<span class="token punctuation">[</span><span class="token number">3968</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3954</span><span class="token punctuation">,</span> <span class="token comment">--424-&gt;244</span>
			<span class="token punctuation">[</span><span class="token number">3979</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3952</span><span class="token punctuation">,</span> <span class="token comment">--433-&gt;334</span>
			<span class="token punctuation">[</span><span class="token number">3969</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3953</span><span class="token punctuation">,</span> <span class="token comment">--434-&gt;344</span>
			<span class="token punctuation">[</span><span class="token number">3975</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3974</span><span class="token punctuation">,</span> <span class="token comment">--444-&gt;444</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">--Clock ID:Right/Left half</span>
	<span class="token keyword">local</span> ClockNumIDs <span class="token operator">=</span> <span class="token punctuation">{</span>
		<span class="token comment">-- right --</span>
		<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3909</span><span class="token punctuation">,</span>
		<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3923</span><span class="token punctuation">,</span>
		<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3925</span><span class="token punctuation">,</span>
		<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3920</span><span class="token punctuation">,</span>
		<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3918</span><span class="token punctuation">,</span>
		<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3916</span><span class="token punctuation">,</span>
		<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3915</span><span class="token punctuation">,</span>
		<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3913</span><span class="token punctuation">,</span>
		<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3929</span><span class="token punctuation">,</span>
		<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3911</span><span class="token punctuation">,</span>
	
		<span class="token comment">-- lelf --</span>
		<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3908</span><span class="token punctuation">,</span>
		<span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3922</span><span class="token punctuation">,</span>
		<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3924</span><span class="token punctuation">,</span>
		<span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3921</span><span class="token punctuation">,</span>
		<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3919</span><span class="token punctuation">,</span>
		<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3917</span><span class="token punctuation">,</span>
		<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3914</span><span class="token punctuation">,</span>
		<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3912</span><span class="token punctuation">,</span>
		<span class="token punctuation">[</span><span class="token number">18</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3943</span><span class="token punctuation">,</span>
		<span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3910</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">local</span> GameSData <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token comment">--Level content</span>
		<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">--Level 1</span>
			score <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token comment">--Score</span>
			dtime <span class="token operator">=</span> <span class="token number">3</span><span class="token operator">*</span><span class="token number">60</span><span class="token punctuation">,</span> <span class="token comment">--Time</span>
			pos <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">--Spawn Point</span>
				<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>x<span class="token operator">=</span><span class="token number">21.5</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> z<span class="token operator">=</span><span class="token number">14.5</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>x<span class="token operator">=</span><span class="token number">22.5</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> z<span class="token operator">=</span><span class="token number">14.5</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>x<span class="token operator">=</span><span class="token number">23.5</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> z<span class="token operator">=</span><span class="token number">14.5</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			fpos <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">--funnel Level delivery point</span>
				<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>x<span class="token operator">=</span><span class="token number">22</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> z<span class="token operator">=</span><span class="token number">26</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>x<span class="token operator">=</span><span class="token number">23</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> z<span class="token operator">=</span><span class="token number">26</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			dpos <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">--Dirty position</span>
				<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>x<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> z<span class="token operator">=</span><span class="token number">26</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>x<span class="token operator">=</span><span class="token number">19</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> z<span class="token operator">=</span><span class="token number">26</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			mpos <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">--Welcome music POS</span>
				<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>x<span class="token operator">=</span><span class="token number">23</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">,</span> z<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>x<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">,</span> z<span class="token operator">=</span><span class="token number">21</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			tools <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">--Item conversion type</span>
				<span class="token punctuation">[</span>IDs<span class="token punctuation">.</span>cutBoardxId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token comment">--cut board</span>
					<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token number">241</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">12512</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">[</span>IDs<span class="token punctuation">.</span>washTableId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token comment">--wash table</span>
					<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token number">3999</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3997</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">[</span>IDs<span class="token punctuation">.</span>waterTapxId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token comment">--water tap</span>
					<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token number">3999</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3997</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			goals <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">3973</span><span class="token punctuation">,</span> <span class="token number">3979</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">--Score block</span>
			target <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token number">3907</span><span class="token punctuation">,</span> <span class="token number">3884</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">3884</span><span class="token punctuation">,</span> <span class="token number">3884</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
			clocks <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">--Clock information</span>
				<span class="token punctuation">{</span>x<span class="token operator">=</span><span class="token number">21</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> z<span class="token operator">=</span><span class="token number">27</span><span class="token punctuation">,</span> time<span class="token operator">=</span><span class="token number">45</span><span class="token punctuation">,</span> stop<span class="token operator">=</span><span class="token keyword">false</span><span class="token punctuation">,</span> fdir<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">{</span>x<span class="token operator">=</span><span class="token number">24</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> z<span class="token operator">=</span><span class="token number">19</span><span class="token punctuation">,</span> time<span class="token operator">=</span><span class="token number">45</span><span class="token punctuation">,</span> stop<span class="token operator">=</span><span class="token keyword">false</span><span class="token punctuation">,</span> fdir<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">{</span>x<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> z<span class="token operator">=</span><span class="token number">13</span><span class="token punctuation">,</span> time<span class="token operator">=</span><span class="token number">45</span><span class="token punctuation">,</span> stop<span class="token operator">=</span><span class="token keyword">false</span><span class="token punctuation">,</span> fdir<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">{</span>x<span class="token operator">=</span><span class="token number">17</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> z<span class="token operator">=</span><span class="token number">21</span><span class="token punctuation">,</span> time<span class="token operator">=</span><span class="token number">45</span><span class="token punctuation">,</span> stop<span class="token operator">=</span><span class="token keyword">false</span><span class="token punctuation">,</span> fdir<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">--Level 2</span>
			score <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token comment">--Level Score</span>
			dtime <span class="token operator">=</span> <span class="token number">4</span><span class="token operator">*</span><span class="token number">60</span><span class="token punctuation">,</span> <span class="token comment">--Level Time</span>
			pos <span class="token operator">=</span> <span class="token punctuation">{</span>
				<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>x<span class="token operator">=</span><span class="token number">20.5</span><span class="token operator">-</span><span class="token number">27</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> z<span class="token operator">=</span><span class="token number">26.5</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>x<span class="token operator">=</span><span class="token number">21.5</span><span class="token operator">-</span><span class="token number">27</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> z<span class="token operator">=</span><span class="token number">26.5</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>x<span class="token operator">=</span><span class="token number">22.5</span><span class="token operator">-</span><span class="token number">27</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> z<span class="token operator">=</span><span class="token number">26.5</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			fpos <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">--funnel Level delivery point</span>
				<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>x<span class="token operator">=</span><span class="token operator">-</span><span class="token number">9</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> z<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>x<span class="token operator">=</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> z<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			dpos <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">--Dirty position</span>
				<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>x<span class="token operator">=</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> z<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>x<span class="token operator">=</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> z<span class="token operator">=</span><span class="token number">17</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			mpos <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">--Welcome music POS</span>
				<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>x<span class="token operator">=</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">,</span> z<span class="token operator">=</span><span class="token number">25</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>x<span class="token operator">=</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">,</span> z<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			tools <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">--Food/Item conversion type</span>
				<span class="token punctuation">[</span>IDs<span class="token punctuation">.</span>cookinBlkId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token comment">--cooking block</span>
					<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token number">12516</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">12517</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
					<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token number">12518</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">12519</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">[</span>IDs<span class="token punctuation">.</span>washTableId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token comment">--wash the dishes</span>
					<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token number">3999</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3997</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">[</span>IDs<span class="token punctuation">.</span>waterTapxId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token comment">--wash the dishes</span>
					<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token number">3999</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3997</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			goals <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">3972</span><span class="token punctuation">,</span> <span class="token number">3971</span><span class="token punctuation">,</span> <span class="token number">3968</span><span class="token punctuation">,</span> <span class="token number">3981</span><span class="token punctuation">,</span> <span class="token number">3975</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">--Scoreblock</span>
			target <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token number">3907</span><span class="token punctuation">,</span> <span class="token number">3926</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">3907</span><span class="token punctuation">,</span> <span class="token number">3880</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">3926</span><span class="token punctuation">,</span> <span class="token number">3880</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">3926</span><span class="token punctuation">,</span> <span class="token number">3926</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">3880</span><span class="token punctuation">,</span> <span class="token number">3880</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
			clocks <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">--Clock information</span>
				<span class="token punctuation">{</span>x<span class="token operator">=</span><span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> z<span class="token operator">=</span><span class="token number">27</span><span class="token punctuation">,</span> time<span class="token operator">=</span><span class="token number">60</span><span class="token punctuation">,</span> stop<span class="token operator">=</span><span class="token keyword">false</span><span class="token punctuation">,</span> fdir<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">{</span>x<span class="token operator">=</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> z<span class="token operator">=</span><span class="token number">19</span><span class="token punctuation">,</span> time<span class="token operator">=</span><span class="token number">60</span><span class="token punctuation">,</span> stop<span class="token operator">=</span><span class="token keyword">false</span><span class="token punctuation">,</span> fdir<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">{</span>x<span class="token operator">=</span><span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> z<span class="token operator">=</span><span class="token number">13</span><span class="token punctuation">,</span> time<span class="token operator">=</span><span class="token number">60</span><span class="token punctuation">,</span> stop<span class="token operator">=</span><span class="token keyword">false</span><span class="token punctuation">,</span> fdir<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">{</span>x<span class="token operator">=</span><span class="token operator">-</span><span class="token number">11</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> z<span class="token operator">=</span><span class="token number">21</span><span class="token punctuation">,</span> time<span class="token operator">=</span><span class="token number">60</span><span class="token punctuation">,</span> stop<span class="token operator">=</span><span class="token keyword">false</span><span class="token punctuation">,</span> fdir<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">--Level 3</span>
			score <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token comment">--Level Score</span>
			dtime <span class="token operator">=</span> <span class="token number">5</span><span class="token operator">*</span><span class="token number">60</span><span class="token punctuation">,</span><span class="token comment">--Level Time</span>
			pos <span class="token operator">=</span> <span class="token punctuation">{</span>
				<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>x<span class="token operator">=</span><span class="token number">20.5</span><span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> z<span class="token operator">=</span><span class="token number">16.5</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>x<span class="token operator">=</span><span class="token number">21.5</span><span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> z<span class="token operator">=</span><span class="token number">16.5</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>x<span class="token operator">=</span><span class="token number">22.5</span><span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> z<span class="token operator">=</span><span class="token number">16.5</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			fpos <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">--funnel Level delivery point</span>
				<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>x<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> z<span class="token operator">=</span><span class="token number">25</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>x<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> z<span class="token operator">=</span><span class="token number">25</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>x<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> z<span class="token operator">=</span><span class="token number">25</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			dpos <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">--Dirty position</span>
				<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>x<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> z<span class="token operator">=</span><span class="token number">24</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>x<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> z<span class="token operator">=</span><span class="token number">24</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			mpos <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">--Welcome music POS</span>
				<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>x<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">,</span> z<span class="token operator">=</span><span class="token number">24</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>x<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">,</span> z<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			tools <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">--Food/Item conversion type</span>
				<span class="token punctuation">[</span>IDs<span class="token punctuation">.</span>cutBoardxId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token comment">--cut board</span>
					<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token number">241</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">12512</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">[</span>IDs<span class="token punctuation">.</span>cookinBlkId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token comment">--cooking block</span>
					<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token number">12516</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">12517</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
					<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token number">12518</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">12519</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">[</span>IDs<span class="token punctuation">.</span>washTableId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token comment">--wash the dishes</span>
					<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token number">3999</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3997</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">[</span>IDs<span class="token punctuation">.</span>waterTapxId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token comment">--wash the dishes</span>
					<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token number">3999</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3997</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			goals <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">3967</span><span class="token punctuation">,</span> <span class="token number">3966</span><span class="token punctuation">,</span> <span class="token number">3962</span><span class="token punctuation">,</span> <span class="token number">3957</span><span class="token punctuation">,</span> <span class="token number">3955</span><span class="token punctuation">,</span> <span class="token number">3952</span><span class="token punctuation">,</span> <span class="token number">3958</span><span class="token punctuation">,</span> <span class="token number">3956</span><span class="token punctuation">,</span> <span class="token number">3953</span><span class="token punctuation">,</span> <span class="token number">3954</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">--Scoreblock</span>
			target <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token number">3907</span><span class="token punctuation">,</span> <span class="token number">3926</span><span class="token punctuation">,</span> <span class="token number">3884</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">3907</span><span class="token punctuation">,</span> <span class="token number">3926</span><span class="token punctuation">,</span> <span class="token number">3880</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">3907</span><span class="token punctuation">,</span> <span class="token number">3880</span><span class="token punctuation">,</span> <span class="token number">3884</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">3880</span><span class="token punctuation">,</span> <span class="token number">3926</span><span class="token punctuation">,</span> <span class="token number">3884</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
					  <span class="token punctuation">{</span><span class="token number">3926</span><span class="token punctuation">,</span> <span class="token number">3884</span><span class="token punctuation">,</span> <span class="token number">3884</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">3880</span><span class="token punctuation">,</span> <span class="token number">3884</span><span class="token punctuation">,</span> <span class="token number">3884</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">3884</span><span class="token punctuation">,</span> <span class="token number">3926</span><span class="token punctuation">,</span> <span class="token number">3926</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">3880</span><span class="token punctuation">,</span> <span class="token number">3926</span><span class="token punctuation">,</span> <span class="token number">3926</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
					  <span class="token punctuation">{</span><span class="token number">3884</span><span class="token punctuation">,</span> <span class="token number">3880</span><span class="token punctuation">,</span> <span class="token number">3880</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">3926</span><span class="token punctuation">,</span> <span class="token number">3880</span><span class="token punctuation">,</span> <span class="token number">3880</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
			clocks <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">--Clock information</span>
				<span class="token punctuation">{</span>x<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> z<span class="token operator">=</span><span class="token number">25</span><span class="token punctuation">,</span> time<span class="token operator">=</span><span class="token number">80</span><span class="token punctuation">,</span> stop<span class="token operator">=</span><span class="token keyword">false</span><span class="token punctuation">,</span> fdir<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">{</span>x<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> z<span class="token operator">=</span><span class="token number">25</span><span class="token punctuation">,</span> time<span class="token operator">=</span><span class="token number">80</span><span class="token punctuation">,</span> stop<span class="token operator">=</span><span class="token keyword">false</span><span class="token punctuation">,</span> fdir<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">{</span>x<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> z<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">,</span> time<span class="token operator">=</span><span class="token number">80</span><span class="token punctuation">,</span> stop<span class="token operator">=</span><span class="token keyword">false</span><span class="token punctuation">,</span> fdir<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">{</span>x<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> z<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">,</span> time<span class="token operator">=</span><span class="token number">80</span><span class="token punctuation">,</span> stop<span class="token operator">=</span><span class="token keyword">false</span><span class="token punctuation">,</span> fdir<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>

<span class="token comment">-- Game Tips</span>
<span class="token keyword">local</span> GameTips <span class="token operator">=</span> <span class="token punctuation">{</span>
	NewTips <span class="token operator">=</span> <span class="token string">'Customers are on the way..'</span><span class="token punctuation">,</span>
	NewStage <span class="token operator">=</span> <span class="token string">'#GSuccessfully, you will enter the new level!#n'</span><span class="token punctuation">,</span>
	CountTip <span class="token operator">=</span> <span class="token string">'Level %d#Y'</span><span class="token punctuation">,</span> <span class="token comment">-- Timer Tips</span>

	windStage <span class="token operator">=</span> <span class="token string">'#YMini Restaurant-Level %d#n'</span><span class="token punctuation">,</span>
	chatStage <span class="token operator">=</span> <span class="token string">'Successfully entered level %d:#R Get %d points in %d minutes to enter the next level!#nGo!'</span><span class="token punctuation">,</span>
	chatNewIn <span class="token operator">=</span> <span class="token string">'Tips: Get score by puting the food into the plate or the dish according to the guest.'</span><span class="token punctuation">,</span>

	windScore1 <span class="token operator">=</span> <span class="token string">'OK.#YGot 1 point#n'</span><span class="token punctuation">,</span>
	windScore2 <span class="token operator">=</span> <span class="token string">'Well done！#YGot 2 points#n'</span><span class="token punctuation">,</span>
	windScore0 <span class="token operator">=</span> <span class="token string">'Sorry, this does not match the guest request.'</span><span class="token punctuation">,</span>
	windComes <span class="token operator">=</span> <span class="token string">'Welcome &lt;%d&gt; to Mini Fast Food Restaurant'</span><span class="token punctuation">,</span>
	windLeave <span class="token operator">=</span> <span class="token string">'Guest &lt;%d&gt; left…'</span><span class="token punctuation">,</span>

	chatLast30 <span class="token operator">=</span> <span class="token string">'#RLast 30 seconds! #n to end the level.'</span><span class="token punctuation">,</span>
	chatLast10 <span class="token operator">=</span> <span class="token string">'#RLast 10 seconds! #n to end the level.'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">local</span> chatType <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">local</span> tickCount <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">local</span> newTicker <span class="token operator">=</span> <span class="token number">20</span>
<span class="token keyword">local</span> IsGameEnded <span class="token operator">=</span> <span class="token keyword">false</span> <span class="token comment">--Game over</span>
<span class="token keyword">local</span> IsGRuleInit <span class="token operator">=</span> <span class="token keyword">false</span> <span class="token comment">--Set rules</span>
<span class="token keyword">local</span> BattleResult <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">--Game result Tag</span>
<span class="token keyword">local</span> runTime <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">local</span> teamIdx <span class="token operator">=</span> <span class="token number">1</span><span class="token comment">--Set team ID</span>
<span class="token keyword">local</span> customers <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">--Number of Guest</span>
<span class="token keyword">local</span> DishBlks <span class="token operator">=</span> <span class="token punctuation">{</span>IDs<span class="token punctuation">.</span>dirtyDishId<span class="token punctuation">}</span>

<span class="token keyword">local</span> miniTimer1 <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token comment">--Level timer</span>
<span class="token keyword">local</span> miniTimer2 <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token comment">--Reset timing</span>

<span class="token comment">--Store level data</span>
<span class="token keyword">local</span> CurrStage <span class="token operator">=</span> <span class="token punctuation">{</span>
	stage <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">--Default 1st level</span>
	score <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">--score</span>
	clocks <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">--Demand module</span>
	seqids <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">--delayFuncID</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">EasyCopy</span><span class="token punctuation">(</span>dtab<span class="token punctuation">)</span>
	<span class="token keyword">local</span> newtab <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
	<span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> <span class="token function">pairs</span><span class="token punctuation">(</span>dtab<span class="token punctuation">)</span> <span class="token keyword">do</span> newtab<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token operator">=</span>v <span class="token keyword">end</span>
	<span class="token keyword">return</span> newtab
<span class="token keyword">end</span>

<span class="token comment">-- Clock = {x, y, z, time=30, fdir=1, stop=false, target={t1,t2,t3}}</span>
<span class="token keyword">function</span> <span class="token function">GetRandomClock</span><span class="token punctuation">(</span>stage<span class="token punctuation">)</span>
	stage <span class="token operator">=</span> stage <span class="token keyword">or</span> CurrStage<span class="token punctuation">.</span>stage
	sdata <span class="token operator">=</span> GameSData<span class="token punctuation">[</span>stage<span class="token punctuation">]</span>
	
	<span class="token keyword">if</span> sdata <span class="token operator">~=</span> <span class="token keyword">nil</span> <span class="token keyword">then</span>
		<span class="token keyword">local</span> randIdx <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">--random ID</span>
		<span class="token keyword">local</span> randClock <span class="token operator">=</span> <span class="token keyword">nil</span> <span class="token comment">-- New clock</span>
		
		<span class="token keyword">local</span> clocks <span class="token operator">=</span> GameSData<span class="token punctuation">[</span>stage<span class="token punctuation">]</span><span class="token punctuation">.</span>clocks
		randIdx <span class="token operator">=</span> math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">#</span>clocks<span class="token punctuation">)</span>
		randClock <span class="token operator">=</span> <span class="token function">EasyCopy</span><span class="token punctuation">(</span>clocks<span class="token punctuation">[</span>randIdx<span class="token punctuation">]</span><span class="token punctuation">)</span>

		<span class="token keyword">local</span> target <span class="token operator">=</span> GameSData<span class="token punctuation">[</span>stage<span class="token punctuation">]</span><span class="token punctuation">.</span>target
		randIdx <span class="token operator">=</span> math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">#</span>target<span class="token punctuation">)</span>
		randClock<span class="token punctuation">[</span><span class="token string">'target'</span><span class="token punctuation">]</span> <span class="token operator">=</span> target<span class="token punctuation">[</span>randIdx<span class="token punctuation">]</span>

		<span class="token keyword">local</span> goals <span class="token operator">=</span> GameSData<span class="token punctuation">[</span>stage<span class="token punctuation">]</span><span class="token punctuation">.</span>goals
		randClock<span class="token punctuation">[</span><span class="token string">'goal'</span><span class="token punctuation">]</span> <span class="token operator">=</span> goals<span class="token punctuation">[</span>randIdx<span class="token punctuation">]</span>
		<span class="token comment">-- Save data</span>
		CurrStage<span class="token punctuation">.</span>tgIdx <span class="token operator">=</span> randIdx
		<span class="token keyword">return</span> randClock
	<span class="token keyword">end</span>
<span class="token keyword">end</span>

<span class="token comment">-- Clock = {x, y, z, time=30, fdir=1, stop=false, target={t1,t2,t3}}</span>
<span class="token comment">-- Add or cut customer demand timer</span>
<span class="token keyword">function</span> <span class="token function">ClockCrtOrDel</span><span class="token punctuation">(</span>clock<span class="token punctuation">,</span> dodel<span class="token punctuation">)</span>
	<span class="token keyword">local</span> xPos<span class="token punctuation">,</span> yPos<span class="token punctuation">,</span> zPos <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span>
	
	<span class="token keyword">local</span> faceDir <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token comment">--Block orientation</span>
	<span class="token keyword">local</span> xdiv<span class="token punctuation">,</span>zdiv <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token comment">--X,Z Coordinate offset</span>
	<span class="token keyword">local</span> txdiv<span class="token punctuation">,</span>tzdiv <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token comment">--Position offset</span>
	<span class="token keyword">if</span> clock<span class="token punctuation">.</span>fdir<span class="token operator">==</span><span class="token number">1</span> <span class="token keyword">then</span> faceDir<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>xdiv<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>tzdiv<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token keyword">end</span> <span class="token comment">--Z axis reverse direction</span>
	<span class="token keyword">if</span> clock<span class="token punctuation">.</span>fdir<span class="token operator">==</span><span class="token number">2</span> <span class="token keyword">then</span> faceDir<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">;</span>zdiv<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>txdiv<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token keyword">end</span> <span class="token comment">--Y axis reverse direction</span>
	<span class="token keyword">if</span> clock<span class="token punctuation">.</span>fdir<span class="token operator">==</span><span class="token number">3</span> <span class="token keyword">then</span> faceDir<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span>xdiv<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>tzdiv<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token keyword">end</span> <span class="token comment">--Z-axis square</span>
	<span class="token keyword">if</span> clock<span class="token punctuation">.</span>fdir<span class="token operator">==</span><span class="token number">4</span> <span class="token keyword">then</span> faceDir<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span>zdiv<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>txdiv<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token keyword">end</span> <span class="token comment">--Y-axis square</span>

	<span class="token keyword">local</span> headId <span class="token operator">=</span> <span class="token number">3946</span> <span class="token comment">-- Set the head of guest</span>
	xPos<span class="token punctuation">,</span> yPos<span class="token punctuation">,</span> zPos <span class="token operator">=</span> clock<span class="token punctuation">.</span>x<span class="token punctuation">,</span> clock<span class="token punctuation">.</span>y<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> clock<span class="token punctuation">.</span>z
	<span class="token keyword">if</span> dodel <span class="token keyword">then</span> Block<span class="token punctuation">:</span><span class="token function">destroyBlock</span><span class="token punctuation">(</span>xPos<span class="token punctuation">,</span> yPos<span class="token punctuation">,</span> zPos<span class="token punctuation">)</span>
	<span class="token keyword">else</span> Block<span class="token punctuation">:</span><span class="token function">setBlockAll</span><span class="token punctuation">(</span>xPos<span class="token punctuation">,</span> yPos<span class="token punctuation">,</span> zPos<span class="token punctuation">,</span> headId<span class="token punctuation">,</span> faceDir<span class="token punctuation">)</span> <span class="token keyword">end</span>

	<span class="token keyword">local</span> flagId <span class="token operator">=</span> <span class="token number">3932</span> <span class="token comment">--Tips</span>
	<span class="token keyword">local</span> clockId <span class="token operator">=</span> <span class="token number">3947</span> <span class="token comment">-- Left half clock ID</span>
	<span class="token keyword">local</span> drinkId <span class="token operator">=</span> <span class="token number">3945</span> <span class="token comment">-- drink in the right side ID</span>
	<span class="token keyword">local</span> tsize <span class="token operator">=</span> <span class="token operator">#</span>clock<span class="token punctuation">.</span>target <span class="token comment">--Required quantity</span>
	<span class="token keyword">local</span> lPanId<span class="token punctuation">,</span>mPanId<span class="token punctuation">,</span>rPanId <span class="token operator">=</span> <span class="token number">3883</span><span class="token punctuation">,</span><span class="token number">3882</span><span class="token punctuation">,</span><span class="token number">3881</span> <span class="token comment">--L/R Whiteboard</span>

	<span class="token comment">-- add Tips</span>
	xPos<span class="token punctuation">,</span> yPos<span class="token punctuation">,</span> zPos <span class="token operator">=</span> clock<span class="token punctuation">.</span>x<span class="token operator">-</span>xdiv<span class="token punctuation">,</span> clock<span class="token punctuation">.</span>y<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> clock<span class="token punctuation">.</span>z<span class="token operator">-</span>zdiv
	<span class="token keyword">if</span> dodel <span class="token keyword">then</span> Block<span class="token punctuation">:</span><span class="token function">destroyBlock</span><span class="token punctuation">(</span>xPos<span class="token punctuation">,</span> yPos<span class="token punctuation">,</span> zPos<span class="token punctuation">)</span>
	<span class="token keyword">else</span> Block<span class="token punctuation">:</span><span class="token function">setBlockAll</span><span class="token punctuation">(</span>xPos<span class="token punctuation">,</span> yPos<span class="token punctuation">,</span> zPos<span class="token punctuation">,</span> flagId<span class="token punctuation">,</span> faceDir<span class="token punctuation">)</span> <span class="token keyword">end</span>

	<span class="token comment">-- add L/R Whiteboard or Required</span>
	xPos<span class="token punctuation">,</span> yPos<span class="token punctuation">,</span> zPos <span class="token operator">=</span> clock<span class="token punctuation">.</span>x<span class="token operator">-</span>xdiv<span class="token punctuation">,</span> clock<span class="token punctuation">.</span>y<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">,</span> clock<span class="token punctuation">.</span>z<span class="token operator">-</span>zdiv
	<span class="token keyword">if</span> dodel <span class="token keyword">then</span> Block<span class="token punctuation">:</span><span class="token function">destroyBlock</span><span class="token punctuation">(</span>xPos<span class="token punctuation">,</span> yPos<span class="token punctuation">,</span> zPos<span class="token punctuation">)</span> <span class="token comment">--WhiteboardL</span>
	<span class="token keyword">else</span> Block<span class="token punctuation">:</span><span class="token function">setBlockAll</span><span class="token punctuation">(</span>xPos<span class="token punctuation">,</span> yPos<span class="token punctuation">,</span> zPos<span class="token punctuation">,</span> lPanId<span class="token punctuation">,</span> faceDir<span class="token punctuation">)</span> <span class="token keyword">end</span>
	<span class="token keyword">if</span> dodel <span class="token keyword">then</span> Block<span class="token punctuation">:</span><span class="token function">destroyBlock</span><span class="token punctuation">(</span>xPos<span class="token operator">-</span>txdiv<span class="token punctuation">,</span> yPos<span class="token punctuation">,</span> zPos<span class="token operator">-</span>tzdiv<span class="token punctuation">)</span> <span class="token comment">--Required L</span>
	<span class="token keyword">else</span> Block<span class="token punctuation">:</span><span class="token function">setBlockAll</span><span class="token punctuation">(</span>xPos<span class="token operator">-</span>txdiv<span class="token punctuation">,</span> yPos<span class="token punctuation">,</span> zPos<span class="token operator">-</span>tzdiv<span class="token punctuation">,</span> clock<span class="token punctuation">.</span>target<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> faceDir<span class="token punctuation">)</span> <span class="token keyword">end</span>
	<span class="token keyword">if</span> tsize <span class="token operator">&lt;=</span> <span class="token number">2</span> <span class="token keyword">then</span>
		xPos<span class="token punctuation">,</span> yPos<span class="token punctuation">,</span> zPos <span class="token operator">=</span> clock<span class="token punctuation">.</span>x<span class="token punctuation">,</span> clock<span class="token punctuation">.</span>y<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">,</span> clock<span class="token punctuation">.</span>z
		<span class="token keyword">if</span> dodel <span class="token keyword">then</span> Block<span class="token punctuation">:</span><span class="token function">destroyBlock</span><span class="token punctuation">(</span>xPos<span class="token punctuation">,</span> yPos<span class="token punctuation">,</span> zPos<span class="token punctuation">)</span> <span class="token comment">--WhiteboardR</span>
		<span class="token keyword">else</span> Block<span class="token punctuation">:</span><span class="token function">setBlockAll</span><span class="token punctuation">(</span>xPos<span class="token punctuation">,</span> yPos<span class="token punctuation">,</span> zPos<span class="token punctuation">,</span> rPanId<span class="token punctuation">,</span> faceDir<span class="token punctuation">)</span> <span class="token keyword">end</span>
		<span class="token keyword">if</span> dodel <span class="token keyword">then</span> Block<span class="token punctuation">:</span><span class="token function">destroyBlock</span><span class="token punctuation">(</span>xPos<span class="token operator">-</span>txdiv<span class="token punctuation">,</span> yPos<span class="token punctuation">,</span> zPos<span class="token operator">-</span>tzdiv<span class="token punctuation">)</span> <span class="token comment">--Required M</span>
		<span class="token keyword">else</span> Block<span class="token punctuation">:</span><span class="token function">setBlockAll</span><span class="token punctuation">(</span>xPos<span class="token operator">-</span>txdiv<span class="token punctuation">,</span> yPos<span class="token punctuation">,</span> zPos<span class="token operator">-</span>tzdiv<span class="token punctuation">,</span> clock<span class="token punctuation">.</span>target<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> faceDir<span class="token punctuation">)</span> <span class="token keyword">end</span>
	<span class="token keyword">else</span> <span class="token comment">-- Required parts more than 2</span>
		xPos<span class="token punctuation">,</span> yPos<span class="token punctuation">,</span> zPos <span class="token operator">=</span> clock<span class="token punctuation">.</span>x<span class="token punctuation">,</span> clock<span class="token punctuation">.</span>y<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">,</span> clock<span class="token punctuation">.</span>z
		<span class="token keyword">if</span> dodel <span class="token keyword">then</span> Block<span class="token punctuation">:</span><span class="token function">destroyBlock</span><span class="token punctuation">(</span>xPos<span class="token punctuation">,</span> yPos<span class="token punctuation">,</span> zPos<span class="token punctuation">)</span> <span class="token comment">--WhiteboardM</span>
		<span class="token keyword">else</span> Block<span class="token punctuation">:</span><span class="token function">setBlockAll</span><span class="token punctuation">(</span>xPos<span class="token punctuation">,</span> yPos<span class="token punctuation">,</span> zPos<span class="token punctuation">,</span> mPanId<span class="token punctuation">,</span> faceDir<span class="token punctuation">)</span> <span class="token keyword">end</span>

		<span class="token keyword">if</span> dodel <span class="token keyword">then</span> Block<span class="token punctuation">:</span><span class="token function">destroyBlock</span><span class="token punctuation">(</span>xPos<span class="token operator">-</span>txdiv<span class="token punctuation">,</span> yPos<span class="token punctuation">,</span> zPos<span class="token operator">-</span>tzdiv<span class="token punctuation">)</span> <span class="token comment">--RequiredM</span>
		<span class="token keyword">else</span> Block<span class="token punctuation">:</span><span class="token function">setBlockAll</span><span class="token punctuation">(</span>xPos<span class="token operator">-</span>txdiv<span class="token punctuation">,</span> yPos<span class="token punctuation">,</span> zPos<span class="token operator">-</span>tzdiv<span class="token punctuation">,</span> clock<span class="token punctuation">.</span>target<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> faceDir<span class="token punctuation">)</span> <span class="token keyword">end</span>
		
		xPos<span class="token punctuation">,</span> yPos<span class="token punctuation">,</span> zPos <span class="token operator">=</span> clock<span class="token punctuation">.</span>x<span class="token operator">+</span>xdiv<span class="token punctuation">,</span> clock<span class="token punctuation">.</span>y<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">,</span> clock<span class="token punctuation">.</span>z<span class="token operator">+</span>zdiv
		<span class="token keyword">if</span> dodel <span class="token keyword">then</span> Block<span class="token punctuation">:</span><span class="token function">destroyBlock</span><span class="token punctuation">(</span>xPos<span class="token punctuation">,</span> yPos<span class="token punctuation">,</span> zPos<span class="token punctuation">)</span> <span class="token comment">--WhiteboardR</span>
		<span class="token keyword">else</span> Block<span class="token punctuation">:</span><span class="token function">setBlockAll</span><span class="token punctuation">(</span>xPos<span class="token punctuation">,</span> yPos<span class="token punctuation">,</span> zPos<span class="token punctuation">,</span> rPanId<span class="token punctuation">,</span> faceDir<span class="token punctuation">)</span> <span class="token keyword">end</span>

		<span class="token keyword">if</span> dodel <span class="token keyword">then</span> Block<span class="token punctuation">:</span><span class="token function">destroyBlock</span><span class="token punctuation">(</span>xPos<span class="token operator">-</span>txdiv<span class="token punctuation">,</span> yPos<span class="token punctuation">,</span> zPos<span class="token operator">-</span>tzdiv<span class="token punctuation">)</span> <span class="token comment">--RequiredR</span>
		<span class="token keyword">else</span> Block<span class="token punctuation">:</span><span class="token function">setBlockAll</span><span class="token punctuation">(</span>xPos<span class="token operator">-</span>txdiv<span class="token punctuation">,</span> yPos<span class="token punctuation">,</span> zPos<span class="token operator">-</span>tzdiv<span class="token punctuation">,</span> clock<span class="token punctuation">.</span>target<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> faceDir<span class="token punctuation">)</span> <span class="token keyword">end</span>
	<span class="token keyword">end</span>

	<span class="token comment">-- addLeft half clock</span>
	xPos<span class="token punctuation">,</span> yPos<span class="token punctuation">,</span> zPos <span class="token operator">=</span> clock<span class="token punctuation">.</span>x<span class="token operator">-</span>xdiv<span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">,</span> clock<span class="token punctuation">.</span>y<span class="token punctuation">,</span> clock<span class="token punctuation">.</span>z<span class="token operator">-</span>zdiv<span class="token operator">*</span><span class="token number">2</span>
	<span class="token keyword">if</span> dodel <span class="token keyword">then</span> Block<span class="token punctuation">:</span><span class="token function">destroyBlock</span><span class="token punctuation">(</span>xPos<span class="token punctuation">,</span> yPos<span class="token punctuation">,</span> zPos<span class="token punctuation">)</span>
	<span class="token keyword">else</span> Block<span class="token punctuation">:</span><span class="token function">setBlockAll</span><span class="token punctuation">(</span>xPos<span class="token punctuation">,</span> yPos<span class="token punctuation">,</span> zPos<span class="token punctuation">,</span> clockId<span class="token punctuation">,</span> faceDir<span class="token punctuation">)</span> <span class="token keyword">end</span>

	<span class="token comment">-- add drink in the right side</span>
	xPos<span class="token punctuation">,</span> yPos<span class="token punctuation">,</span> zPos <span class="token operator">=</span> clock<span class="token punctuation">.</span>x<span class="token operator">+</span>xdiv<span class="token punctuation">,</span> clock<span class="token punctuation">.</span>y<span class="token punctuation">,</span> clock<span class="token punctuation">.</span>z<span class="token operator">+</span>zdiv
	<span class="token keyword">if</span> dodel <span class="token keyword">then</span> Block<span class="token punctuation">:</span><span class="token function">destroyBlock</span><span class="token punctuation">(</span>xPos<span class="token punctuation">,</span> yPos<span class="token punctuation">,</span> zPos<span class="token punctuation">)</span>
	<span class="token keyword">else</span> Block<span class="token punctuation">:</span><span class="token function">setBlockAll</span><span class="token punctuation">(</span>xPos<span class="token punctuation">,</span> yPos<span class="token punctuation">,</span> zPos<span class="token punctuation">,</span> drinkId<span class="token punctuation">,</span> faceDir<span class="token punctuation">)</span> <span class="token keyword">end</span>
	
	<span class="token keyword">local</span> status <span class="token operator">=</span> dodel <span class="token keyword">and</span> <span class="token string">'destroy'</span> <span class="token keyword">or</span> <span class="token string">'count'</span>
	<span class="token function">ClockCounted</span><span class="token punctuation">(</span>clock<span class="token punctuation">,</span> status<span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token comment">-- Guest required starts to count down</span>
<span class="token keyword">function</span> <span class="token function">ClockCounted</span><span class="token punctuation">(</span>clock<span class="token punctuation">,</span> status<span class="token punctuation">)</span>
	status <span class="token operator">=</span> status <span class="token keyword">and</span> status <span class="token keyword">or</span> <span class="token string">'count'</span>
	<span class="token comment">-- Return if it is timed and stopped</span>
	<span class="token keyword">if</span> status<span class="token operator">==</span><span class="token string">'count'</span> <span class="token keyword">and</span> clock<span class="token punctuation">.</span>stop <span class="token keyword">then</span> <span class="token keyword">return</span> <span class="token keyword">end</span>

	<span class="token keyword">local</span> faceDir <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token comment">-- Block orientation</span>
	<span class="token keyword">local</span> xdiv<span class="token punctuation">,</span>zdiv <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token comment">-- X,Z Coordinate offset</span>
	<span class="token keyword">if</span> clock<span class="token punctuation">.</span>fdir<span class="token operator">==</span><span class="token number">1</span> <span class="token keyword">then</span> faceDir<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>xdiv<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">end</span> <span class="token comment">--Z axis reverse direction</span>
	<span class="token keyword">if</span> clock<span class="token punctuation">.</span>fdir<span class="token operator">==</span><span class="token number">2</span> <span class="token keyword">then</span> faceDir<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">;</span>zdiv<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">end</span> <span class="token comment">--Y axis reverse direction</span>
	<span class="token keyword">if</span> clock<span class="token punctuation">.</span>fdir<span class="token operator">==</span><span class="token number">3</span> <span class="token keyword">then</span> faceDir<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span>xdiv<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">end</span> <span class="token comment">--Z-axis square</span>
	<span class="token keyword">if</span> clock<span class="token punctuation">.</span>fdir<span class="token operator">==</span><span class="token number">4</span> <span class="token keyword">then</span> faceDir<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span>zdiv<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">end</span> <span class="token comment">--Y-axis square</span>

	<span class="token keyword">if</span> status <span class="token operator">==</span> <span class="token string">'destroy'</span> <span class="token keyword">then</span>
		Block<span class="token punctuation">:</span><span class="token function">destroyBlock</span><span class="token punctuation">(</span>clock<span class="token punctuation">.</span>x<span class="token punctuation">,</span> clock<span class="token punctuation">.</span>y<span class="token punctuation">,</span> clock<span class="token punctuation">.</span>z<span class="token punctuation">)</span>
		Block<span class="token punctuation">:</span><span class="token function">destroyBlock</span><span class="token punctuation">(</span>clock<span class="token punctuation">.</span>x<span class="token operator">-</span>xdiv<span class="token punctuation">,</span> clock<span class="token punctuation">.</span>y<span class="token punctuation">,</span> clock<span class="token punctuation">.</span>z<span class="token operator">-</span>zdiv<span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token keyword">end</span>

	<span class="token comment">-- Timing or initialization status</span>
	<span class="token keyword">local</span> strTime <span class="token operator">=</span> <span class="token function">tostring</span><span class="token punctuation">(</span>clock<span class="token punctuation">.</span>time<span class="token punctuation">)</span>
	<span class="token keyword">local</span> left <span class="token operator">=</span> <span class="token operator">#</span>strTime<span class="token operator">&gt;</span><span class="token number">1</span> <span class="token keyword">and</span> strTime<span class="token punctuation">:</span><span class="token function">sub</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token number">0</span><span class="token comment">--Ten digits</span>
	<span class="token keyword">local</span> right <span class="token operator">=</span> <span class="token operator">#</span>strTime<span class="token operator">&gt;</span><span class="token number">1</span> <span class="token keyword">and</span> strTime<span class="token punctuation">:</span><span class="token function">sub</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">or</span> strTime<span class="token punctuation">:</span><span class="token function">sub</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

	<span class="token keyword">local</span> leftId <span class="token operator">=</span> ClockNumIDs<span class="token punctuation">[</span><span class="token function">tonumber</span><span class="token punctuation">(</span>left<span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">10</span><span class="token punctuation">]</span>
	<span class="token keyword">local</span> rightId <span class="token operator">=</span> ClockNumIDs<span class="token punctuation">[</span><span class="token function">tonumber</span><span class="token punctuation">(</span>right<span class="token punctuation">)</span><span class="token punctuation">]</span>
	<span class="token keyword">if</span> <span class="token keyword">not</span> leftId <span class="token keyword">or</span> <span class="token keyword">not</span> rightId <span class="token keyword">then</span> <span class="token keyword">return</span> <span class="token keyword">end</span>

	<span class="token comment">-- Set left and right timer</span>
	Block<span class="token punctuation">:</span><span class="token function">setBlockAll</span><span class="token punctuation">(</span>clock<span class="token punctuation">.</span>x<span class="token operator">-</span>xdiv<span class="token punctuation">,</span> clock<span class="token punctuation">.</span>y<span class="token punctuation">,</span> clock<span class="token punctuation">.</span>z<span class="token operator">-</span>zdiv<span class="token punctuation">,</span> leftId<span class="token punctuation">,</span> faceDir<span class="token punctuation">)</span>
	Block<span class="token punctuation">:</span><span class="token function">setBlockAll</span><span class="token punctuation">(</span>clock<span class="token punctuation">.</span>x<span class="token punctuation">,</span> clock<span class="token punctuation">.</span>y<span class="token punctuation">,</span> clock<span class="token punctuation">.</span>z<span class="token punctuation">,</span> rightId<span class="token punctuation">,</span> faceDir<span class="token punctuation">)</span>

	<span class="token keyword">if</span> clock<span class="token punctuation">.</span>time <span class="token operator">==</span> <span class="token number">10</span> <span class="token keyword">then</span> <span class="token comment">--10 seconds left</span>
		<span class="token keyword">local</span> tsize <span class="token operator">=</span> <span class="token operator">#</span>clock<span class="token punctuation">.</span>target
		<span class="token keyword">local</span> lPanId<span class="token punctuation">,</span>mPanId<span class="token punctuation">,</span>rPanId <span class="token operator">=</span> <span class="token number">3906</span><span class="token punctuation">,</span><span class="token number">3905</span><span class="token punctuation">,</span><span class="token number">3934</span>
		Block<span class="token punctuation">:</span><span class="token function">setBlockAll</span><span class="token punctuation">(</span>clock<span class="token punctuation">.</span>x<span class="token operator">-</span>xdiv<span class="token punctuation">,</span> clock<span class="token punctuation">.</span>y<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">,</span> clock<span class="token punctuation">.</span>z<span class="token operator">-</span>zdiv<span class="token punctuation">,</span> lPanId<span class="token punctuation">,</span> faceDir<span class="token punctuation">)</span>
		<span class="token keyword">if</span> tsize <span class="token operator">&lt;=</span> <span class="token number">2</span> <span class="token keyword">then</span>
			Block<span class="token punctuation">:</span><span class="token function">setBlockAll</span><span class="token punctuation">(</span>clock<span class="token punctuation">.</span>x<span class="token punctuation">,</span> clock<span class="token punctuation">.</span>y<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">,</span> clock<span class="token punctuation">.</span>z<span class="token punctuation">,</span> rPanId<span class="token punctuation">,</span> faceDir<span class="token punctuation">)</span>
		<span class="token keyword">else</span> <span class="token comment">-- more than 2 Target</span>
			Block<span class="token punctuation">:</span><span class="token function">setBlockAll</span><span class="token punctuation">(</span>clock<span class="token punctuation">.</span>x<span class="token punctuation">,</span> clock<span class="token punctuation">.</span>y<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">,</span> clock<span class="token punctuation">.</span>z<span class="token punctuation">,</span> mPanId<span class="token punctuation">,</span> faceDir<span class="token punctuation">)</span>
			Block<span class="token punctuation">:</span><span class="token function">setBlockAll</span><span class="token punctuation">(</span>clock<span class="token punctuation">.</span>x<span class="token operator">+</span>xdiv<span class="token punctuation">,</span> clock<span class="token punctuation">.</span>y<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">,</span> clock<span class="token punctuation">.</span>z<span class="token operator">+</span>zdiv<span class="token punctuation">,</span> rPanId<span class="token punctuation">,</span> faceDir<span class="token punctuation">)</span>
		<span class="token keyword">end</span>

		<span class="token keyword">local</span> headId <span class="token operator">=</span> <span class="token number">3940</span> <span class="token comment">--Head change</span>
		Block<span class="token punctuation">:</span><span class="token function">setBlockAll</span><span class="token punctuation">(</span>clock<span class="token punctuation">.</span>x<span class="token punctuation">,</span> clock<span class="token punctuation">.</span>y<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> clock<span class="token punctuation">.</span>z<span class="token punctuation">,</span> headId<span class="token punctuation">,</span> faceDir<span class="token punctuation">)</span>
	<span class="token keyword">end</span>
<span class="token keyword">end</span>

<span class="token keyword">local</span> TargetHited <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>clock<span class="token punctuation">)</span>
	<span class="token keyword">local</span> xPos<span class="token punctuation">,</span> yPos<span class="token punctuation">,</span> zPos <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span>
	
	<span class="token keyword">local</span> faceDir <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token comment">--Block orientation</span>
	<span class="token keyword">local</span> xdiv<span class="token punctuation">,</span>zdiv <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token comment">--X,Z Coordinate offset</span>
	<span class="token keyword">local</span> txdiv<span class="token punctuation">,</span>tzdiv <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token comment">--Required part Position offset</span>
	<span class="token keyword">if</span> clock<span class="token punctuation">.</span>fdir<span class="token operator">==</span><span class="token number">1</span> <span class="token keyword">then</span> faceDir<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>xdiv<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>tzdiv<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token keyword">end</span> <span class="token comment">--Z axis reverse direction</span>
	<span class="token keyword">if</span> clock<span class="token punctuation">.</span>fdir<span class="token operator">==</span><span class="token number">2</span> <span class="token keyword">then</span> faceDir<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">;</span>zdiv<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>txdiv<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token keyword">end</span> <span class="token comment">--Y axis reverse direction</span>
	<span class="token keyword">if</span> clock<span class="token punctuation">.</span>fdir<span class="token operator">==</span><span class="token number">3</span> <span class="token keyword">then</span> faceDir<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span>xdiv<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>tzdiv<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token keyword">end</span> <span class="token comment">--Z-axis square</span>
	<span class="token keyword">if</span> clock<span class="token punctuation">.</span>fdir<span class="token operator">==</span><span class="token number">4</span> <span class="token keyword">then</span> faceDir<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span>zdiv<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>txdiv<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token keyword">end</span> <span class="token comment">--Y-axis square</span>

	<span class="token keyword">local</span> checkId <span class="token operator">=</span> IDs<span class="token punctuation">.</span>checkBlkIdx
	<span class="token keyword">local</span> tsize <span class="token operator">=</span> <span class="token operator">#</span>clock<span class="token punctuation">.</span>target <span class="token comment">--Required Quantity</span>
	<span class="token comment">-- set Required part complete the mark</span>
	xPos<span class="token punctuation">,</span> yPos<span class="token punctuation">,</span> zPos <span class="token operator">=</span> clock<span class="token punctuation">.</span>x<span class="token operator">-</span>xdiv<span class="token punctuation">,</span> clock<span class="token punctuation">.</span>y<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">,</span> clock<span class="token punctuation">.</span>z<span class="token operator">-</span>zdiv <span class="token comment">--RequiredL</span>
	Block<span class="token punctuation">:</span><span class="token function">setBlockAll</span><span class="token punctuation">(</span>xPos<span class="token operator">-</span>txdiv<span class="token punctuation">,</span> yPos<span class="token punctuation">,</span> zPos<span class="token operator">-</span>tzdiv<span class="token punctuation">,</span> checkId<span class="token punctuation">,</span> faceDir<span class="token punctuation">)</span>
	<span class="token keyword">if</span> tsize <span class="token operator">&lt;=</span> <span class="token number">2</span> <span class="token keyword">then</span>
		xPos<span class="token punctuation">,</span> yPos<span class="token punctuation">,</span> zPos <span class="token operator">=</span> clock<span class="token punctuation">.</span>x<span class="token punctuation">,</span> clock<span class="token punctuation">.</span>y<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">,</span> clock<span class="token punctuation">.</span>z <span class="token comment">--RequiredR</span>
		Block<span class="token punctuation">:</span><span class="token function">setBlockAll</span><span class="token punctuation">(</span>xPos<span class="token operator">-</span>txdiv<span class="token punctuation">,</span> yPos<span class="token punctuation">,</span> zPos<span class="token operator">-</span>tzdiv<span class="token punctuation">,</span> checkId<span class="token punctuation">,</span> faceDir<span class="token punctuation">)</span>
	<span class="token keyword">else</span> <span class="token comment">-- More than 2 Required parts</span>
		xPos<span class="token punctuation">,</span> yPos<span class="token punctuation">,</span> zPos <span class="token operator">=</span> clock<span class="token punctuation">.</span>x<span class="token punctuation">,</span> clock<span class="token punctuation">.</span>y<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">,</span> clock<span class="token punctuation">.</span>z <span class="token comment">--RequiredM</span>
		Block<span class="token punctuation">:</span><span class="token function">setBlockAll</span><span class="token punctuation">(</span>xPos<span class="token operator">-</span>txdiv<span class="token punctuation">,</span> yPos<span class="token punctuation">,</span> zPos<span class="token operator">-</span>tzdiv<span class="token punctuation">,</span> checkId<span class="token punctuation">,</span> faceDir<span class="token punctuation">)</span>
		
		xPos<span class="token punctuation">,</span> yPos<span class="token punctuation">,</span> zPos <span class="token operator">=</span> clock<span class="token punctuation">.</span>x<span class="token operator">+</span>xdiv<span class="token punctuation">,</span> clock<span class="token punctuation">.</span>y<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">,</span> clock<span class="token punctuation">.</span>z<span class="token operator">+</span>zdiv <span class="token comment">--RequiredR</span>
		Block<span class="token punctuation">:</span><span class="token function">setBlockAll</span><span class="token punctuation">(</span>xPos<span class="token operator">-</span>txdiv<span class="token punctuation">,</span> yPos<span class="token punctuation">,</span> zPos<span class="token operator">-</span>tzdiv<span class="token punctuation">,</span> checkId<span class="token punctuation">,</span> faceDir<span class="token punctuation">)</span>
	<span class="token keyword">end</span>
<span class="token keyword">end</span>

<span class="token comment">-- Refresh guest Required part </span>
<span class="token keyword">local</span> TargetRefresh <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>cInfo<span class="token punctuation">)</span>
	<span class="token keyword">local</span> csize <span class="token operator">=</span> <span class="token operator">#</span>CurrStage<span class="token punctuation">.</span>seqids
	<span class="token keyword">if</span> cInfo<span class="token operator">~=</span><span class="token keyword">nil</span> <span class="token keyword">and</span> csize<span class="token operator">&gt;</span><span class="token number">0</span> <span class="token keyword">then</span>
		<span class="token keyword">for</span> idx <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> csize <span class="token keyword">do</span> <span class="token comment">--Delete from line</span>
			<span class="token keyword">local</span> seqId <span class="token operator">=</span> CurrStage<span class="token punctuation">.</span>seqids<span class="token punctuation">[</span>idx<span class="token punctuation">]</span>
			<span class="token keyword">if</span> cInfo<span class="token punctuation">.</span>seq <span class="token operator">==</span> seqId <span class="token keyword">then</span>
				table<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>CurrStage<span class="token punctuation">.</span>seqids<span class="token punctuation">,</span> idx<span class="token punctuation">)</span>
				<span class="token keyword">break</span>
			<span class="token keyword">end</span>
		<span class="token keyword">end</span>
	<span class="token keyword">end</span>

	<span class="token comment">-- create a Required part </span>
	customers <span class="token operator">=</span> customers <span class="token operator">+</span> <span class="token number">1</span>
	<span class="token keyword">local</span> stage <span class="token operator">=</span> CurrStage<span class="token punctuation">.</span>stage
	<span class="token keyword">local</span> clock <span class="token operator">=</span> <span class="token function">GetRandomClock</span><span class="token punctuation">(</span>stage<span class="token punctuation">)</span>

	<span class="token keyword">local</span> csize <span class="token operator">=</span> <span class="token operator">#</span>CurrStage<span class="token punctuation">.</span>clocks
	CurrStage<span class="token punctuation">.</span>clocks<span class="token punctuation">[</span>csize<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> clock
	<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'Frt===&gt;&gt;'</span><span class="token punctuation">,</span> csize<span class="token punctuation">,</span> CurrStage<span class="token punctuation">.</span>clocks<span class="token punctuation">)</span>

	<span class="token function">ClockCrtOrDel</span><span class="token punctuation">(</span>clock<span class="token punctuation">,</span> <span class="token keyword">false</span><span class="token punctuation">)</span>
	<span class="token keyword">local</span> chatTips <span class="token operator">=</span> string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>GameTips<span class="token punctuation">.</span>windComes<span class="token punctuation">,</span> customers<span class="token punctuation">)</span>
	Chat<span class="token punctuation">:</span><span class="token function">sendSystemMsg</span><span class="token punctuation">(</span>chatTips<span class="token punctuation">)</span>

	<span class="token comment">-- Reflesh the guest requiredX,Z Coordinate offset</span>
	<span class="token keyword">local</span> mPos <span class="token operator">=</span> GameSData<span class="token punctuation">[</span>stage<span class="token punctuation">]</span><span class="token punctuation">.</span>mpos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
	Block<span class="token punctuation">:</span><span class="token function">destroyBlock</span><span class="token punctuation">(</span>mPos<span class="token punctuation">.</span>x<span class="token punctuation">,</span> mPos<span class="token punctuation">.</span>y<span class="token punctuation">,</span> mPos<span class="token punctuation">.</span>z<span class="token punctuation">)</span>
	<span class="token keyword">local</span> createBlock <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		Block<span class="token punctuation">:</span><span class="token function">setBlockAll</span><span class="token punctuation">(</span>mPos<span class="token punctuation">.</span>x<span class="token punctuation">,</span> mPos<span class="token punctuation">.</span>y<span class="token punctuation">,</span> mPos<span class="token punctuation">.</span>z<span class="token punctuation">,</span> IDs<span class="token punctuation">.</span>musicBlkIdx<span class="token punctuation">)</span>	
	<span class="token keyword">end</span>
	threadpool<span class="token punctuation">:</span><span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> createBlock<span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token comment">-----Generate tray after delivery-----</span>
<span class="token keyword">local</span> GensDirtyDish <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>cInfo<span class="token punctuation">)</span>
	<span class="token keyword">local</span> csize <span class="token operator">=</span> <span class="token operator">#</span>CurrStage<span class="token punctuation">.</span>seqids
	<span class="token keyword">for</span> idx <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> csize <span class="token keyword">do</span> <span class="token comment">--Delete from line</span>
		<span class="token keyword">local</span> seqId <span class="token operator">=</span> CurrStage<span class="token punctuation">.</span>seqids<span class="token punctuation">[</span>idx<span class="token punctuation">]</span>
		<span class="token keyword">if</span> cInfo<span class="token punctuation">.</span>seq <span class="token operator">==</span> seqId <span class="token keyword">then</span>
			table<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>CurrStage<span class="token punctuation">.</span>seqids<span class="token punctuation">,</span> idx<span class="token punctuation">)</span>
			<span class="token keyword">break</span>
		<span class="token keyword">end</span>
	<span class="token keyword">end</span>

	<span class="token keyword">local</span> cur_stage <span class="token operator">=</span> CurrStage<span class="token punctuation">.</span>stage
	<span class="token keyword">local</span> dpos <span class="token operator">=</span> GameSData<span class="token punctuation">[</span>cur_stage<span class="token punctuation">]</span><span class="token punctuation">.</span>dpos

	<span class="token keyword">local</span> yOffset <span class="token operator">=</span> <span class="token number">2</span>
	<span class="token keyword">local</span> isSucc <span class="token operator">=</span> <span class="token keyword">false</span>
	
	<span class="token keyword">for</span> jdx <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> yOffset <span class="token keyword">do</span> <span class="token comment">--Up to two layers</span>
		<span class="token keyword">for</span> idx <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">#</span>dpos <span class="token keyword">do</span> <span class="token comment">--if the layer has no blocks</span>
			<span class="token keyword">local</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z <span class="token operator">=</span> dpos<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span>dpos<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">,</span>dpos<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">.</span>z
			<span class="token keyword">local</span> ret<span class="token punctuation">,</span> blockId <span class="token operator">=</span> Block<span class="token punctuation">:</span><span class="token function">getBlockID</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token operator">+</span>jdx<span class="token punctuation">,</span> z<span class="token punctuation">)</span>
			<span class="token keyword">if</span> ret<span class="token operator">==</span>ErrorCode<span class="token punctuation">.</span>OK <span class="token keyword">and</span> blockId<span class="token operator">==</span><span class="token number">0</span> <span class="token keyword">then</span>
				<span class="token keyword">if</span> cur_stage <span class="token operator">==</span> <span class="token number">1</span> <span class="token keyword">then</span> <span class="token comment">--The first level is generated by a clean plate.</span>
					Block<span class="token punctuation">:</span><span class="token function">setBlockAll</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token operator">+</span>jdx<span class="token punctuation">,</span> z<span class="token punctuation">,</span> IDs<span class="token punctuation">.</span>emptyDishId<span class="token punctuation">)</span>
				<span class="token keyword">else</span> <span class="token comment">--Other levels generate dirty dishes</span>
					Block<span class="token punctuation">:</span><span class="token function">setBlockAll</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token operator">+</span>jdx<span class="token punctuation">,</span> z<span class="token punctuation">,</span> IDs<span class="token punctuation">.</span>dirtyDishId<span class="token punctuation">)</span>
				<span class="token keyword">end</span>
				<span class="token keyword">return</span>
			<span class="token keyword">end</span>
		<span class="token keyword">end</span>
	<span class="token keyword">end</span>
<span class="token keyword">end</span>

<span class="token comment">--if table have key</span>
<span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">KeyInTable</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> ctab<span class="token punctuation">)</span>
	<span class="token keyword">for</span> idx<span class="token punctuation">,</span> val <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>ctab<span class="token punctuation">)</span> <span class="token keyword">do</span>
		<span class="token keyword">if</span> val<span class="token operator">==</span>key <span class="token keyword">then</span> <span class="token keyword">return</span> <span class="token keyword">true</span> <span class="token keyword">end</span>
	<span class="token keyword">end</span>
	<span class="token keyword">return</span> <span class="token keyword">false</span>
<span class="token keyword">end</span>

<span class="token comment">--Replace tick times</span>
<span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">IsCanTick</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	tickCount <span class="token operator">=</span> tickCount<span class="token operator">+</span><span class="token number">1</span>

	<span class="token keyword">if</span> tickCount<span class="token operator">&gt;=</span>newTicker <span class="token keyword">then</span> 
		tickCount <span class="token operator">=</span> <span class="token number">0</span>		
		<span class="token keyword">return</span> <span class="token keyword">true</span>
	<span class="token keyword">end</span>

	<span class="token keyword">return</span> <span class="token keyword">false</span>
<span class="token keyword">end</span>

<span class="token comment">-- Initialize game data</span>
<span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">InitGameData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">--Initialize the dish class block DishBlks</span>
	<span class="token keyword">for</span> key<span class="token punctuation">,</span> dict <span class="token keyword">in</span> <span class="token function">pairs</span><span class="token punctuation">(</span>FinalIDs<span class="token punctuation">)</span> <span class="token keyword">do</span>
    	<span class="token keyword">for</span> ckey<span class="token punctuation">,</span> cval <span class="token keyword">in</span> <span class="token function">pairs</span><span class="token punctuation">(</span>dict<span class="token punctuation">)</span> <span class="token keyword">do</span>
    		<span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token function">KeyInTable</span><span class="token punctuation">(</span>ckey<span class="token punctuation">,</span> DishBlks<span class="token punctuation">)</span> <span class="token keyword">then</span> DishBlks<span class="token punctuation">[</span><span class="token operator">#</span>DishBlks<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> ckey <span class="token keyword">end</span>
    		<span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token function">KeyInTable</span><span class="token punctuation">(</span>cval<span class="token punctuation">,</span> DishBlks<span class="token punctuation">)</span> <span class="token keyword">then</span> DishBlks<span class="token punctuation">[</span><span class="token operator">#</span>DishBlks<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> cval <span class="token keyword">end</span>
    	<span class="token keyword">end</span>
    <span class="token keyword">end</span>
<span class="token keyword">end</span>

<span class="token comment">--Game rulemaking</span>
<span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">InitGameRule</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	IsGRuleInit <span class="token operator">=</span> <span class="token keyword">true</span> <span class="token comment">-- Initialization target</span>
	GameRule<span class="token punctuation">.</span>CameraDir <span class="token operator">=</span> <span class="token number">1</span>       <span class="token comment">--Default positive angle</span>
	GameRule<span class="token punctuation">.</span>StartMode <span class="token operator">=</span> <span class="token number">0</span>       <span class="token comment">--Open mode</span>
	GameRule<span class="token punctuation">.</span>StartPlayers <span class="token operator">=</span> <span class="token number">1</span>    <span class="token comment">--Minimum player amount:1</span>
	GameRule<span class="token punctuation">.</span>DisplayScore <span class="token operator">=</span> <span class="token number">1</span>    <span class="token comment">--Display score:1</span>
	GameRule<span class="token punctuation">.</span>BlockDestroy <span class="token operator">=</span> <span class="token number">0</span>    <span class="token comment">--Blocks cannot be destroyed</span>

	GameRule<span class="token punctuation">.</span>WinLoseEndTime <span class="token operator">=</span> <span class="token number">2</span>
<span class="token keyword">end</span>

<span class="token comment">--Score Settlement</span>
<span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">ShowGBattleUI</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">-- Set the total score</span>
	<span class="token keyword">local</span> stage <span class="token operator">=</span> CurrStage<span class="token punctuation">.</span>stage
	<span class="token keyword">local</span> score <span class="token operator">=</span> CurrStage<span class="token punctuation">.</span>score
	<span class="token keyword">for</span> idx<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> stage<span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">do</span>
		score <span class="token operator">=</span> score <span class="token operator">+</span> GameSData<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">.</span>score
	<span class="token keyword">end</span>

	<span class="token keyword">local</span> ret<span class="token punctuation">,</span> txt <span class="token operator">=</span> Game<span class="token punctuation">:</span><span class="token function">getDefString</span><span class="token punctuation">(</span><span class="token number">3176</span><span class="token punctuation">)</span>
	<span class="token keyword">local</span> txtInfo <span class="token operator">=</span> string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">'%s:%d'</span><span class="token punctuation">,</span> txt<span class="token punctuation">,</span>score<span class="token punctuation">)</span>

	UI<span class="token punctuation">:</span><span class="token function">setGBattleUI</span><span class="token punctuation">(</span><span class="token string">'right_little_desc'</span><span class="token punctuation">,</span> txtInfo<span class="token punctuation">)</span>
	UI<span class="token punctuation">:</span><span class="token function">setGBattleUI</span><span class="token punctuation">(</span><span class="token string">'battle_btn'</span><span class="token punctuation">,</span> <span class="token keyword">false</span><span class="token punctuation">)</span>
	UI<span class="token punctuation">:</span><span class="token function">setGBattleUI</span><span class="token punctuation">(</span><span class="token string">'result'</span><span class="token punctuation">,</span> <span class="token keyword">false</span><span class="token punctuation">)</span>
	UI<span class="token punctuation">:</span><span class="token function">setGBattleUI</span><span class="token punctuation">(</span><span class="token string">'result_bkg'</span><span class="token punctuation">,</span> <span class="token keyword">false</span><span class="token punctuation">)</span>
	UI<span class="token punctuation">:</span><span class="token function">setGBattleUI</span><span class="token punctuation">(</span><span class="token string">'reopen'</span><span class="token punctuation">,</span> <span class="token keyword">true</span><span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token comment">--Reset new round</span>
<span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">StartNewRound</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">-- Stop the clock and destroy it</span>
	<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'Fz==&gt;&gt;&gt;'</span><span class="token punctuation">,</span> CurrStage<span class="token punctuation">.</span>clocks<span class="token punctuation">)</span>
	<span class="token keyword">for</span> idx <span class="token operator">=</span> <span class="token operator">#</span>CurrStage<span class="token punctuation">.</span>clocks<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">do</span>
		<span class="token keyword">local</span> clock <span class="token operator">=</span> CurrStage<span class="token punctuation">.</span>clocks<span class="token punctuation">[</span>idx<span class="token punctuation">]</span>
		clock<span class="token punctuation">.</span>stop <span class="token operator">=</span> <span class="token keyword">true</span>
		<span class="token function">ClockCrtOrDel</span><span class="token punctuation">(</span>clock<span class="token punctuation">,</span> <span class="token keyword">true</span><span class="token punctuation">)</span>
		table<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>CurrStage<span class="token punctuation">.</span>clocks<span class="token punctuation">,</span> idx<span class="token punctuation">)</span>
	<span class="token keyword">end</span>
			
	<span class="token comment">-- Clear Required part /Delayed call</span>
	<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'Fw==&gt;&gt;&gt;'</span><span class="token punctuation">,</span> CurrStage<span class="token punctuation">.</span>seqids<span class="token punctuation">)</span>
	<span class="token keyword">for</span> idx <span class="token operator">=</span> <span class="token operator">#</span>CurrStage<span class="token punctuation">.</span>seqids<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">do</span>
		<span class="token keyword">local</span> seqId <span class="token operator">=</span> CurrStage<span class="token punctuation">.</span>seqids<span class="token punctuation">[</span>idx<span class="token punctuation">]</span>
		threadpool<span class="token punctuation">:</span><span class="token function">kick</span><span class="token punctuation">(</span>seqId<span class="token punctuation">)</span><span class="token comment">--delete Delayed call</span>
		table<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>CurrStage<span class="token punctuation">.</span>seqids<span class="token punctuation">,</span> idx<span class="token punctuation">)</span>
	<span class="token keyword">end</span>
	
	<span class="token function">Game_Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">--Restart the game</span>
<span class="token keyword">end</span>

<span class="token comment">--Get the point and check if the level is completed</span>
<span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">TeamAddScore</span><span class="token punctuation">(</span>teamId<span class="token punctuation">,</span> addScore<span class="token punctuation">)</span>
	<span class="token keyword">local</span> teamId <span class="token operator">=</span> teamId <span class="token keyword">and</span> teamId <span class="token keyword">or</span> teamIdx
	<span class="token keyword">local</span> ret <span class="token operator">=</span> Team<span class="token punctuation">:</span><span class="token function">addTeamScore</span><span class="token punctuation">(</span>teamId<span class="token punctuation">,</span> addScore<span class="token punctuation">)</span>
	<span class="token keyword">local</span> ret<span class="token punctuation">,</span> score <span class="token operator">=</span> Team<span class="token punctuation">:</span><span class="token function">getTeamScore</span><span class="token punctuation">(</span>teamId<span class="token punctuation">)</span>
	<span class="token keyword">if</span> ret <span class="token operator">==</span> ErrorCode<span class="token punctuation">.</span>OK <span class="token keyword">then</span> CurrStage<span class="token punctuation">.</span>score <span class="token operator">=</span> score <span class="token keyword">end</span>

	<span class="token keyword">local</span> ret<span class="token punctuation">,</span>num<span class="token punctuation">,</span>players <span class="token operator">=</span> World<span class="token punctuation">:</span><span class="token function">getAllPlayers</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> ret<span class="token operator">==</span>ErrorCode<span class="token punctuation">.</span>OK <span class="token keyword">then</span>
		<span class="token keyword">for</span> idx <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">#</span>players <span class="token keyword">do</span> <span class="token comment">--add tips to all players</span>
			<span class="token keyword">local</span> scoreTips <span class="token operator">=</span> addScore<span class="token operator">==</span><span class="token number">1</span> <span class="token keyword">and</span> GameTips<span class="token punctuation">.</span>windScore1 <span class="token keyword">or</span> GameTips<span class="token punctuation">.</span>windScore2
			<span class="token comment">--print('Fz==&gt;&gt;&gt;', scoreTips, score==1)</span>
			Player<span class="token punctuation">:</span><span class="token function">notifyGameInfo2Self</span><span class="token punctuation">(</span>players<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">,</span> scoreTips<span class="token punctuation">)</span>
		<span class="token keyword">end</span>
	<span class="token keyword">end</span>

	<span class="token keyword">local</span> cur_stage <span class="token operator">=</span> CurrStage<span class="token punctuation">.</span>stage
	<span class="token keyword">local</span> stage_score <span class="token operator">=</span> GameSData<span class="token punctuation">[</span>cur_stage<span class="token punctuation">]</span><span class="token punctuation">.</span>score
	<span class="token keyword">if</span> CurrStage<span class="token punctuation">.</span>score <span class="token operator">&gt;=</span> stage_score <span class="token keyword">then</span>
		<span class="token keyword">local</span> new_stage <span class="token operator">=</span> cur_stage<span class="token operator">+</span><span class="token number">1</span>		

		<span class="token keyword">if</span> new_stage <span class="token operator">&gt;</span> <span class="token operator">#</span>GameSData <span class="token keyword">then</span>
			IsGameEnded <span class="token operator">=</span> <span class="token keyword">true</span> <span class="token comment">--finished all levels</span>
			BattleResult <span class="token operator">=</span> TEAM_RESULTS<span class="token punctuation">.</span>TEAM_RESULTS_WIN
			Game<span class="token punctuation">:</span><span class="token function">doGameEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">else</span> <span class="token comment">--turn to next level</span>
			CurrStage<span class="token punctuation">.</span>stage <span class="token operator">=</span> new_stage
			<span class="token comment">--Chat:sendSystemMsg(GameTips.NewStage)</span>
			<span class="token keyword">for</span> idx <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">#</span>players <span class="token keyword">do</span> <span class="token comment">--Changed to player tips</span>
				Player<span class="token punctuation">:</span><span class="token function">notifyGameInfo2Self</span><span class="token punctuation">(</span>players<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">,</span> GameTips<span class="token punctuation">.</span>NewStage<span class="token punctuation">)</span>
			<span class="token keyword">end</span>
			
			<span class="token comment">--Reset the new round after 3 seconds</span>
			miniTimer2 <span class="token operator">=</span> <span class="token number">3</span>
			MiniTimer<span class="token punctuation">:</span><span class="token function">pauseTimer</span><span class="token punctuation">(</span>miniTimer1<span class="token punctuation">)</span>
			<span class="token comment">--threadpool:delay(3, StartNewRound)</span>

			<span class="token keyword">if</span> IsLastCount <span class="token keyword">then</span> <span class="token comment">--Reset timer music</span>
				IsLastCount <span class="token operator">=</span> <span class="token keyword">false</span>
				<span class="token keyword">for</span> stage <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span> <span class="token keyword">do</span> <span class="token comment">--All levels</span>
					<span class="token keyword">local</span> musicId <span class="token operator">=</span> IDs<span class="token punctuation">.</span>musicBlkIdx
					<span class="token keyword">local</span> mPos <span class="token operator">=</span> GameSData<span class="token punctuation">[</span>stage<span class="token punctuation">]</span><span class="token punctuation">.</span>mpos<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
					Block<span class="token punctuation">:</span><span class="token function">setBlockAll</span><span class="token punctuation">(</span>mPos<span class="token punctuation">.</span>x<span class="token punctuation">,</span> mPos<span class="token punctuation">.</span>y<span class="token punctuation">,</span> mPos<span class="token punctuation">.</span>z<span class="token punctuation">,</span> musicId<span class="token punctuation">)</span>	
				<span class="token keyword">end</span>
			<span class="token keyword">end</span>
		<span class="token keyword">end</span>
	<span class="token keyword">end</span>
<span class="token keyword">end</span>

<span class="token keyword">local</span> IsLastCount <span class="token operator">=</span> <span class="token keyword">false</span>
<span class="token comment">--------Game start--------</span>
Game_Start <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">-- ShowItemName()</span>
	<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'Fz==&gt;Game_Start'</span><span class="token punctuation">)</span>

	customers <span class="token operator">=</span> <span class="token number">0</span>
	miniTimer2 <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
	CurrStage<span class="token punctuation">.</span>score <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">--Reset score</span>
	Team<span class="token punctuation">:</span><span class="token function">setTeamScore</span><span class="token punctuation">(</span>teamIdx<span class="token punctuation">,</span> CurrStage<span class="token punctuation">.</span>score<span class="token punctuation">)</span>

	<span class="token comment">-- Set game rules</span>
	<span class="token keyword">if</span> <span class="token keyword">not</span> IsGRuleInit <span class="token keyword">then</span> <span class="token function">InitGameRule</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">end</span>

	<span class="token keyword">local</span> stage <span class="token operator">=</span> CurrStage<span class="token punctuation">.</span>stage
	<span class="token keyword">local</span> ret<span class="token punctuation">,</span>num<span class="token punctuation">,</span>players <span class="token operator">=</span> World<span class="token punctuation">:</span><span class="token function">getAllPlayers</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> ret<span class="token operator">~=</span>ErrorCode<span class="token punctuation">.</span>OK <span class="token keyword">or</span> <span class="token keyword">not</span> players <span class="token keyword">then</span> <span class="token keyword">return</span> <span class="token keyword">end</span>

	<span class="token keyword">local</span> items <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">241</span><span class="token punctuation">,</span> <span class="token number">12502</span><span class="token punctuation">,</span> <span class="token number">12512</span><span class="token punctuation">,</span> <span class="token number">12516</span><span class="token punctuation">,</span> <span class="token number">12517</span><span class="token punctuation">,</span> <span class="token number">12518</span><span class="token punctuation">,</span> <span class="token number">12519</span><span class="token punctuation">}</span>
	<span class="token keyword">local</span> windTips <span class="token operator">=</span> string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>GameTips<span class="token punctuation">.</span>windStage<span class="token punctuation">,</span> stage<span class="token punctuation">)</span>
	<span class="token keyword">for</span> idx <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">#</span>players <span class="token keyword">do</span><span class="token comment">--Traversing the player</span>
		<span class="token keyword">local</span> playerId <span class="token operator">=</span> players<span class="token punctuation">[</span>idx<span class="token punctuation">]</span>
		<span class="token comment">-- Set player team</span>
		Player<span class="token punctuation">:</span><span class="token function">setTeam</span><span class="token punctuation">(</span>playerId<span class="token punctuation">,</span> teamIdx<span class="token punctuation">)</span>
		<span class="token comment">-- Clear the specified item on the player</span>
		<span class="token keyword">for</span> idx<span class="token punctuation">,</span> itemId <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span> <span class="token keyword">do</span>
			Backpack<span class="token punctuation">:</span><span class="token function">removeGridItemByItemID</span><span class="token punctuation">(</span>playerId<span class="token punctuation">,</span> itemId<span class="token punctuation">)</span>
		<span class="token keyword">end</span>

		<span class="token comment">-- Set player Spawn Point</span>
		<span class="token keyword">local</span> allPos <span class="token operator">=</span> GameSData<span class="token punctuation">[</span>stage<span class="token punctuation">]</span><span class="token punctuation">.</span>pos
		<span class="token keyword">local</span> index <span class="token operator">=</span> <span class="token punctuation">(</span>idx<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">3</span> <span class="token operator">+</span> <span class="token number">1</span>
		<span class="token keyword">local</span> curPos <span class="token operator">=</span> allPos<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token comment">--Three position cycle</span>
		<span class="token comment">--if not curPos then curPos = allPos[1] end</span>
		Player<span class="token punctuation">:</span><span class="token function">setPosition</span><span class="token punctuation">(</span>playerId<span class="token punctuation">,</span> curPos<span class="token punctuation">.</span>x<span class="token punctuation">,</span> curPos<span class="token punctuation">.</span>y<span class="token punctuation">,</span> curPos<span class="token punctuation">.</span>z<span class="token punctuation">)</span>

		<span class="token comment">-- Tip for fist time in the level</span>
		Player<span class="token punctuation">:</span><span class="token function">notifyGameInfo2Self</span><span class="token punctuation">(</span>players<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">,</span> windTips<span class="token punctuation">)</span>
	<span class="token keyword">end</span>
	
	<span class="token comment">-- Create a game timer</span>
	<span class="token keyword">if</span> miniTimer1 <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token keyword">then</span>
		<span class="token keyword">local</span> ret<span class="token punctuation">,</span> timerId <span class="token operator">=</span> MiniTimer<span class="token punctuation">:</span><span class="token function">createTimer</span><span class="token punctuation">(</span><span class="token string">'Timer1'</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> ret<span class="token operator">==</span>ErrorCode<span class="token punctuation">.</span>OK <span class="token keyword">then</span> miniTimer1 <span class="token operator">=</span> timerId <span class="token keyword">end</span>
	<span class="token keyword">end</span>
	<span class="token keyword">if</span> miniTimer1 <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">then</span> <span class="token comment">--Start level timer</span>
		<span class="token keyword">local</span> stTime <span class="token operator">=</span> GameSData<span class="token punctuation">[</span>stage<span class="token punctuation">]</span><span class="token punctuation">.</span>dtime
		MiniTimer<span class="token punctuation">:</span><span class="token function">startBackwardTimer</span><span class="token punctuation">(</span>miniTimer1<span class="token punctuation">,</span> stTime<span class="token punctuation">)</span>
		<span class="token keyword">local</span> sTip <span class="token operator">=</span> string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>GameTips<span class="token punctuation">.</span>CountTip<span class="token punctuation">,</span> stage<span class="token punctuation">)</span>
		MiniTimer<span class="token punctuation">:</span><span class="token function">showTimerTips</span><span class="token punctuation">(</span>players<span class="token punctuation">,</span> miniTimer1<span class="token punctuation">,</span> sTip<span class="token punctuation">,</span> <span class="token keyword">true</span><span class="token punctuation">)</span>
	<span class="token keyword">end</span>

	<span class="token keyword">local</span> score <span class="token operator">=</span> GameSData<span class="token punctuation">[</span>stage<span class="token punctuation">]</span><span class="token punctuation">.</span>score
	<span class="token keyword">local</span> dtime <span class="token operator">=</span> math<span class="token punctuation">.</span><span class="token function">modf</span><span class="token punctuation">(</span>GameSData<span class="token punctuation">[</span>stage<span class="token punctuation">]</span><span class="token punctuation">.</span>dtime<span class="token operator">/</span><span class="token number">60</span><span class="token punctuation">)</span>
	<span class="token keyword">local</span> chatTips <span class="token operator">=</span> string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>GameTips<span class="token punctuation">.</span>chatStage<span class="token punctuation">,</span> stage<span class="token punctuation">,</span>dtime<span class="token punctuation">,</span>score<span class="token punctuation">)</span>
	Chat<span class="token punctuation">:</span><span class="token function">sendSystemMsg</span><span class="token punctuation">(</span>chatTips<span class="token punctuation">)</span>
	<span class="token keyword">if</span> stage <span class="token operator">==</span> <span class="token number">1</span> <span class="token keyword">then</span> Chat<span class="token punctuation">:</span><span class="token function">sendSystemMsg</span><span class="token punctuation">(</span>GameTips<span class="token punctuation">.</span>chatNewIn<span class="token punctuation">)</span> <span class="token keyword">end</span>

	<span class="token comment">--Chat:sendSystemMsg(GameTips.NewTips)</span>
	<span class="token comment">--add new required after 1 second</span>
	threadpool<span class="token punctuation">:</span><span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> TargetRefresh<span class="token punctuation">)</span>
	
	IsLastCount <span class="token operator">=</span> <span class="token keyword">false</span>
	<span class="token keyword">local</span> mcPos <span class="token operator">=</span> GameSData<span class="token punctuation">[</span>stage<span class="token punctuation">]</span><span class="token punctuation">.</span>mpos<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
	Block<span class="token punctuation">:</span><span class="token function">setBlockAll</span><span class="token punctuation">(</span>mcPos<span class="token punctuation">.</span>x<span class="token punctuation">,</span> mcPos<span class="token punctuation">.</span>y<span class="token punctuation">,</span> mcPos<span class="token punctuation">.</span>z<span class="token punctuation">,</span> IDs<span class="token punctuation">.</span>musicBlkIdx<span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token comment">--------Update--------</span>
Game_RunTime <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">--10 seconds left 10 tick Generate block</span>
	<span class="token keyword">if</span> IsLastCount <span class="token keyword">and</span> tickCount<span class="token operator">==</span><span class="token number">10</span> <span class="token keyword">then</span>
		<span class="token keyword">local</span> stage <span class="token operator">=</span> CurrStage<span class="token punctuation">.</span>stage
		<span class="token keyword">local</span> mPos <span class="token operator">=</span> GameSData<span class="token punctuation">[</span>stage<span class="token punctuation">]</span><span class="token punctuation">.</span>mpos<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
		Block<span class="token punctuation">:</span><span class="token function">setBlockAll</span><span class="token punctuation">(</span>mPos<span class="token punctuation">.</span>x<span class="token punctuation">,</span> mPos<span class="token punctuation">.</span>y<span class="token punctuation">,</span> mPos<span class="token punctuation">.</span>z<span class="token punctuation">,</span> IDs<span class="token punctuation">.</span>musicBlkIdx<span class="token punctuation">)</span>
	<span class="token keyword">end</span>

	<span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token function">IsCanTick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">then</span> <span class="token keyword">return</span> <span class="token keyword">end</span>
	<span class="token keyword">if</span> IsGameEnded <span class="token keyword">then</span> <span class="token keyword">return</span> <span class="token keyword">end</span>

	<span class="token comment">--10 seconds left 20 tick delete block</span>
	<span class="token keyword">local</span> stage <span class="token operator">=</span> CurrStage<span class="token punctuation">.</span>stage
	<span class="token keyword">if</span> IsLastCount <span class="token keyword">then</span> <span class="token comment">--10 seconds left</span>
		<span class="token keyword">local</span> mPos <span class="token operator">=</span> GameSData<span class="token punctuation">[</span>stage<span class="token punctuation">]</span><span class="token punctuation">.</span>mpos<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
		Block<span class="token punctuation">:</span><span class="token function">destroyBlock</span><span class="token punctuation">(</span>mPos<span class="token punctuation">.</span>x<span class="token punctuation">,</span> mPos<span class="token punctuation">.</span>y<span class="token punctuation">,</span> mPos<span class="token punctuation">.</span>z<span class="token punctuation">)</span>
	<span class="token keyword">end</span>

	<span class="token keyword">if</span> miniTimer2 <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token keyword">then</span>
		<span class="token keyword">if</span> miniTimer2 <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">then</span>
			<span class="token keyword">local</span> timeTip <span class="token operator">=</span> string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">'#R%d#n'</span><span class="token punctuation">,</span>miniTimer2<span class="token punctuation">)</span>
			<span class="token comment">--Chat:sendSystemMsg(timeTip)</span>
			<span class="token comment">-- Changed to player Tip</span>
			<span class="token keyword">local</span> ret<span class="token punctuation">,</span>num<span class="token punctuation">,</span>players <span class="token operator">=</span> World<span class="token punctuation">:</span><span class="token function">getAllPlayers</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token keyword">if</span> ret<span class="token operator">==</span>ErrorCode<span class="token punctuation">.</span>OK <span class="token keyword">then</span>
				<span class="token keyword">for</span> idx <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">#</span>players <span class="token keyword">do</span>
					Player<span class="token punctuation">:</span><span class="token function">notifyGameInfo2Self</span><span class="token punctuation">(</span>players<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">,</span> timeTip<span class="token punctuation">)</span>
				<span class="token keyword">end</span>
			<span class="token keyword">end</span>
		<span class="token keyword">else</span>
			<span class="token function">StartNewRound</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">end</span>
		miniTimer2 <span class="token operator">=</span> miniTimer2<span class="token operator">-</span><span class="token number">1</span>
	<span class="token keyword">end</span>

	<span class="token keyword">local</span> csize <span class="token operator">=</span> <span class="token operator">#</span>CurrStage<span class="token punctuation">.</span>clocks
	<span class="token keyword">if</span> csize <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token keyword">then</span> <span class="token keyword">return</span> <span class="token keyword">end</span>
	<span class="token keyword">for</span> idx <span class="token operator">=</span> <span class="token operator">#</span>CurrStage<span class="token punctuation">.</span>clocks<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">do</span>
		<span class="token keyword">local</span> clock <span class="token operator">=</span> CurrStage<span class="token punctuation">.</span>clocks<span class="token punctuation">[</span>idx<span class="token punctuation">]</span>
		<span class="token keyword">if</span> clock<span class="token punctuation">.</span>time <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token keyword">then</span> <span class="token comment">--destroy</span>
			<span class="token function">ClockCrtOrDel</span><span class="token punctuation">(</span>clock<span class="token punctuation">,</span> <span class="token keyword">true</span><span class="token punctuation">)</span>
			table<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>CurrStage<span class="token punctuation">.</span>clocks<span class="token punctuation">,</span> idx<span class="token punctuation">)</span>
			<span class="token comment">-- Tips of guest left</span>
			<span class="token keyword">local</span> chatTips <span class="token operator">=</span> string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>GameTips<span class="token punctuation">.</span>windLeave<span class="token punctuation">,</span> customers<span class="token punctuation">)</span>
			Chat<span class="token punctuation">:</span><span class="token function">sendSystemMsg</span><span class="token punctuation">(</span>chatTips<span class="token punctuation">)</span>

			<span class="token keyword">local</span> randsec <span class="token operator">=</span> math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
			threadpool<span class="token punctuation">:</span><span class="token function">delay</span><span class="token punctuation">(</span>randsec<span class="token punctuation">,</span> TargetRefresh<span class="token punctuation">)</span>
		<span class="token keyword">elseif</span> <span class="token keyword">not</span> clock<span class="token punctuation">.</span>stop <span class="token keyword">then</span> <span class="token comment">--Timing</span>
			<span class="token function">ClockCounted</span><span class="token punctuation">(</span>clock<span class="token punctuation">,</span> <span class="token string">'count'</span><span class="token punctuation">)</span>
			clock<span class="token punctuation">.</span>time <span class="token operator">=</span> clock<span class="token punctuation">.</span>time<span class="token operator">-</span><span class="token number">1</span>
		<span class="token keyword">end</span>
	<span class="token keyword">end</span>

	<span class="token keyword">if</span> miniTimer1 <span class="token operator">~=</span> <span class="token number">0</span> <span class="token keyword">then</span>
		<span class="token keyword">local</span> ret<span class="token punctuation">,</span> curTime <span class="token operator">=</span> MiniTimer<span class="token punctuation">:</span><span class="token function">getTimerTime</span><span class="token punctuation">(</span>miniTimer1<span class="token punctuation">)</span>
		<span class="token keyword">if</span> ret<span class="token operator">==</span>ErrorCode<span class="token punctuation">.</span>OK <span class="token keyword">then</span>
			<span class="token keyword">if</span> curTime <span class="token operator">==</span> <span class="token number">30</span> <span class="token keyword">then</span> <span class="token comment">-- Last 30 seconds</span>
				Chat<span class="token punctuation">:</span><span class="token function">sendSystemMsg</span><span class="token punctuation">(</span>GameTips<span class="token punctuation">.</span>chatLast30<span class="token punctuation">)</span>

				IsLastCount <span class="token operator">=</span> <span class="token keyword">true</span>
				<span class="token keyword">local</span> mPos <span class="token operator">=</span> GameSData<span class="token punctuation">[</span>stage<span class="token punctuation">]</span><span class="token punctuation">.</span>mpos<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
				Block<span class="token punctuation">:</span><span class="token function">destroyBlock</span><span class="token punctuation">(</span>mPos<span class="token punctuation">.</span>x<span class="token punctuation">,</span> mPos<span class="token punctuation">.</span>y<span class="token punctuation">,</span> mPos<span class="token punctuation">.</span>z<span class="token punctuation">)</span>
			<span class="token keyword">elseif</span> curTime <span class="token operator">==</span> <span class="token number">10</span> <span class="token keyword">then</span> <span class="token comment">--Last 10 seconds</span>
				Chat<span class="token punctuation">:</span><span class="token function">sendSystemMsg</span><span class="token punctuation">(</span>GameTips<span class="token punctuation">.</span>chatLast10<span class="token punctuation">)</span>
			<span class="token keyword">elseif</span> curTime <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token keyword">then</span> <span class="token comment">--Game over</span>
				IsGameEnded <span class="token operator">=</span> <span class="token keyword">true</span> <span class="token comment">--Sorry, game over</span>
				BattleResult <span class="token operator">=</span> TEAM_RESULTS<span class="token punctuation">.</span>TEAM_RESULTS_LOSE
				Game<span class="token punctuation">:</span><span class="token function">doGameEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token keyword">return</span>
			<span class="token keyword">end</span>
		<span class="token keyword">end</span>
	<span class="token keyword">end</span>
<span class="token keyword">end</span>

<span class="token comment">--------Game over--------</span>
Game_Over <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">local</span> txtIdx <span class="token operator">=</span> <span class="token number">270</span> <span class="token comment">--win</span>
	<span class="token keyword">if</span> BattleResult<span class="token operator">==</span>TEAM_RESULTS<span class="token punctuation">.</span>TEAM_RESULTS_LOSE <span class="token keyword">then</span>
		txtIdx <span class="token operator">=</span> <span class="token number">271</span> <span class="token comment">--lost</span>
	<span class="token keyword">end</span>

	<span class="token keyword">local</span> ret<span class="token punctuation">,</span> txtInfox <span class="token operator">=</span> Game<span class="token punctuation">:</span><span class="token function">getDefString</span><span class="token punctuation">(</span>txtIdx<span class="token punctuation">)</span>
	<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'Fz==&gt;&gt;&gt;'</span><span class="token punctuation">,</span> BattleResult<span class="token punctuation">,</span> txtIdx<span class="token punctuation">,</span> ret<span class="token punctuation">,</span> txtInfox<span class="token punctuation">)</span>

	Chat<span class="token punctuation">:</span><span class="token function">sendSystemMsg</span><span class="token punctuation">(</span>txtInfox<span class="token punctuation">)</span>
	Team<span class="token punctuation">:</span><span class="token function">setTeamResults</span><span class="token punctuation">(</span>teamIdx<span class="token punctuation">,</span> BattleResult<span class="token punctuation">)</span>
	Team<span class="token punctuation">:</span><span class="token function">setTeamPlayersResults</span><span class="token punctuation">(</span>teamIdx<span class="token punctuation">,</span> BattleResult<span class="token punctuation">)</span>

	<span class="token function">ShowGBattleUI</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token comment">--------game timeout--------</span>
Game_Tout <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	BattleResult <span class="token operator">=</span> TEAM_RESULTS<span class="token punctuation">.</span>TEAM_RESULTS_LOSE
<span class="token keyword">end</span>

<span class="token comment">-------Player initialization-------</span>
Player_Init <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>trigger_obj<span class="token punctuation">)</span>
	<span class="token keyword">if</span> <span class="token keyword">not</span> IsGRuleInit <span class="token keyword">then</span> <span class="token function">InitGameRule</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">end</span>

	<span class="token keyword">local</span> playerId <span class="token operator">=</span> trigger_obj<span class="token punctuation">[</span><span class="token string">'eventobjid'</span><span class="token punctuation">]</span>
	<span class="token keyword">if</span> <span class="token keyword">not</span> playerId <span class="token keyword">then</span> <span class="token keyword">return</span> <span class="token keyword">end</span>
	Player<span class="token punctuation">:</span><span class="token function">setTeam</span><span class="token punctuation">(</span>playerId<span class="token punctuation">,</span> teamIdx<span class="token punctuation">)</span>

	<span class="token keyword">if</span> miniTimer1 <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">then</span> <span class="token comment">--Game start</span>
		<span class="token keyword">local</span> stage <span class="token operator">=</span> CurrStage<span class="token punctuation">.</span>stage
		<span class="token keyword">local</span> allPos <span class="token operator">=</span> GameSData<span class="token punctuation">[</span>stage<span class="token punctuation">]</span><span class="token punctuation">.</span>pos
		<span class="token keyword">local</span> index <span class="token operator">=</span> <span class="token number">1</span>
		<span class="token keyword">local</span> ret<span class="token punctuation">,</span> num <span class="token operator">=</span> World<span class="token punctuation">:</span><span class="token function">getPlayerTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> ret<span class="token operator">==</span>ErrorCode<span class="token punctuation">.</span>OK <span class="token keyword">then</span> index <span class="token operator">=</span> <span class="token punctuation">(</span>num<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">3</span><span class="token operator">+</span><span class="token number">1</span> <span class="token keyword">end</span>

		<span class="token keyword">local</span> curPos <span class="token operator">=</span> allPos<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token comment">--Three position cycle</span>
		Player<span class="token punctuation">:</span><span class="token function">setPosition</span><span class="token punctuation">(</span>playerId<span class="token punctuation">,</span> curPos<span class="token punctuation">.</span>x<span class="token punctuation">,</span> curPos<span class="token punctuation">.</span>y<span class="token punctuation">,</span> curPos<span class="token punctuation">.</span>z<span class="token punctuation">)</span>
	<span class="token keyword">end</span>
<span class="token keyword">end</span>

<span class="token keyword">local</span> curr_playerid <span class="token operator">=</span> <span class="token keyword">nil</span>
<span class="token comment">--------start to dig the event--------</span>
Block_DigBegin <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>trigger_obj<span class="token punctuation">)</span>
	<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'Begin===&gt;&gt;'</span><span class="token punctuation">,</span> trigger_obj<span class="token punctuation">)</span>
	<span class="token keyword">local</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z <span class="token operator">=</span> trigger_obj<span class="token punctuation">[</span><span class="token string">'x'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> trigger_obj<span class="token punctuation">[</span><span class="token string">'y'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> trigger_obj<span class="token punctuation">[</span><span class="token string">'z'</span><span class="token punctuation">]</span>
	<span class="token keyword">local</span> blockId<span class="token punctuation">,</span> playerId <span class="token operator">=</span> trigger_obj<span class="token punctuation">[</span><span class="token string">'blockid'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> trigger_obj<span class="token punctuation">[</span><span class="token string">'eventobjid'</span><span class="token punctuation">]</span>

	<span class="token keyword">if</span> blockId<span class="token operator">==</span>IDs<span class="token punctuation">.</span>cutBoardxId <span class="token keyword">or</span> blockId<span class="token operator">==</span>IDs<span class="token punctuation">.</span>washTableId <span class="token keyword">or</span> blockId<span class="token operator">==</span>IDs<span class="token punctuation">.</span>waterTapxId <span class="token keyword">then</span>
		<span class="token comment">--Set up like Dig.End evnet can not get ID</span>
		curr_playerid <span class="token operator">=</span> trigger_obj<span class="token punctuation">[</span><span class="token string">'eventobjid'</span><span class="token punctuation">]</span>
		<span class="token function">Block_DigEnded</span><span class="token punctuation">(</span>trigger_obj<span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token keyword">end</span>

	<span class="token comment">-- Get the current manual item ID</span>
	<span class="token keyword">local</span> ret<span class="token punctuation">,</span> toolIdx <span class="token operator">=</span> Player<span class="token punctuation">:</span><span class="token function">getCurToolID</span><span class="token punctuation">(</span>playerId<span class="token punctuation">)</span>
	<span class="token keyword">if</span> ret <span class="token operator">~=</span> ErrorCode<span class="token punctuation">.</span>OK <span class="token keyword">then</span> <span class="token keyword">return</span> <span class="token keyword">end</span>

	<span class="token comment">-- 0、store block</span>
	<span class="token keyword">if</span> blockId <span class="token operator">==</span> IDs<span class="token punctuation">.</span>storeBoxIdx <span class="token keyword">then</span>
	<span class="token keyword">end</span>

	<span class="token comment">-- 1、The current square is a funnel-&gt;Click to get points</span>
	<span class="token keyword">local</span> isSpecialDish <span class="token operator">=</span> toolIdx<span class="token operator">==</span>IDs<span class="token punctuation">.</span>emptyDishId <span class="token keyword">or</span> blockId<span class="token operator">==</span>IDs<span class="token punctuation">.</span>dirtyDishId
	<span class="token keyword">if</span> <span class="token punctuation">(</span>blockId<span class="token operator">==</span>IDs<span class="token punctuation">.</span>funnelBlkId <span class="token keyword">or</span> blockId<span class="token operator">==</span>IDs<span class="token punctuation">.</span>arrowheadId<span class="token punctuation">)</span> <span class="token keyword">and</span> 
		<span class="token keyword">not</span> isSpecialDish <span class="token keyword">and</span> <span class="token function">KeyInTable</span><span class="token punctuation">(</span>toolIdx<span class="token punctuation">,</span> DishBlks<span class="token punctuation">)</span> <span class="token keyword">then</span>
		<span class="token keyword">local</span> cur_stage <span class="token operator">=</span> CurrStage<span class="token punctuation">.</span>stage
		<span class="token keyword">local</span> fpos <span class="token operator">=</span> GameSData<span class="token punctuation">[</span>cur_stage<span class="token punctuation">]</span><span class="token punctuation">.</span>fpos
		<span class="token keyword">local</span> isStagePos <span class="token operator">=</span> <span class="token keyword">false</span>
		<span class="token keyword">for</span> idx <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">#</span>fpos <span class="token keyword">do</span> <span class="token comment">--Check the place</span>
			<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'Click2===&gt;&gt;&gt;'</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>z<span class="token punctuation">,</span> fpos<span class="token punctuation">)</span>
			<span class="token keyword">if</span> x<span class="token operator">==</span>fpos<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token keyword">and</span> z<span class="token operator">==</span>fpos<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">.</span>z <span class="token keyword">and</span> <span class="token punctuation">(</span>y<span class="token operator">==</span>fpos<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token keyword">or</span> y<span class="token operator">==</span>fpos<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">or</span> y<span class="token operator">==</span>fpos<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">then</span>
				isStagePos <span class="token operator">=</span> <span class="token keyword">true</span><span class="token punctuation">;</span>
				<span class="token keyword">break</span>
			<span class="token keyword">end</span>
		<span class="token keyword">end</span>

		<span class="token keyword">if</span> <span class="token keyword">not</span> isStagePos <span class="token keyword">then</span> <span class="token keyword">return</span> <span class="token keyword">end</span>
		Player<span class="token punctuation">:</span><span class="token function">onCurToolUsed</span><span class="token punctuation">(</span>playerId<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

		<span class="token keyword">local</span> seqId <span class="token operator">=</span> threadpool<span class="token punctuation">:</span><span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> GensDirtyDish<span class="token punctuation">)</span>
		<span class="token keyword">local</span> seqSize <span class="token operator">=</span> <span class="token operator">#</span>CurrStage<span class="token punctuation">.</span>seqids
		CurrStage<span class="token punctuation">.</span>seqids<span class="token punctuation">[</span>seqSize<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> seqId

		<span class="token comment">-- Bonus points for delivery</span>
		<span class="token keyword">local</span> csize <span class="token operator">=</span> <span class="token operator">#</span>CurrStage<span class="token punctuation">.</span>clocks
		<span class="token keyword">if</span> csize <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token keyword">then</span> <span class="token keyword">return</span> <span class="token keyword">end</span>
		<span class="token keyword">for</span> idx <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> csize <span class="token keyword">do</span> <span class="token comment">--return after deleted</span>
			<span class="token keyword">local</span> clock <span class="token operator">=</span> CurrStage<span class="token punctuation">.</span>clocks<span class="token punctuation">[</span>idx<span class="token punctuation">]</span>
			<span class="token keyword">local</span> goalIdx <span class="token operator">=</span> clock<span class="token punctuation">.</span>goal <span class="token comment">--target ID</span>
			<span class="token keyword">if</span> goalIdx <span class="token operator">==</span> toolIdx <span class="token keyword">then</span>
				<span class="token function">TargetHited</span><span class="token punctuation">(</span>clock<span class="token punctuation">)</span>

				clock<span class="token punctuation">.</span>stop <span class="token operator">=</span> <span class="token keyword">true</span><span class="token comment">--stop timing</span>
				<span class="token keyword">local</span> delayRemove <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
					<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>cclock<span class="token punctuation">,</span>cidx<span class="token punctuation">)</span>
						<span class="token function">ClockCrtOrDel</span><span class="token punctuation">(</span>cclock<span class="token punctuation">,</span> <span class="token keyword">true</span><span class="token punctuation">)</span>
						table<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>CurrStage<span class="token punctuation">.</span>clocks<span class="token punctuation">,</span>cidx<span class="token punctuation">)</span>
					<span class="token keyword">end</span><span class="token punctuation">)</span><span class="token punctuation">(</span>clock<span class="token punctuation">,</span>idx<span class="token punctuation">)</span>
				<span class="token keyword">end</span>
				<span class="token keyword">local</span> seqId1 <span class="token operator">=</span> threadpool<span class="token punctuation">:</span><span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> delayRemove<span class="token punctuation">)</span>
				<span class="token keyword">local</span> seqSize <span class="token operator">=</span> <span class="token operator">#</span>CurrStage<span class="token punctuation">.</span>seqids
				CurrStage<span class="token punctuation">.</span>seqids<span class="token punctuation">[</span>seqSize<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> seqId1

				<span class="token keyword">local</span> randsec <span class="token operator">=</span> math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
				<span class="token keyword">local</span> seqId2 <span class="token operator">=</span> threadpool<span class="token punctuation">:</span><span class="token function">delay</span><span class="token punctuation">(</span>randsec<span class="token punctuation">,</span> TargetRefresh<span class="token punctuation">)</span>
				<span class="token keyword">local</span> seqSize <span class="token operator">=</span> <span class="token operator">#</span>CurrStage<span class="token punctuation">.</span>seqids
				CurrStage<span class="token punctuation">.</span>seqids<span class="token punctuation">[</span>seqSize<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> seqId2

				<span class="token comment">-- more than 10sec get 2 points, within 10sec get 1 point</span>
				<span class="token keyword">local</span> score <span class="token operator">=</span> clock<span class="token punctuation">.</span>time<span class="token operator">&gt;</span><span class="token number">10</span> <span class="token keyword">and</span> <span class="token number">2</span> <span class="token keyword">or</span> <span class="token number">1</span>
				<span class="token comment">-- put it back to see if pass</span>
				<span class="token function">TeamAddScore</span><span class="token punctuation">(</span>teamIdx<span class="token punctuation">,</span> score<span class="token punctuation">)</span>
				<span class="token keyword">return</span>
			<span class="token keyword">end</span>
		<span class="token keyword">end</span>

		<span class="token comment">--Error delivery returns with a tip</span>
		<span class="token keyword">local</span> ret<span class="token punctuation">,</span>num<span class="token punctuation">,</span>players <span class="token operator">=</span> World<span class="token punctuation">:</span><span class="token function">getAllPlayers</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> ret<span class="token operator">==</span>ErrorCode<span class="token punctuation">.</span>OK <span class="token keyword">then</span>
			<span class="token keyword">for</span> idx <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">#</span>players <span class="token keyword">do</span>
				<span class="token keyword">local</span> scoreTips <span class="token operator">=</span> GameTips<span class="token punctuation">.</span>windScore0
				Player<span class="token punctuation">:</span><span class="token function">notifyGameInfo2Self</span><span class="token punctuation">(</span>players<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">,</span> scoreTips<span class="token punctuation">)</span>
			<span class="token keyword">end</span>
		<span class="token keyword">end</span>
		<span class="token keyword">return</span>
	<span class="token keyword">end</span>

	<span class="token comment">-- 2、scene block-&gt;Put the dishes</span>
	<span class="token keyword">local</span> isGameBlock <span class="token operator">=</span> blockId<span class="token operator">==</span>IDs<span class="token punctuation">.</span>sceneBlk1Id <span class="token keyword">or</span> blockId<span class="token operator">==</span>IDs<span class="token punctuation">.</span>sceneBlk2Id
	<span class="token keyword">if</span> isGameBlock <span class="token keyword">and</span> <span class="token function">KeyInTable</span><span class="token punctuation">(</span>toolIdx<span class="token punctuation">,</span> DishBlks<span class="token punctuation">)</span> <span class="token keyword">then</span>
		Block<span class="token punctuation">:</span><span class="token function">placeBlock</span><span class="token punctuation">(</span>toolIdx<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> z<span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token keyword">end</span>

	<span class="token comment">-- 3、dish block-&gt;Plate convert/fetch</span>
	<span class="token keyword">if</span> <span class="token function">KeyInTable</span><span class="token punctuation">(</span>blockId<span class="token punctuation">,</span> DishBlks<span class="token punctuation">)</span> <span class="token keyword">then</span>
		<span class="token comment">-- 3.1、Click the plate empty-handed-&gt;get plate</span>
		<span class="token keyword">if</span> toolIdx <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">then</span>
			<span class="token keyword">local</span> bType <span class="token operator">=</span> BACKPACK_TYPE<span class="token punctuation">.</span>SHORTCUT
			<span class="token keyword">local</span> ret <span class="token operator">=</span> Player<span class="token punctuation">:</span><span class="token function">gainItems</span><span class="token punctuation">(</span>playerId<span class="token punctuation">,</span> blockId<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> bType<span class="token punctuation">)</span>
			<span class="token keyword">if</span> ret<span class="token operator">==</span>ErrorCode<span class="token punctuation">.</span>OK <span class="token keyword">then</span> Block<span class="token punctuation">:</span><span class="token function">setBlockAll</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">end</span>
			<span class="token keyword">return</span>
		<span class="token keyword">end</span>

		<span class="token comment">-- 3.2、Hold the food+click the plate-&gt;Corresponding delivery block</span>
		<span class="token keyword">if</span> <span class="token function">KeyInTable</span><span class="token punctuation">(</span>toolIdx<span class="token punctuation">,</span> FoodIDs<span class="token punctuation">)</span> <span class="token keyword">then</span>
			<span class="token keyword">local</span> newBlockId <span class="token operator">=</span> FinalIDs<span class="token punctuation">[</span>toolIdx<span class="token punctuation">]</span><span class="token punctuation">[</span>blockId<span class="token punctuation">]</span>
			<span class="token keyword">if</span> newBlockId <span class="token operator">~=</span> <span class="token keyword">nil</span> <span class="token keyword">then</span> <span class="token comment">--There are output items that can be converted</span>
				<span class="token keyword">local</span> ret <span class="token operator">=</span> Block<span class="token punctuation">:</span><span class="token function">setBlockAll</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">,</span> newBlockId<span class="token punctuation">)</span>
				<span class="token keyword">if</span> ret <span class="token operator">==</span> ErrorCode<span class="token punctuation">.</span>OK <span class="token keyword">then</span><span class="token comment">--consume hand-held items</span>
					Player<span class="token punctuation">:</span><span class="token function">onCurToolUsed</span><span class="token punctuation">(</span>playerId<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
				<span class="token keyword">end</span>
			<span class="token keyword">end</span>
			<span class="token keyword">return</span>
		<span class="token keyword">end</span>
	<span class="token keyword">end</span>
<span class="token keyword">end</span>

<span class="token comment">--------Dig the end of the event--------</span>
Block_DigEnded <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>trigger_obj<span class="token punctuation">)</span>
	<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'End1=======&gt;&gt;&gt;'</span><span class="token punctuation">,</span> trigger_obj<span class="token punctuation">)</span>
	<span class="token keyword">local</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z <span class="token operator">=</span> trigger_obj<span class="token punctuation">[</span><span class="token string">'x'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> trigger_obj<span class="token punctuation">[</span><span class="token string">'y'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> trigger_obj<span class="token punctuation">[</span><span class="token string">'z'</span><span class="token punctuation">]</span>
	<span class="token keyword">local</span> blockId<span class="token punctuation">,</span> playerId <span class="token operator">=</span> trigger_obj<span class="token punctuation">[</span><span class="token string">'blockid'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> trigger_obj<span class="token punctuation">[</span><span class="token string">'eventobjid'</span><span class="token punctuation">]</span>

	<span class="token comment">-- Return directly if neither is obtained</span>
	<span class="token keyword">if</span> <span class="token keyword">not</span> playerId <span class="token keyword">and</span> <span class="token keyword">not</span> curr_playerid <span class="token keyword">then</span> <span class="token keyword">return</span> <span class="token keyword">end</span>

	<span class="token comment">--DigEnd event did not reture objid</span>
	<span class="token keyword">if</span> playerId <span class="token operator">==</span> <span class="token keyword">nil</span> <span class="token keyword">then</span> playerId <span class="token operator">=</span> curr_playerid <span class="token keyword">end</span>
	curr_playerid <span class="token operator">=</span> <span class="token keyword">nil</span> <span class="token comment">--replace after used</span>
	
	<span class="token keyword">local</span> cur_stage <span class="token operator">=</span> CurrStage<span class="token punctuation">.</span>stage
	<span class="token keyword">local</span> tools <span class="token operator">=</span> GameSData<span class="token punctuation">[</span>cur_stage<span class="token punctuation">]</span><span class="token punctuation">.</span>tools
	<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'End2=======&gt;&gt;&gt;'</span><span class="token punctuation">,</span> tools<span class="token punctuation">,</span> cur_stage<span class="token punctuation">,</span> playerId<span class="token punctuation">)</span>
	<span class="token comment">-- Step to make items：machining=&gt;New item</span>
	<span class="token keyword">if</span> tools<span class="token punctuation">[</span>blockId<span class="token punctuation">]</span> <span class="token operator">~=</span> <span class="token keyword">nil</span> <span class="token keyword">then</span> <span class="token comment">--Cut potatoes/rack of lamb..</span>
		<span class="token keyword">local</span> ret<span class="token punctuation">,</span> toolId <span class="token operator">=</span> Player<span class="token punctuation">:</span><span class="token function">getCurToolID</span><span class="token punctuation">(</span>playerId<span class="token punctuation">)</span>
		<span class="token keyword">if</span> ret <span class="token operator">==</span> ErrorCode<span class="token punctuation">.</span>OK <span class="token keyword">then</span>
			<span class="token keyword">for</span> idx<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">#</span>tools<span class="token punctuation">[</span>blockId<span class="token punctuation">]</span> <span class="token keyword">do</span><span class="token comment">--Traversal search</span>
				<span class="token keyword">local</span> retFood <span class="token operator">=</span> tools<span class="token punctuation">[</span>blockId<span class="token punctuation">]</span><span class="token punctuation">[</span>idx<span class="token punctuation">]</span>
				<span class="token keyword">local</span> outputId <span class="token operator">=</span> retFood<span class="token punctuation">[</span>toolId<span class="token punctuation">]</span>
				<span class="token keyword">if</span> outputId <span class="token operator">~=</span> <span class="token keyword">nil</span> <span class="token keyword">then</span> <span class="token comment">--matching outputs and replacing items</span>
					<span class="token keyword">local</span> ret <span class="token operator">=</span> Player<span class="token punctuation">:</span><span class="token function">onCurToolUsed</span><span class="token punctuation">(</span>playerId<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
					<span class="token keyword">if</span> ret <span class="token operator">==</span> ErrorCode<span class="token punctuation">.</span>OK <span class="token keyword">then</span>
						<span class="token keyword">local</span> bType <span class="token operator">=</span> BACKPACK_TYPE<span class="token punctuation">.</span>SHORTCUT
						Player<span class="token punctuation">:</span><span class="token function">gainItems</span><span class="token punctuation">(</span>playerId<span class="token punctuation">,</span> outputId<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> bType<span class="token punctuation">)</span>
					<span class="token keyword">end</span>
				<span class="token keyword">end</span>
			<span class="token keyword">end</span>
		<span class="token keyword">end</span>
	<span class="token keyword">end</span>
<span class="token keyword">end</span>

<span class="token comment">-- Mobile can not distinguish keys of left and right </span>
Block_PlaceBy <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>trigger_obj<span class="token punctuation">)</span>
	<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'Place=======&gt;&gt;&gt;'</span><span class="token punctuation">,</span> trigger_obj<span class="token punctuation">)</span>
	<span class="token keyword">local</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z <span class="token operator">=</span> trigger_obj<span class="token punctuation">[</span><span class="token string">'x'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> trigger_obj<span class="token punctuation">[</span><span class="token string">'y'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> trigger_obj<span class="token punctuation">[</span><span class="token string">'z'</span><span class="token punctuation">]</span>
	<span class="token keyword">local</span> blockId<span class="token punctuation">,</span> playerId <span class="token operator">=</span> trigger_obj<span class="token punctuation">[</span><span class="token string">'blockid'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> trigger_obj<span class="token punctuation">[</span><span class="token string">'eventobjid'</span><span class="token punctuation">]</span>

	<span class="token comment">-- 1、The block is a funnel-&gt;Click deliver and get the score</span>
	<span class="token keyword">local</span> isSpecialDish <span class="token operator">=</span> blockId<span class="token operator">==</span>IDs<span class="token punctuation">.</span>emptyDishId <span class="token keyword">or</span> blockId<span class="token operator">==</span>IDs<span class="token punctuation">.</span>dirtyDishId
	<span class="token keyword">if</span> <span class="token keyword">not</span> isSpecialDish <span class="token keyword">and</span> <span class="token function">KeyInTable</span><span class="token punctuation">(</span>blockId<span class="token punctuation">,</span> DishBlks<span class="token punctuation">)</span> <span class="token keyword">then</span>
		<span class="token keyword">local</span> cur_stage <span class="token operator">=</span> CurrStage<span class="token punctuation">.</span>stage
		<span class="token keyword">local</span> fpos <span class="token operator">=</span> GameSData<span class="token punctuation">[</span>cur_stage<span class="token punctuation">]</span><span class="token punctuation">.</span>fpos
		<span class="token keyword">local</span> isStagePos <span class="token operator">=</span> <span class="token keyword">false</span>
		<span class="token keyword">for</span> idx <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">#</span>fpos <span class="token keyword">do</span> <span class="token comment">--check the place</span>
			<span class="token keyword">if</span> x<span class="token operator">==</span>fpos<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token keyword">and</span> z<span class="token operator">==</span>fpos<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">.</span>z <span class="token keyword">and</span> <span class="token punctuation">(</span>y<span class="token operator">==</span>fpos<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token keyword">or</span> y<span class="token operator">==</span>fpos<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">or</span> y<span class="token operator">==</span>fpos<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">then</span>
				isStagePos <span class="token operator">=</span> <span class="token keyword">true</span><span class="token punctuation">;</span>
				<span class="token keyword">break</span>
			<span class="token keyword">end</span>
		<span class="token keyword">end</span>
		<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'Place==&gt;&gt;&gt;'</span><span class="token punctuation">,</span> isStagePos<span class="token punctuation">)</span>
		<span class="token comment">-- Return if it is a wrong place </span>
		<span class="token keyword">if</span> <span class="token keyword">not</span> isStagePos <span class="token keyword">then</span> <span class="token keyword">return</span> <span class="token keyword">end</span>
		Block<span class="token punctuation">:</span><span class="token function">destroyBlock</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">,</span> <span class="token keyword">false</span><span class="token punctuation">)</span>

		<span class="token comment">--Generates dirty disks with a delay of 5 seconds and cancels if it goes to the next level</span>
		<span class="token keyword">local</span> seqId <span class="token operator">=</span> threadpool<span class="token punctuation">:</span><span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> GensDirtyDish<span class="token punctuation">)</span>
		<span class="token keyword">local</span> seqSize <span class="token operator">=</span> <span class="token operator">#</span>CurrStage<span class="token punctuation">.</span>seqids
		CurrStage<span class="token punctuation">.</span>seqids<span class="token punctuation">[</span>seqSize<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> seqId

		<span class="token comment">-- Bonus points for delivery</span>
		<span class="token keyword">local</span> csize <span class="token operator">=</span> <span class="token operator">#</span>CurrStage<span class="token punctuation">.</span>clocks
		<span class="token keyword">if</span> csize <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token keyword">then</span> <span class="token keyword">return</span> <span class="token keyword">end</span>
		<span class="token keyword">for</span> idx <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> csize <span class="token keyword">do</span> <span class="token comment">--return after deleted</span>
			<span class="token keyword">local</span> clock <span class="token operator">=</span> CurrStage<span class="token punctuation">.</span>clocks<span class="token punctuation">[</span>idx<span class="token punctuation">]</span>
			<span class="token keyword">local</span> goalIdx <span class="token operator">=</span> clock<span class="token punctuation">.</span>goal <span class="token comment">--target ID</span>
			<span class="token keyword">if</span> goalIdx <span class="token operator">==</span> blockId <span class="token keyword">then</span>
				<span class="token function">TargetHited</span><span class="token punctuation">(</span>clock<span class="token punctuation">)</span>

				clock<span class="token punctuation">.</span>stop <span class="token operator">=</span> <span class="token keyword">true</span><span class="token comment">--Timing stop</span>
				<span class="token keyword">local</span> delayRemove <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
					<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>cclock<span class="token punctuation">,</span>cidx<span class="token punctuation">)</span>
						<span class="token function">ClockCrtOrDel</span><span class="token punctuation">(</span>cclock<span class="token punctuation">,</span> <span class="token keyword">true</span><span class="token punctuation">)</span>
						table<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>CurrStage<span class="token punctuation">.</span>clocks<span class="token punctuation">,</span>cidx<span class="token punctuation">)</span>
					<span class="token keyword">end</span><span class="token punctuation">)</span><span class="token punctuation">(</span>clock<span class="token punctuation">,</span>idx<span class="token punctuation">)</span>
				<span class="token keyword">end</span>
				<span class="token keyword">local</span> seqId1 <span class="token operator">=</span> threadpool<span class="token punctuation">:</span><span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> delayRemove<span class="token punctuation">)</span>
				<span class="token keyword">local</span> seqSize <span class="token operator">=</span> <span class="token operator">#</span>CurrStage<span class="token punctuation">.</span>seqids
				CurrStage<span class="token punctuation">.</span>seqids<span class="token punctuation">[</span>seqSize<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> seqId1

				<span class="token keyword">local</span> randsec <span class="token operator">=</span> math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token comment">--Random refresh within 3 seconds</span>
				<span class="token comment">--Delay refresh request within 3 seconds and cancels if it goes to the next level</span>
				<span class="token keyword">local</span> seqId2 <span class="token operator">=</span> threadpool<span class="token punctuation">:</span><span class="token function">delay</span><span class="token punctuation">(</span>randsec<span class="token punctuation">,</span> TargetRefresh<span class="token punctuation">)</span>
				<span class="token keyword">local</span> seqSize <span class="token operator">=</span> <span class="token operator">#</span>CurrStage<span class="token punctuation">.</span>seqids
				CurrStage<span class="token punctuation">.</span>seqids<span class="token punctuation">[</span>seqSize<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> seqId2

				<span class="token comment">-- 10sec more get 2 points, in 10sec get 1 point</span>
				<span class="token keyword">local</span> score <span class="token operator">=</span> clock<span class="token punctuation">.</span>time<span class="token operator">&gt;</span><span class="token number">10</span> <span class="token keyword">and</span> <span class="token number">2</span> <span class="token keyword">or</span> <span class="token number">1</span>
				<span class="token comment">-- put it back to see if can pass</span>
				<span class="token function">TeamAddScore</span><span class="token punctuation">(</span>teamIdx<span class="token punctuation">,</span> score<span class="token punctuation">)</span>
				<span class="token keyword">return</span>
			<span class="token keyword">end</span>
		<span class="token keyword">end</span>

		<span class="token comment">--return if error delivery</span>
		<span class="token keyword">local</span> ret<span class="token punctuation">,</span>num<span class="token punctuation">,</span>players <span class="token operator">=</span> World<span class="token punctuation">:</span><span class="token function">getAllPlayers</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> ret<span class="token operator">==</span>ErrorCode<span class="token punctuation">.</span>OK <span class="token keyword">then</span> <span class="token comment">--Get all players correctly</span>
			<span class="token keyword">for</span> idx <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">#</span>players <span class="token keyword">do</span> <span class="token comment">--Give tips to all players</span>
				<span class="token keyword">local</span> scoreTips <span class="token operator">=</span> GameTips<span class="token punctuation">.</span>windScore0
				Player<span class="token punctuation">:</span><span class="token function">notifyGameInfo2Self</span><span class="token punctuation">(</span>players<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">,</span> scoreTips<span class="token punctuation">)</span>
			<span class="token keyword">end</span>
		<span class="token keyword">end</span>
		<span class="token keyword">return</span>
	<span class="token keyword">end</span>
<span class="token keyword">end</span>

<span class="token comment">--Registered Listening event</span>
<span class="token keyword">function</span> <span class="token function">ListenEvents_MiniCook</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token function">InitGameData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token comment">--Listening for game events</span>
	ScriptSupportEvent<span class="token punctuation">:</span><span class="token function">registerEvent</span><span class="token punctuation">(</span><span class="token string">[=[Game.Start]=]</span><span class="token punctuation">,</span> Game_Start<span class="token punctuation">)</span>
	ScriptSupportEvent<span class="token punctuation">:</span><span class="token function">registerEvent</span><span class="token punctuation">(</span><span class="token string">[=[Game.Run]=]</span><span class="token punctuation">,</span> Game_RunTime<span class="token punctuation">)</span>
	ScriptSupportEvent<span class="token punctuation">:</span><span class="token function">registerEvent</span><span class="token punctuation">(</span><span class="token string">[=[Game.End]=]</span><span class="token punctuation">,</span> Game_Over<span class="token punctuation">)</span>
	ScriptSupportEvent<span class="token punctuation">:</span><span class="token function">registerEvent</span><span class="token punctuation">(</span><span class="token string">[=[Game.TimeOver]=]</span><span class="token punctuation">,</span> Game_Tout<span class="token punctuation">)</span>
	ScriptSupportEvent<span class="token punctuation">:</span><span class="token function">registerEvent</span><span class="token punctuation">(</span><span class="token string">[=[Player.Init]=]</span><span class="token punctuation">,</span> Player_Init<span class="token punctuation">)</span>

    <span class="token comment">--Event trigger condition-Begin to mining block</span>
    <span class="token keyword">local</span> bgConsIds <span class="token operator">=</span> <span class="token punctuation">{</span>IDs<span class="token punctuation">.</span>sceneBlk1Id<span class="token punctuation">,</span> IDs<span class="token punctuation">.</span>sceneBlk2Id<span class="token punctuation">,</span> IDs<span class="token punctuation">.</span>storeBoxIdx<span class="token punctuation">,</span> IDs<span class="token punctuation">.</span>funnelBlkId<span class="token punctuation">,</span> IDs<span class="token punctuation">.</span>arrowheadId<span class="token punctuation">}</span>
    <span class="token keyword">for</span> idx<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">#</span>DishBlks <span class="token keyword">do</span> bgConsIds<span class="token punctuation">[</span><span class="token operator">#</span>bgConsIds<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> DishBlks<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token keyword">end</span>

    <span class="token comment">--Event trigger condition-End mining block</span>
    <span class="token keyword">local</span> egConsIds <span class="token operator">=</span> <span class="token punctuation">{</span>IDs<span class="token punctuation">.</span>cutBoardxId<span class="token punctuation">,</span> IDs<span class="token punctuation">.</span>washTableId<span class="token punctuation">,</span> IDs<span class="token punctuation">.</span>waterTapxId<span class="token punctuation">}</span>
    <span class="token keyword">for</span> idx<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">#</span>egConsIds <span class="token keyword">do</span> bgConsIds<span class="token punctuation">[</span><span class="token operator">#</span>bgConsIds<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> egConsIds<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token keyword">end</span>

    <span class="token comment">--Listening for block events</span>
	ScriptSupportEvent<span class="token punctuation">:</span><span class="token function">registerEvent_Block</span><span class="token punctuation">(</span><span class="token string">[=[Player.ClickBlock]=]</span><span class="token punctuation">,</span> Block_DigBegin<span class="token punctuation">,</span> bgConsIds<span class="token punctuation">)</span>
	ScriptSupportEvent<span class="token punctuation">:</span><span class="token function">registerEvent_Block</span><span class="token punctuation">(</span><span class="token string">[=[Block.PlaceBy]=]</span><span class="token punctuation">,</span> Block_PlaceBy<span class="token punctuation">,</span> bgConsIds<span class="token punctuation">)</span>
	<span class="token comment">--ScriptSupportEvent:registerEvent_Block([=[Block.Dig.Begin]=], Block_DigBegin, bgConsIds)</span>
	<span class="token comment">--ScriptSupportEvent:registerEvent_Block([=[Block.Dig.End]=], Block_DigEnded, egConsIds)</span>
<span class="token keyword">end</span>

<span class="token comment">-- Listening for events</span>
<span class="token function">ListenEvents_MiniCook</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">end</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Lua/example.html" class="prev">
        示例整合Examples collection
      </a></span> <span class="next"><a href="/Lua/color_fight.html">
        好色之途（Color Fight）
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.ef735673.js" defer></script><script src="/assets/js/2.b51029ec.js" defer></script><script src="/assets/js/38.c16df410.js" defer></script>
  </body>
</html>
